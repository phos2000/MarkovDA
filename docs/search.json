[
  {
    "objectID": "MarkovDA.html",
    "href": "MarkovDA.html",
    "title": "How to Create Markov Model using R",
    "section": "",
    "text": "We are tasked to examine the economic value of new treatments for a rare type of cancer. The new treatments were designed to increase the health of patients in remission & to prevent them from relapsing back to either Stage 1 or Stage 2.\n\nBefore the new drugs development, the transition probabilities were the following:\n\n\n\n\n\n\n\nDescription\nProbability\n\n\n\n\nProbability of transition from Healthy to Stage 1\n5%\n\n\nProbability of transition from Healthy to Stage 2\n2%\n\n\nProbability of transition from Healthy to Stage 3\n1%\n\n\nProbability of transition from Stage 1 to Stage 2\n10%\n\n\nProbability of transition from Stage 1 to Remission\n25%\n\n\nProbability of transition from Stage 2 to Stage 1\n5%\n\n\nProbability of transition from Stage 2 to Stage 3\n15%\n\n\nProbability of transition from Stage 2 to Remission\n20%\n\n\nProbability of transition from Stage 3 to Stage 2\n5%\n\n\nProbability of transition from Stage 3 to Death\n45%\n\n\nProbability of transition from Remission to Stage 1\n10%\n\n\nProbability of transition from Remission to Stage 2\n5%\n\n\nProbability of transition from Remission to Stage 1 when on Treatment A\n10%\n\n\nProbability of transition from Remission to Stage 2 when on Treatment A\n5%\n\n\nProbability of transition from Remission to Stage 1 when on Treatment B\n8%\n\n\nProbability of transition from Remission to Stage 2 when on Treatment B\n3%\n\n\nProbability of transition from Remission to Stage 1 when on Treatment C\n5%\n\n\nProbability of transition from Remission to Stage 2 when on Treatment C\n2%\n\n\n\nEach health state is associated with the following utilities:\n\n\n\nDescription\nUtility\n\n\n\n\nUtility of Healthy per cycle\n1\n\n\nUtility of Stage 1 per cycle\n0.88\n\n\nUtility of Stage 2 per cycle\n0.71\n\n\nUtility of Stage 3 per cycle\n0.36\n\n\nUtility of Remission per cycle\n0.95\n\n\n\nPatients in certain health states have to take medications and visit their treating physician on a regular basis:\n\n\n\nDescription\nCosts / Other\n\n\n\n\nNumber of visits per cycle in Stage 1\n4\n\n\nNumber of visits per cycle in Stage 2\n12\n\n\nNumber of visits per cycle in Stage 3\n52\n\n\nNumber of visits per cycle in Remission\n1\n\n\nCost of a visit\n$ 100\n\n\nCost of treatment per cycle in Stage 1\n$ 1,200\n\n\nCost of treatment per cycle in Stage 2\n$ 6,000\n\n\nCost of treatment per cycle in Stage 3\n$ 18,000\n\n\nCost of status quo per cycle in Remission\n$ 400\n\n\nCost of Treatment A per cycle in Remission\n$ 10,000\n\n\nCost of Treatment B per cycle in Remission\n$ 7,500\n\n\nCost of Treatment C per cycle in Remission\n$ 12,500\n\n\n\nAssume an annual discount rate of 3% and a 30-year time horizon.\n\n\n\n\n\n\nNote\n\n\n\nWhat You Need to Prepare:\n\nthe Exercise excel file: we have the initial values for all the parameters and the procedures displayed in the excel formula.\nthe Function R file: it includes some advanced and long functions for the process. Lots of the functions are included in the dampack R package.\nR Studio or R. – I highly recommende you to use R Studio"
  },
  {
    "objectID": "MarkovDA.html#if-all-probabilities-known-no-rate-to-probabilities-transitions",
    "href": "MarkovDA.html#if-all-probabilities-known-no-rate-to-probabilities-transitions",
    "title": "How to Create Markov Model using R",
    "section": "If All Probabilities Known (No Rate-to-Probabilities Transitions)",
    "text": "If All Probabilities Known (No Rate-to-Probabilities Transitions)\n\n\nCode\nbuild_matrices <- function(params, mtype) {\n  m_X = list()\n  for (m in v_names_str){\n    m_X_ = matrix(0, nrow = v_n_states, ncol = v_n_states, dimnames = list(v_names_states,v_names_states))\n    for (i in rownames(m_X_)) {\n      for (j in colnames(m_X_)) {\n        if (paste0(mtype,i,j) %in% names(params)) {\n          m_X_[i,j] = as.numeric(params[paste0(mtype,i,j)])\n        }\n      }\n    }\n    \n    if (mtype == \"p\") {\n      ## if drawing the probabilities from the given parameters and building a probability matrix\n      \n      if (paste0(\"pRemissionStage1_\",m) %in% names(params)) {\n        ## the relapse probs change over the strategies. A special rule here. \n        m_X_[\"Remission\",\"Stage1\"] = as.numeric(params[paste0(\"pRemissionStage1_\",m)])\n        m_X_[\"Remission\",\"Stage2\"] = as.numeric(params[paste0(\"pRemissionStage2_\",m)])\n      }\n        \n      for (n in 1:v_n_states) {\n        m_X_[n,n] = 1-sum(m_X_[n,])\n      }\n    } else {\n      ## if drawing the rates from the given paramters and building a rate matrix\n      \n      if (paste0(\"hrRemissionStage1_\",m) %in% names(params)) {\n        ## use the hazard ratios to adjust the relapse rates over the strategies. \n        m_X_[\"Remission\",\"Stage1\"] = m_X_[\"Remission\",\"Stage1\"] * as.numeric(params[paste0(\"hrRemissionStage1_\",m)])\n        m_X_[\"Remission\",\"Stage2\"] = m_X_[\"Remission\",\"Stage2\"] * as.numeric(params[paste0(\"hrRemissionStage2_\",m)])\n      }\n        \n      for (n in 1:v_n_states) {\n        m_X_[n,n] = -sum(m_X_[n,])\n      }\n    }\n    m_X[[m]] = m_X_\n  }\n  m_X\n}\n    \nm_P = build_matrices(params_sc, \"p\")\n\nm_P\n\n\n$quo\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.10   0.05   0.00      0.85  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00\n\n$trtA\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.02   0.01   0.00      0.97  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00\n\n$trtB\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.08   0.03   0.00      0.89  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00\n\n$trtC\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.05   0.02   0.00      0.93  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00\n\n\nIf having a rate matrix instead of all the probabilities, there are two ways to convert it to a probability matrix."
  },
  {
    "objectID": "MarkovDA.html#rate-to-probability-conversion-formulas",
    "href": "MarkovDA.html#rate-to-probability-conversion-formulas",
    "title": "How to Create Markov Model using R",
    "section": "Rate-to-Probability Conversion Formulas",
    "text": "Rate-to-Probability Conversion Formulas\n\\[\np_{HealthyStage1}= \\frac{r_{HealthyStage1}}{r_{HealthyStage1}+r_{HealthyStage2}+r_{HealthyStage3}}\\big ( 1 - e^{-(r_{HealthyStage1}+r_{HealthyStage2}+r_{HealthyStage3})\\Delta t}\\big )\n\\]\n\\[\np_{HealthyHealthy} = e^{-(r_{HealthyStage1}+r_{HealthyStage2}+r_{HealthyStage3})\\Delta t}\n\\]\nIn the above formulas, r_* is a transition rate and \\(\\Delta t\\) is the timestep, which in the Excel document is set to a value of 1 and stored in the variable n_cycle_length.\n\n\nCode\nm_P_form = list()\nm_P_ = matrix(0, nrow = v_n_states, ncol = v_n_states, dimnames = list(v_names_states,v_names_states))\n\nfor (i in v_names_states) {\n  tempsum = sum(as_tibble(params_sc) %>% select(starts_with(paste0(\"r\",i))))\n  for (j in v_names_states) {\n    if (paste0(\"r\",i,j) %in% names(params_sc)) {\n      ptemp = params_sc[[paste0(\"r\",i,j)]] * (1 - exp(-tempsum)) / tempsum\n    } else if (j == i) {\n      ptemp = exp(-tempsum)\n    } else {\n      ptemp = 0\n    }\n    m_P_[i,j] = ptemp\n  }\n}\nm_P_form[[v_names_str[1]]] = m_P_\n\nfor (str in v_names_str[2:4]) {\n  params_sc[[paste0(\"rRemissionStage1_\",str)]] = params_sc$rRemissionStage1 * params_sc[[paste0(\"hrRemissionStage1_\",str)]]\n  params_sc[[paste0(\"rRemissionStage2_\",str)]] = params_sc$rRemissionStage2 * params_sc[[paste0(\"hrRemissionStage2_\",str)]]\n  m_P_form[[str]] = m_P_\n  tempsum = params_sc[[paste0(\"rRemissionStage1_\",str)]] + params_sc[[paste0(\"rRemissionStage2_\",str)]]\n  m_P_form[[str]][\"Remission\", \"Stage1\"] = params_sc[[paste0(\"rRemissionStage1_\",str)]] * (1 - exp(-tempsum)) / tempsum\n  m_P_form[[str]][\"Remission\", \"Stage2\"] = params_sc[[paste0(\"rRemissionStage2_\",str)]] * (1 - exp(-tempsum)) / tempsum\n  m_P_form[[str]][\"Remission\", \"Remission\"] = exp(-tempsum)\n}\n\nm_P_form\n\n\n$quo\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.10   0.05   0.00      0.85  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00\n\n$trtA\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.02   0.01   0.00      0.97  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00\n\n$trtB\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.08   0.03   0.00      0.89  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00\n\n$trtC\n          Healthy Stage1 Stage2 Stage3 Remission Death\nHealthy      0.92   0.05   0.02   0.01      0.00  0.00\nStage1       0.00   0.65   0.10   0.00      0.25  0.00\nStage2       0.00   0.05   0.60   0.15      0.20  0.00\nStage3       0.00   0.00   0.05   0.50      0.00  0.45\nRemission    0.00   0.05   0.02   0.00      0.93  0.00\nDeath        0.00   0.00   0.00   0.00      0.00  1.00"
  },
  {
    "objectID": "MarkovDA.html#rate-to-probability-matrix-exponentiation",
    "href": "MarkovDA.html#rate-to-probability-matrix-exponentiation",
    "title": "How to Create Markov Model using R",
    "section": "Rate-to-Probability Matrix Exponentiation",
    "text": "Rate-to-Probability Matrix Exponentiation\nInstead of converting the rates one-by-one, matrix exponentiation is a quicker way to convert all.\nConsidering the covariance of the rates here, it is also more accurate.\nHowever, if we have both rates and probabilities mixed, there will be two steps:\n\nconvert all the probabilities to rates using the conversion formula;\nuse the matrix exponentiation to convert the rate matrix to the probability matrix.\n\n\n\nCode\nm_R = build_matrices(params_sc, \"r\")\nm_P_expm = list()\nfor (m in v_names_str){\n  m_P_expm[[m]] = expm(m_R[[m]])\n}\nm_P_expm\n\n\n$quo\n          Healthy Stage1 Stage2 Stage3 Remission   Death\nHealthy      0.92 0.0413  0.018 0.0086    0.0088 0.00287\nStage1       0.00 0.6649  0.084 0.0072    0.2425 0.00170\nStage2       0.00 0.0500  0.611 0.1057    0.1923 0.04056\nStage3       0.00 0.0015  0.038 0.5035    0.0058 0.45087\nRemission    0.00 0.0827  0.044 0.0036    0.8689 0.00082\nDeath        0.00 0.0000  0.000 0.0000    0.0000 1.00000\n\n$trtA\n          Healthy Stage1 Stage2  Stage3 Remission   Death\nHealthy      0.92 0.0411 0.0182 0.00864    0.0092 0.00287\nStage1       0.00 0.6549 0.0784 0.00693    0.2581 0.00165\nStage2       0.00 0.0420 0.6072 0.10550    0.2048 0.04052\nStage3       0.00 0.0013 0.0382 0.50354    0.0061 0.45087\nRemission    0.00 0.0165 0.0088 0.00071    0.9739 0.00016\nDeath        0.00 0.0000 0.0000 0.00000    0.0000 1.00000\n\n$trtB\n          Healthy Stage1 Stage2 Stage3 Remission  Death\nHealthy      0.92 0.0413  0.018 0.0086    0.0089 0.0029\nStage1       0.00 0.6624  0.081 0.0071    0.2478 0.0017\nStage2       0.00 0.0479  0.609 0.1056    0.1965 0.0405\nStage3       0.00 0.0015  0.038 0.5035    0.0059 0.4509\nRemission    0.00 0.0659  0.027 0.0022    0.9041 0.0005\nDeath        0.00 0.0000  0.000 0.0000    0.0000 1.0000\n\n$trtC\n          Healthy Stage1 Stage2 Stage3 Remission   Death\nHealthy      0.92 0.0412  0.018 0.0086    0.0091 0.00287\nStage1       0.00 0.6586  0.080 0.0070    0.2530 0.00167\nStage2       0.00 0.0449  0.608 0.1056    0.2007 0.04053\nStage3       0.00 0.0014  0.038 0.5035    0.0060 0.45087\nRemission    0.00 0.0412  0.018 0.0014    0.9390 0.00033\nDeath        0.00 0.0000  0.000 0.0000    0.0000 1.00000"
  },
  {
    "objectID": "AddingMortality.html",
    "href": "AddingMortality.html",
    "title": "Add the Time-Varying Variable into Markov Model",
    "section": "",
    "text": "Based on the last tutorial of Markov Model in R, we will add background mortality using a cause-deleted life table."
  },
  {
    "objectID": "AddingMortality.html#where-to-get-the-us-life-table",
    "href": "AddingMortality.html#where-to-get-the-us-life-table",
    "title": "Add the Time-Varying Variable into Markov Model",
    "section": "Where to get the US life table",
    "text": "Where to get the US life table\nhttps://www.cdc.gov/nchs/products/life_tables.htm [CDC website]\nWe are using United States Life Tables(2020) – remember to distinguish the life tables for the male and the female.\nMale: https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/NVSR/71-01/Table02.xlsx\nFemale: https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/NVSR/71-01/Table03.xlsx\n\n\n\nName\nDescription\n\n\n\n\nqx\nProbability of dying between ages x and x + 1\n\n\nlx\nNumber surviving to age x\n\n\ndx\nNumber dying between ages x and x + 1\n\n\nLx\nPerson-years lived between ages x and x + 1\n\n\nTx\nTotal number of person-years lived above age x\n\n\nex\nExpectation of life at age x\n\n\n\n\n\nCode\ninput_file = normalizePath(here(\"exercise/markov_exercise_phd.xlsx\"))\nlife_table_raw = readxl::read_xlsx(input_file,sheet=\"Life Table - Male\",col_types =\"numeric\")[-1,]\nnames(life_table_raw) = c(\"Age\", \"qx\", \"lx\", \"dx\", \"Lx\", \"Tx\", \"ex\")"
  },
  {
    "objectID": "AddingMortality.html#where-to-get-the-specific-cause-death",
    "href": "AddingMortality.html#where-to-get-the-specific-cause-death",
    "title": "Add the Time-Varying Variable into Markov Model",
    "section": "Where to get the specific-cause death",
    "text": "Where to get the specific-cause death\nHere we set all our patients are initially 45-yr men with the prostate cancer.\nhttps://vizhub.healthdata.org/gbd-results/[GBD query tool]\nGBD results provide the % of deaths due to a specific cause by age (every 5 years) and sex groups.\nUsing filters like:"
  },
  {
    "objectID": "AddingMortality.html#how-to-build-the-cause-deleted-life-table",
    "href": "AddingMortality.html#how-to-build-the-cause-deleted-life-table",
    "title": "Add the Time-Varying Variable into Markov Model",
    "section": "How to build the cause-deleted life table",
    "text": "How to build the cause-deleted life table\nThe GBD result of death caused by prostate cancer is divided by age groups, which we need to expand to match the original life table.\nnon-Cause death = all the death * (1 - percent_of_caused_death)\n\n\nCode\ncause_death_m = read.csv(\"exercise/GBD_2019_prostate.csv\") %>%\n  select(age,val,upper,lower)\n\ncause_death_m1 = cause_death_m %>% filter(str_detect(age, \"<\")) %>%\n  mutate(start = 0, \n         reptimes = as.numeric(str_sub(age,\n                                       unlist(gregexpr('<', age))[1]+1,\n                                       unlist(gregexpr(' ', age))[1]-1)),\n         end = start + reptimes - 1)\n\ncause_death_m2 = cause_death_m %>% \n  filter(str_detect(age,\"-\") & !str_detect(age, \" \")) %>%\n  rowwise %>%\n  mutate(start = as.numeric(str_sub(age,1,unlist(gregexpr('-', age))[1]-1)),\n         end = as.numeric(str_sub(age,unlist(gregexpr('-', age))[1]+1,str_length(age))),\n         reptimes = end - start + 1)\n\ncause_death_m3 = cause_death_m %>% filter(str_detect(age,\"-\") & str_detect(age, \" \")) %>%\n  rowwise %>%\n  mutate(start = as.numeric(str_sub(age,1,unlist(gregexpr('-', age))[1]-1)),\n         end = as.numeric(str_sub(age,unlist(gregexpr('-', age))[1]+1,unlist(gregexpr(' ', age))[1]-1)),\n         reptimes = end - start + 1)\n\ncause_death_m4 = cause_death_m %>% filter(str_detect(age, \"[+] \")) %>%\n  rowwise() %>%\n    mutate(end = max(life_table_raw$Age),\n           start = as.numeric(str_sub(age, 1, unlist(gregexpr('[+] ', age))[1]-1)),\n         reptimes = end - start + 1)\n  \ncause_death_male = rbind(\n  as.data.frame(lapply(cause_death_m1, rep, cause_death_m1$reptimes)) %>%\n    group_by(age) %>%\n    mutate(Age = start - 1 + 1:n()) %>%\n    ungroup(),\n  as.data.frame(lapply(cause_death_m2, rep, cause_death_m2$reptimes)) %>%\n    group_by(age) %>%\n    mutate(Age = start - 1 + 1:n()) %>%\n    ungroup(),\n  as.data.frame(lapply(cause_death_m3, rep, cause_death_m3$reptimes)) %>%\n    group_by(age) %>%\n    mutate(Age = start - 1 + 1:n()) %>%\n    ungroup(),\n  as.data.frame(lapply(cause_death_m4, rep, cause_death_m4$reptimes)) %>%\n    group_by(age) %>%\n    mutate(Age = start - 1 + 1:n()) %>%\n    ungroup()) %>%\n  arrange(Age) %>%\n  select(Age, val, upper, lower)\n\nmaxage = min(max(life_table_raw$Age), max(cause_death_male$Age))\nminage_cause = min(cause_death_male$Age)\nmlt2020 = life_table_raw[(minage_cause+1):(maxage+1),]\n\n## dx\nmlt2020_nonCause = rbind(life_table_raw[1:minage_cause, c(\"Age\",\"dx\")],\n                         data.frame(Age = minage_cause:maxage, \n                                    dx = mlt2020[, \"dx\"] * (1-cause_death_male[, \"val\"])))\n\nmlt2020_cause = data.frame(Age = minage_cause:maxage,\n                         dx = mlt2020[, \"dx\"] * cause_death_male[, \"val\"])\n\n# sum(mlt2020_cause$dx) + sum(mlt2020_nonCause$dx)\n\n# directly using the percent and qx\nfor (i in 1:nrow(life_table_raw)) {\n  if (i %in% (minage_cause+1):(maxage+1)) {\n    mlt2020_nonCause[i, \"qx\"] = life_table_raw[i, \"qx\"] * (1-cause_death_male[i - minage_cause, \"val\"])\n  } else {\n    mlt2020_nonCause[i, \"qx\"] = life_table_raw[i, \"qx\"]\n  }\n}\n\n\n# back dx to qx\n# for (i in 1:nrow(mlt2020_nonCause)){\n#   mlt2020_nonCause[i, \"qx\"] = mlt2020_nonCause[i, \"dx\"] / sum(life_table_raw[i:nrow(life_table_raw), \"dx\"])\n# }\n\nwrite.csv(mlt2020_nonCause, \"exercise/cause-deleted-mlt.csv\", row.names = FALSE)"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "About Me",
    "section": "",
    "text": "To construct…"
  },
  {
    "objectID": "bridge_brief.html",
    "href": "bridge_brief.html",
    "title": "BRIDGE Report",
    "section": "",
    "text": "Show the code\nload(\"~/Documents/GitHub/MarkovDA/data/with-drop-out.rda\")"
  },
  {
    "objectID": "bridge_brief.html#participants",
    "href": "bridge_brief.html#participants",
    "title": "BRIDGE Report",
    "section": "Participants",
    "text": "Participants\n\n\nShow the code\nfu %>% distinct(study_arm,record_id) %>% count(study_arm) \n\n\n   study_arm   n\n1:       EUC 893\n2:       TSC 899\n\n\n\n\nShow the code\nfu %>%\n  filter(reason == 1) %>%\n  distinct(study_arm,record_id) %>% count(study_arm)\n\n\n   study_arm   n\n1:       EUC 719\n2:       TSC 743\n\n\n\nDrop-outs\nDrop-outs are participants that has been terminated for their own reasons: moving, unable to contact, refusing to join in and so on.\nAlthough the drop-out rate is more than 10%, the result of our analysis don’t have a evident difference. So we include the records of participants who have been terminated without completion.\n\n\nShow the code\nfu %>%\n  filter(reason != 1) %>%\n  distinct(study_arm,record_id) %>% count(study_arm) %>% rename(drop_out = n) %>%\n  left_join(fu %>% distinct(study_arm,record_id) %>% count(study_arm)) %>%\n  mutate(pct = percent(drop_out/n)) %>% select(-n) %>%\n  kable(caption = \"percent of drop-outs in 2 arms\") %>%\n  kable_styling()\n\n\n\n\npercent of drop-outs in 2 arms\n \n  \n    study_arm \n    drop_out \n    pct \n  \n \n\n  \n    EUC \n    165 \n    18.5% \n  \n  \n    TSC \n    136 \n    15.1% \n  \n\n\n\n\n\n\n\ndemographic\n\ngender\ncity\n\n\n\nShow the code\ngender = fu %>% filter(!is.na(gender)) %>% distinct(record_id, gender, study_arm) \n\ngender %>%\n  mutate(gender=factor(gender,levels=1:2,labels=c(\"Female\",\"Male\"))) %>%\n  count(study_arm, gender) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable(caption = \"Gender in 2 arms for all participants(including drop-outs)\") %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\nGender in 2 arms for all participants(including drop-outs)\n \n  \n    study_arm \n    gender \n    n \n    pct \n  \n \n\n  \n    EUC \n    Female \n    319 \n    36% \n  \n  \n    EUC \n    Male \n    573 \n    64% \n  \n  \n    TSC \n    Female \n    320 \n    36% \n  \n  \n    TSC \n    Male \n    579 \n    64% \n  \n\n\n\n\n\nShow the code\nlocation = fu %>% filter(!is.na(city)) %>% distinct(record_id, city, study_arm) \n\nlocation %>%\n  count(study_arm, city) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable(caption = \"City in 2 arms for all participants(including drop-outs)\") %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\nCity in 2 arms for all participants(including drop-outs)\n \n  \n    study_arm \n    city \n    n \n    pct \n  \n \n\n  \n    EUC \n    Kaduna \n    210 \n    23.5% \n  \n  \n    EUC \n    Kano \n    443 \n    49.6% \n  \n  \n    EUC \n    Zaria \n    240 \n    26.9% \n  \n  \n    TSC \n    Kaduna \n    234 \n    26.0% \n  \n  \n    TSC \n    Kano \n    449 \n    49.9% \n  \n  \n    TSC \n    Zaria \n    216 \n    24.0% \n  \n\n\n\n\n\nShow the code\ndob = fu %>% mutate(bd=as_date(dob)) %>% filter(!is.na(bd)) %>% distinct(record_id,study_arm,bd)\n\nfu %>% filter(reason == 1) %>% distinct(record_id) %>% \n  left_join(fu%>% filter(!is.na(gender)) %>% distinct(record_id, gender, study_arm)) %>%\n  mutate(gender=factor(gender,levels=1:2,labels=c(\"Female\",\"Male\"))) %>%\n  count(study_arm, gender) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable(caption = \"Gender in 2 arms for completed participants\") %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\nGender in 2 arms for completed participants\n \n  \n    study_arm \n    gender \n    n \n    pct \n  \n \n\n  \n    EUC \n    Female \n    266 \n    37% \n  \n  \n    EUC \n    Male \n    453 \n    63% \n  \n  \n    TSC \n    Female \n    261 \n    35% \n  \n  \n    TSC \n    Male \n    482 \n    65% \n  \n\n\n\n\n\nShow the code\nfu %>% filter(reason == 1) %>% distinct(record_id) %>% \n  left_join(fu %>% filter(!is.na(city)) %>% distinct(record_id, city, study_arm)) %>%\n  count(study_arm, city) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable(caption = \"City in 2 arms for completed participants\") %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\nCity in 2 arms for completed participants\n \n  \n    study_arm \n    city \n    n \n    pct \n  \n \n\n  \n    EUC \n    Kaduna \n    153 \n    21.3% \n  \n  \n    EUC \n    Kano \n    369 \n    51.3% \n  \n  \n    EUC \n    Zaria \n    197 \n    27.4% \n  \n  \n    TSC \n    Kaduna \n    179 \n    24.1% \n  \n  \n    TSC \n    Kano \n    393 \n    52.9% \n  \n  \n    TSC \n    Zaria \n    171 \n    23.0% \n  \n\n\n\n\n\n\n\nintervals\nExpected schedule of follow-up visits Only the first follow-up needs to be +/- 3 days, all else allow +/- 14 days.\nSchedule:\n* instance 1 - Week 1\n* instance 2 - Month 1\n* instance 3 - Month 2\n* instance 4 - Month 4\n* instance 5 - Month 6\n* instance 6 - Month 9\n* instance 7 - Month 12\n* instance 8 - Month 15\n* instance 9 - Month 18\n* instance 10 - Month 24\nExpected time interval:\n* v1: 7 +/- 3 from v0\n* v2: 28 +/- 14 from v0\n* v3: 28 +/- 14 from v2\n* v4: 56 +/- 14 from v3\n* v5: 56 +/- 14 from v4\n* v6: 84 +/- 14 from v5\n* v7: 84 +/- 14 from v6\n* v8: 84 +/- 14 from v7\n* v9: 84 +/- 14 from v8\n* v10: 168 +/- 14 from v9\n\n\nShow the code\nbasedate = fu %>% filter(redcap_repeat_instrument==\"diag_enroll\") %>% \n  mutate(datebaseline = as_date(ifelse(ev0 == 1, date_of_consent_screen, dateconsentenroll))) %>% \n  select(record_id, study_arm, ev0, datebaseline) %>% left_join(dob, by = c(\"record_id\", \"study_arm\")) %>% \n  mutate(age = round(as.numeric(datebaseline - bd)/365.25,1))\n\nfudw <- fu %>% filter(redcap_repeat_instrument==\"follow_up_care_form\") %>%\n  select(record_id,study_arm,visit = redcap_repeat_instance,datefu,age = agefu) %>% \n  mutate(date=as_date(datefu), visit=as.numeric(visit)) %>% select(-datefu) %>%\n  bind_rows(basedate %>% select(record_id,study_arm,date = datebaseline,age) %>% mutate(visit=0)) %>%\n  pivot_wider(names_from = visit,\n              values_from = c(date,age)) %>% \n  select(-date_11, -age_11) %>%\n  mutate(d01=as.integer(date_1-date_0),\n         d12=as.integer(date_2-date_1),\n         d23=as.integer(date_3-date_2),\n         d34=as.integer(date_4-date_3),\n         d45=as.integer(date_5-date_4),\n         d56=as.integer(date_6-date_5),\n         d67=as.integer(date_7-date_6),\n         d78=as.integer(date_8-date_7),\n         d89=as.integer(date_9-date_8),\n         d90=as.integer(date_10-date_9))\n\n\n\n\nShow the code\nfudw %>% filter(study_arm==\"EUC\") %>% \n  select(starts_with(\"d\")) %>% \n  select(-starts_with(\"date\")) %>% \n  summary() %>% kable(caption=\"Range of intervals between follow up visits, EUC\")  %>%\n  kable_styling()\n\n\n\n\nRange of intervals between follow up visits, EUC\n \n  \n      \n         d01 \n         d12 \n         d23 \n         d34 \n         d45 \n         d56 \n         d67 \n         d78 \n         d89 \n         d90 \n  \n \n\n  \n     \n    Min.   :-28.000 \n    Min.   :-40.00 \n    Min.   : 0.00 \n    Min.   :  0.00 \n    Min.   :-12.00 \n    Min.   :  0.00 \n    Min.   :  0.0 \n    Min.   : 40.00 \n    Min.   :  0.00 \n    Min.   : 13.0 \n  \n  \n     \n    1st Qu.:  7.000 \n    1st Qu.: 21.00 \n    1st Qu.:28.00 \n    1st Qu.: 56.00 \n    1st Qu.: 56.00 \n    1st Qu.: 83.00 \n    1st Qu.: 84.0 \n    1st Qu.: 83.00 \n    1st Qu.: 82.00 \n    1st Qu.:167.0 \n  \n  \n     \n    Median :  7.000 \n    Median : 21.00 \n    Median :28.00 \n    Median : 56.00 \n    Median : 56.00 \n    Median : 84.00 \n    Median : 84.0 \n    Median : 84.00 \n    Median : 84.00 \n    Median :168.0 \n  \n  \n     \n    Mean   :  8.579 \n    Mean   : 22.09 \n    Mean   :28.49 \n    Mean   : 54.82 \n    Mean   : 55.51 \n    Mean   : 83.23 \n    Mean   : 84.3 \n    Mean   : 84.11 \n    Mean   : 82.89 \n    Mean   :168.6 \n  \n  \n     \n    3rd Qu.:  8.000 \n    3rd Qu.: 21.00 \n    3rd Qu.:28.00 \n    3rd Qu.: 56.00 \n    3rd Qu.: 56.00 \n    3rd Qu.: 84.00 \n    3rd Qu.: 85.0 \n    3rd Qu.: 84.00 \n    3rd Qu.: 84.00 \n    3rd Qu.:172.0 \n  \n  \n     \n    Max.   :154.000 \n    Max.   :121.00 \n    Max.   :85.00 \n    Max.   :129.00 \n    Max.   :219.00 \n    Max.   :183.00 \n    Max.   :161.0 \n    Max.   :174.00 \n    Max.   :234.00 \n    Max.   :217.0 \n  \n  \n     \n    NA's   :9 \n    NA's   :18 \n    NA's   :33 \n    NA's   :49 \n    NA's   :78 \n    NA's   :104 \n    NA's   :117 \n    NA's   :126 \n    NA's   :142 \n    NA's   :156 \n  \n\n\n\n\n\nShow the code\nfudw %>% filter(study_arm==\"TSC\") %>% \n  select(starts_with(\"d\")) %>% \n  select(-starts_with(\"date\")) %>% \n  summary() %>% kable(caption=\"Range of intervals between follow up visits, TSC\")  %>%\n  kable_styling()\n\n\n\n\nRange of intervals between follow up visits, TSC\n \n  \n      \n         d01 \n         d12 \n         d23 \n         d34 \n         d45 \n         d56 \n         d67 \n         d78 \n         d89 \n         d90 \n  \n \n\n  \n     \n    Min.   :-307.000 \n    Min.   :-10.00 \n    Min.   :-56.00 \n    Min.   :-49.00 \n    Min.   : -7.00 \n    Min.   :-281.00 \n    Min.   : 11.00 \n    Min.   :  0.00 \n    Min.   :-650.00 \n    Min.   :-198.0 \n  \n  \n     \n    1st Qu.:   7.000 \n    1st Qu.: 21.00 \n    1st Qu.: 28.00 \n    1st Qu.: 56.00 \n    1st Qu.: 56.00 \n    1st Qu.:  84.00 \n    1st Qu.: 84.00 \n    1st Qu.: 84.00 \n    1st Qu.:  82.00 \n    1st Qu.: 167.0 \n  \n  \n     \n    Median :   7.000 \n    Median : 21.00 \n    Median : 28.00 \n    Median : 56.00 \n    Median : 56.00 \n    Median :  84.00 \n    Median : 84.00 \n    Median : 84.00 \n    Median :  84.00 \n    Median : 168.0 \n  \n  \n     \n    Mean   :   7.656 \n    Mean   : 22.93 \n    Mean   : 29.25 \n    Mean   : 54.34 \n    Mean   : 55.48 \n    Mean   :  83.19 \n    Mean   : 84.45 \n    Mean   : 83.78 \n    Mean   :  83.08 \n    Mean   : 169.6 \n  \n  \n     \n    3rd Qu.:   8.000 \n    3rd Qu.: 23.00 \n    3rd Qu.: 28.00 \n    3rd Qu.: 56.00 \n    3rd Qu.: 56.00 \n    3rd Qu.:  84.00 \n    3rd Qu.: 84.00 \n    3rd Qu.: 84.00 \n    3rd Qu.:  84.00 \n    3rd Qu.: 171.0 \n  \n  \n     \n    Max.   : 103.000 \n    Max.   :153.00 \n    Max.   :169.00 \n    Max.   :167.00 \n    Max.   :112.00 \n    Max.   : 157.00 \n    Max.   :448.00 \n    Max.   :168.00 \n    Max.   : 445.00 \n    Max.   : 901.0 \n  \n  \n     \n    NA's   :28 \n    NA's   :39 \n    NA's   :55 \n    NA's   :68 \n    NA's   :80 \n    NA's   :91 \n    NA's   :105 \n    NA's   :109 \n    NA's   :117 \n    NA's   :135 \n  \n\n\n\n\n\nShow the code\npf <- function(v,m,t) {\n  vv <- enquo(v)\n  m1 <- fudw %>% pull(!!vv) %>% min(na.rm = T)\n  m2 <- fudw %>% pull(!!vv) %>% max(na.rm = T)\n  \n  p <- fudw %>% ggplot(aes(x=study_arm,y=!!vv)) +\n    geom_boxplot() +\n    scale_y_continuous(breaks = c(m1,-100,0,m,100,m2))  +\n    coord_flip() + theme_minimal() +\n    ggtitle(t)\n  print(p)\n}\n\npf(d01,7,\"Baseline-FU1: expected 1 week\")\n\n\n\n\n\nShow the code\npf(d12,21,\"FU1-FU2: expected 3 weeks\")\n\n\n\n\n\nShow the code\npf(d23,28,\"FU2-FU3: expected 4 weeks\")\n\n\n\n\n\nShow the code\npf(d34,56,\"FU3-FU4: expected 8 weeks\")\n\n\n\n\n\nShow the code\npf(d45,56,\"FU4-FU5: expected 8 weeks\")\n\n\n\n\n\nShow the code\npf(d56,84,\"FU5-FU6: expected 12 weeks\")\n\n\n\n\n\nShow the code\npf(d67,84,\"FU6-FU7: expected 12 weeks\")\n\n\n\n\n\nShow the code\npf(d78,84,\"FU7-FU8: expected 12 weeks\")"
  },
  {
    "objectID": "bridge_brief.html#instruments",
    "href": "bridge_brief.html#instruments",
    "title": "BRIDGE Report",
    "section": "Instruments",
    "text": "Instruments\n\nVAS\n\nFor all ages, for all follow up visits\n\nQOLIE\n\nQOLIE-AD-48: for 11 < age < 17\nQOLIE-31: for age > 17\n3 times totally, should be screening(month 0), month 2, month 24.\nQuestion 16 and 18 (Cramer, 1999) in QOLIE-AD-48 are missing and then ignored from the survey.\n\n\n\n\nShow the code\n####score qolie 31####\n\nscore_q31 <- function(df) {\n  d1 <- df %>% mutate(\n    #seizure worry\n    sw1=ifelse(q11==1,0,NA),\n    sw1=ifelse(q11==2,20, sw1),\n    sw1=ifelse(q11==3,40, sw1),\n    sw1=ifelse(q11==4,60, sw1),\n    sw1=ifelse(q11==5,80, sw1),\n    sw1=ifelse(q11==6,100,sw1),\n    \n    sw2=ifelse(q21==1,0,NA),\n    sw2=ifelse(q21==2,33.3,sw2),\n    sw2=ifelse(q21==3,66.7,sw2),\n    sw2=ifelse(q21==4,100, sw2),\n    \n    sw3=ifelse(q22==1,0,NA),\n    sw3=ifelse(q22==2,50, sw3),\n    sw3=ifelse(q22==3,100,sw3),\n    \n    sw4=ifelse(q23==1,0,NA),\n    sw4=ifelse(q23==2,33.3,sw4),\n    sw4=ifelse(q23==3,66.7,sw4),\n    sw4=ifelse(q23==4,100, sw4),\n    \n    sw5=ifelse(q25==1,100,NA),\n    sw5=ifelse(q25==2,75,sw5),\n    sw5=ifelse(q25==3,50,sw5),\n    sw5=ifelse(q25==4,25,sw5),\n    sw5=ifelse(q25==5,0, sw5)\n  ) %>% mutate(\n    #overall quality of life\n    ql1=q1*10,\n    \n    ql2=ifelse(q14==1,100,NA),\n    ql2=ifelse(q14==2,75,ql2),\n    ql2=ifelse(q14==3,50,ql2),\n    ql2=ifelse(q14==4,25,ql2),\n    ql2=ifelse(q14==5,0, ql2)\n  ) %>% mutate(\n    #emotional well-being\n    ew1=ifelse(q3==1,0,NA),\n    ew1=ifelse(q3==2,20, ew1),\n    ew1=ifelse(q3==3,40, ew1),\n    ew1=ifelse(q3==4,60, ew1),\n    ew1=ifelse(q3==5,80, ew1),\n    ew1=ifelse(q3==6,100,ew1),\n    \n    ew2=ifelse(q4==1,0,NA),\n    ew2=ifelse(q4==2,20, ew2),\n    ew2=ifelse(q4==3,40, ew2),\n    ew2=ifelse(q4==4,60, ew2),\n    ew2=ifelse(q4==5,80, ew2),\n    ew2=ifelse(q4==6,100,ew2),\n    \n    ew3=ifelse(q5==1,100,NA),\n    ew3=ifelse(q5==2,80,ew3),\n    ew3=ifelse(q5==3,60,ew3),\n    ew3=ifelse(q5==4,40,ew3),\n    ew3=ifelse(q5==5,20,ew3),\n    ew3=ifelse(q5==6,0, ew3),\n    \n    ew4=ifelse(q7==1,0,NA),\n    ew4=ifelse(q7==2,20, ew4),\n    ew4=ifelse(q7==3,40, ew4),\n    ew4=ifelse(q7==4,60, ew4),\n    ew4=ifelse(q7==5,80, ew4),\n    ew4=ifelse(q7==6,100,ew4),\n    \n    ew5=ifelse(q9==1,100,NA),\n    ew5=ifelse(q9==2,80,ew5),\n    ew5=ifelse(q9==3,60,ew5),\n    ew5=ifelse(q9==4,40,ew5),\n    ew5=ifelse(q9==5,20,ew5),\n    ew5=ifelse(q9==6,0, ew5),\n  ) %>% mutate(\n    #energy/fatigue\n    ef1=ifelse(q2==1,100,NA),\n    ef1=ifelse(q2==2,80,ef1),\n    ef1=ifelse(q2==3,60,ef1),\n    ef1=ifelse(q2==4,40,ef1),\n    ef1=ifelse(q2==5,20,ef1),\n    ef1=ifelse(q2==6,0, ef1),\n    \n    ef2=ifelse(q6==1,100,NA),\n    ef2=ifelse(q6==2,80,ef2),\n    ef2=ifelse(q6==3,60,ef2),\n    ef2=ifelse(q6==4,40,ef2),\n    ef2=ifelse(q6==5,20,ef2),\n    ef2=ifelse(q6==6,0, ef2),\n    \n    ef3=ifelse(q8==1,0,NA),\n    ef3=ifelse(q8==2,20, ef3),\n    ef3=ifelse(q8==3,40, ef3),\n    ef3=ifelse(q8==4,60, ef3),\n    ef3=ifelse(q8==5,80, ef3),\n    ef3=ifelse(q8==6,100,ef3),\n    \n    ef4=ifelse(q10==1,0,NA),\n    ef4=ifelse(q10==2,20, ef4),\n    ef4=ifelse(q10==3,40, ef4),\n    ef4=ifelse(q10==4,60, ef4),\n    ef4=ifelse(q10==5,80, ef4),\n    ef4=ifelse(q10==6,100,ef4),\n  ) %>% mutate(\n    #cognitive\n    cg1=ifelse(q12==1,0,NA),\n    cg1=ifelse(q12==2,20, cg1),\n    cg1=ifelse(q12==3,40, cg1),\n    cg1=ifelse(q12==4,60, cg1),\n    cg1=ifelse(q12==5,80, cg1),\n    cg1=ifelse(q12==6,100,cg1),\n    \n    cg2=ifelse(q15==1,0,NA),\n    cg2=ifelse(q15==2,33.3,cg2),\n    cg2=ifelse(q15==3,66.7,cg2),\n    cg2=ifelse(q15==4,100, cg2),\n    \n    cg3=ifelse(q16==1,0,NA),\n    cg3=ifelse(q16==2,20, cg3),\n    cg3=ifelse(q16==3,40, cg3),\n    cg3=ifelse(q16==4,60, cg3),\n    cg3=ifelse(q16==5,80, cg3),\n    cg3=ifelse(q16==6,100,cg3),\n    \n    cg4=ifelse(q17==1,0,NA),\n    cg4=ifelse(q17==2,20, cg4),\n    cg4=ifelse(q17==3,40, cg4),\n    cg4=ifelse(q17==4,60, cg4),\n    cg4=ifelse(q17==5,80, cg4),\n    cg4=ifelse(q17==6,100,cg4),\n    \n    cg5=ifelse(q18==1,0,NA),\n    cg5=ifelse(q18==2,20, cg5),\n    cg5=ifelse(q18==3,40, cg5),\n    cg5=ifelse(q18==4,60, cg5),\n    cg5=ifelse(q18==5,80, cg5),\n    cg5=ifelse(q18==6,100,cg5),\n    \n    cg6=ifelse(q26==1,100,NA),\n    cg6=ifelse(q26==2,75,cg6),\n    cg6=ifelse(q26==3,50,cg6),\n    cg6=ifelse(q26==4,25,cg6),\n    cg6=ifelse(q26==5,0, cg6)\n  ) %>% mutate(\n    #medication effects\n    me1=ifelse(q24==1,0,NA),\n    me1=ifelse(q24==2,33.3,me1),\n    me1=ifelse(q24==3,66.7,me1),\n    me1=ifelse(q24==4,100, me1),\n    \n    me2=ifelse(q29==1,100,NA),\n    me2=ifelse(q29==2,75,me2),\n    me2=ifelse(q29==3,50,me2),\n    me2=ifelse(q29==4,25,me2),\n    me2=ifelse(q29==5,0, me2),\n    \n    me3=ifelse(q30==1,100,NA),\n    me3=ifelse(q30==2,75,me3),\n    me3=ifelse(q30==3,50,me3),\n    me3=ifelse(q30==4,25,me3),\n    me3=ifelse(q30==5,0, me3)\n  ) %>% mutate(\n    #social function\n    sf1=ifelse(q13==1,0,NA),\n    sf1=ifelse(q13==2,20, sf1),\n    sf1=ifelse(q13==3,40, sf1),\n    sf1=ifelse(q13==4,60, sf1),\n    sf1=ifelse(q13==5,80, sf1),\n    sf1=ifelse(q13==6,100,sf1),\n    \n    sf2=ifelse(q19==1,0,NA),\n    sf2=ifelse(q19==2,25, sf2),\n    sf2=ifelse(q19==3,50, sf2),\n    sf2=ifelse(q19==4,75, sf2),\n    sf2=ifelse(q19==5,100,sf2),\n    \n    sf3=ifelse(q20==1,0,NA),\n    sf3=ifelse(q20==2,25, sf3),\n    sf3=ifelse(q20==3,50, sf3),\n    sf3=ifelse(q20==4,75, sf3),\n    sf3=ifelse(q20==5,100,sf3),\n    \n    sf4=ifelse(q27==1,100,NA),\n    sf4=ifelse(q27==2,75,sf4),\n    sf4=ifelse(q27==3,50,sf4),\n    sf4=ifelse(q27==4,25,sf4),\n    sf4=ifelse(q27==5,0, sf4),\n    \n    sf5=ifelse(q28==1,100,NA),\n    sf5=ifelse(q28==2,75,sf5),\n    sf5=ifelse(q28==3,50,sf5),\n    sf5=ifelse(q28==4,25,sf5),\n    sf5=ifelse(q28==5,0, sf5)\n  )\n  \n  #summarise: what to do with missing item? currently averaging by domain\n  d1 %>% rowwise() %>% \n    mutate(sum_sw=mean(c(sw1,sw2,sw3,sw4,sw5),na.rm = T),\n           sum_ql=mean(c(ql1,ql2),na.rm = T),\n           sum_ew=mean(c(ew1,ew2,ew3,ew4,ew5),na.rm = T),\n           sum_ef=mean(c(ef1,ef2,ef3,ef4),na.rm = T),\n           sum_cg=mean(c(cg1,cg2,cg3,cg4,cg5,cg6),na.rm = T),\n           sum_me=mean(c(me1,me2,me3),na.rm = T),\n           sum_sf=mean(c(sf1,sf2,sf3,sf4,sf5),na.rm = T)\n    ) %>% ungroup() %>% \n    mutate(overall=sum_sw*0.08+sum_ql*0.14+sum_ew*0.15+sum_ef*0.12+\n             sum_cg*0.27+sum_me*0.03+sum_sf*0.21)\n  #what if missing one domain?\n  # return(d2)\n}\n\n\n\n\nShow the code\n# score for questions that have 5-point\nsc5 <- function(dt,vf,vt) {\n  v1 <- vf\n  v1 <- ensym(v1)\n  dd <- dt %>% select(!!v1) %>%\n    mutate(v=ifelse(!!v1==1,0,NA),\n           v=ifelse(!!v1==2,25, v),\n           v=ifelse(!!v1==3,50, v),\n           v=ifelse(!!v1==4,75, v),\n           v=ifelse(!!v1==5,100,v)) %>% \n    select(-!!v1)\n  names(dd) <- vt\n  return(dd)\n}\n\n\n#score for questions that have 4-point\nsc4 <- function(dt,vf,vt) {\n  v1 <- vf\n  v1 <- ensym(v1)\n  dd <- dt %>% select(!!v1) %>%\n    mutate(v=ifelse(!!v1==1,0,NA),\n           v=ifelse(!!v1==2,33.3, v),\n           v=ifelse(!!v1==3,66.7, v),\n           v=ifelse(!!v1==4,100,  v)) %>% \n    select(-!!v1)\n  names(dd) <- vt\n  return(dd)\n}\n\n#missing 16,18 for now\nscore_q48 <- function(df) {\n  #epilepsy impact\n  ei <- list(\n    lq = paste0(\"q\",c(25,26,28:34,36,47,48)),\n    lv = paste0(\"ei\",1:12)\n  )\n  r_ei <- map2(ei$lq,ei$lv,~sc5(dt=df,vf=.x,vt=.y)) %>% bind_cols()\n  \n  #memory/concentration\n  mc <- list(\n    # lq = paste0(\"q\",c(8,12:20)),\n    lq = paste0(\"q\",c(8,12:15,17,19,20)),\n    # lv = paste0(\"mc\",1:10)\n    lv = paste0(\"mc\",1:8)\n  ) \n  r_mc <- map2(mc$lq,mc$lv,~sc5(dt=df,vf=.x,vt=.y))  %>% bind_cols()\n  \n  #attitudes toward epilepsy\n  at <- list(\n    lq = paste0(\"q\",c(43:46)),\n    lv = paste0(\"at\",1:4)\n  ) \n  r_at <- map2(at$lq,at$lv,~sc5(dt=df,vf=.x,vt=.y))  %>% bind_cols()\n  \n  #physical functioning\n  pf <- list(\n    lq = paste0(\"q\",c(3:7)),\n    lv = paste0(\"pf\",1:5)\n  ) \n  r_pf <- map2(pf$lq,pf$lv,~sc5(dt=df,vf=.x,vt=.y))  %>% bind_cols()\n  \n  #stigma (4 category)\n  st <- list(\n    lq = paste0(\"q\",c(37:42)),\n    lv = paste0(\"st\",1:6)\n  ) \n  r_st <- map2(st$lq,st$lv,~sc4(dt=df,vf=.x,vt=.y))  %>% bind_cols()\n  \n  #social support\n  ss <- list(\n    lq = paste0(\"q\",c(21:24)),\n    lv = paste0(\"ss\",1:4)\n  ) \n  r_ss <- map2(ss$lq,ss$lv,~sc5(dt=df,vf=.x,vt=.y))  %>% bind_cols()\n  \n  #school behavior\n  sb <- list(\n    lq = paste0(\"q\",c(9:11,27)),\n    lv = paste0(\"sb\",1:4)\n  ) \n  r_sb <- map2(sb$lq,sb$lv,~sc5(dt=df,vf=.x,vt=.y))  %>% bind_cols()\n  \n  #health perceptions\n  hp <- list(\n    lq = paste0(\"q\",c(1,2,35)),\n    lv = paste0(\"hp\",1:3)\n  ) \n  r_hp <- map2(hp$lq,hp$lv,~sc5(dt=df,vf=.x,vt=.y))  %>% bind_cols()\n  \n  #summarise: what to do with missing item? currently averaging by domain\n  d1 <- bind_cols(r_ei,r_mc,r_at,r_pf,r_st,r_ss,r_sb,r_hp) %>% rowwise() %>% \n    mutate(sum_ei=mean(c_across(ei1:ei12),na.rm = T),\n           # sum_mc=mean(c_across(mc1:mc10),na.rm = T),\n           sum_mc=mean(c_across(mc1:mc8),na.rm = T),\n           sum_at=mean(c_across(at1:at4),na.rm = T),\n           sum_pf=mean(c_across(pf1:pf5),na.rm = T),\n           sum_st=mean(c_across(st1:st6),na.rm = T),\n           sum_ss=mean(c_across(ss1:ss4),na.rm = T),\n           sum_sb=mean(c_across(sb1:sb4),na.rm = T),\n           sum_hp=mean(c_across(hp1:hp3),na.rm = T)\n    ) %>% ungroup() %>% \n    mutate(overall=sum_ei*0.31+\n             sum_mc*0.17+\n             sum_at*0.09+\n             sum_pf*0.09+\n             sum_st*0.13+\n             sum_ss*0.02+\n             sum_sb*0.06+\n             sum_hp*0.12)\n}\n\n\n\ninclusion criteria\n\nVAS\nif Missed_fu is\n\n“No”,\n“No missed”,\n“None”,\n“N0”,\n“Not missed”,\n“NO”,\n“No miss”,\n“No messing”,\n“No missen”,\n“No missing”,\n“0”,\n“On time” the response will be included.\n\nFor the NA(blank answers) and “Visit Done”, we have no reasons to set them all as missing or not missing.\nSo I use the important indices(follow_up_care_form_complete, confirmseize, weight_fu_v2, confirm_seizure_class_v2) to distinguish whether they are actually missing or not.\n\n\nShow the code\nfcf = fu  %>%\n  filter(redcap_repeat_instrument==\"follow_up_care_form\") %>% \n  mutate(incomplete=\n           ifelse(follow_up_care_form_complete<2 | is.na(confirmseize) | is.na(weight_fu_v2) | is.na(seizeclass),1,0)) %>%\n  mutate(missed = ifelse(missed_fu %in% c(\"No\", \"No missed\", \"None\", \"N0\", \"Not missed\", \"NO\", \"No miss\", \"No missing\", \"No messing\", \"No missen\", \"0\", \"On time\") | ((str_detect(missed_fu, \"Visit done\") | str_detect(missed_fu, \"Visit Done\") | is.na(missed_fu)) & incomplete == 0), 0, 1))\n\nfcf_c = fcf %>%\n  filter(missed == 0)\n\nfcf_c %>%\n  count(incomplete, missed_fu,sort = TRUE) %>%\n  left_join(fcf_c %>% count(missed_fu), by = c(\"missed_fu\"), suffix = c(\"_inclusive\", \"_in_and_ex\")) %>%\n  mutate(pct = percent(n_inclusive / n_in_and_ex)) %>%\n  kable(caption = \"incomplete = 0 means completing all the key questions\") %>%\n  kable_styling() %>%\n  scroll_box(height = \"400px\")\n\n\n\n\nincomplete = 0 means completing all the key questions\n \n  \n    incomplete \n    missed_fu \n    n_inclusive \n    n_in_and_ex \n    pct \n  \n \n\n  \n    0 \n    NA \n    14979 \n    14979 \n    100% \n  \n  \n    0 \n    No \n    269 \n    269 \n    100% \n  \n  \n    0 \n    No missed \n    64 \n    64 \n    100% \n  \n  \n    0 \n    None \n    44 \n    44 \n    100% \n  \n  \n    0 \n    N0 \n    39 \n    39 \n    100% \n  \n  \n    0 \n    Not missed \n    14 \n    14 \n    100% \n  \n  \n    0 \n    NO \n    13 \n    13 \n    100% \n  \n  \n    0 \n    0 \n    10 \n    10 \n    100% \n  \n  \n    0 \n    Visit done, the CHW was sick. \n    4 \n    4 \n    100% \n  \n  \n    0 \n    No missing \n    2 \n    2 \n    100% \n  \n  \n    0 \n    Visit done the patient travelled for sallah break. \n    2 \n    2 \n    100% \n  \n  \n    0 \n    Visit done. I was sick at the follow up time. \n    2 \n    2 \n    100% \n  \n  \n    0 \n    Visit done. The patient travelled. \n    2 \n    2 \n    100% \n  \n  \n    0 \n    No messing \n    1 \n    1 \n    100% \n  \n  \n    0 \n    No missen \n    1 \n    1 \n    100% \n  \n  \n    0 \n    On time \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done, Patient travelled with his mother \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done, the CHW put to bed a baby during the follow up period and was unable to bring the tablet for synching. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done, the CHW was nursing her sick infant child during the follow up period. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done, the CHW was sick and couldn't get the follow up on time. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done. I was sick. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done. It is a phone visit, because the patient has moved to other part of the state and they couldn't get measuring scale for height, head and arm circumference. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done. The parent couldn't be reached. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done. The patient didn't come on the appointed date due to his mother's ilness. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done. The patient travelled to Jigawa State. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done. The patient travelled to another state in Nigeria which resulted in the delay for this follow up. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit Done. The patient's mother was not around. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done but the child lost wight becouse she have fever and abd pain send to  Dr to see at Hospital \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done child have fever send Dr see \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done no seizures but the child is very slim due to lack of food my the mother \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done the child didn't not have seizures but her condition is not good and wight is lost and no fever or diarrhoes  l send them to see  a Dr that  Hospital \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done, The CHW was sick during the follow up period. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done, but it was late because the patient travelled to Funtua LGA in Katsina State where there is not network communication. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done, the CHW was nursing her child during the follow up period. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done, the patient travelled and are now back home. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done, the patient travelled but are now back home. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done, the patient travelled for sallah break \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. At first, the father said they travel for wedding, and they will spend 2 weeks, so after 2 weeks i call there number is not going so i desided to pay them a visit, today 6 oct 2021, yet the mother said she cannot go for BP today. she said she will make it next week. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. I was ill during the time of the visit, i could not do it on time! \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. I was sick - therefore, the visit was delayed. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. I was sick during the appointment date. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. I was sick during the follow up visif,so i could not do it on time. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. I was sick during the follow up visit, that is why the follow up was delay. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. It was delayed because the patient travelled. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. It was delayed because they relocated and their line was unreachable. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. It was delayed due to the fact that the father who normally brings the child to the followup was sick. Moreover, the CHW figured financial constraints with the father and intended to give a helping hand but they couldn't be reached via phone afterwards until 3 weeks ago. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. Patient couldn't be reached. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. Patient relocated but we tracked them and they are able to come for both blinded physician and CHW visits today. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. She travelled at follow up time. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The CHW lost contact with the parents of the child until last Monday. As such, the visit is measured late. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The CHW regains contact with the mother of the child after over 3 months of tireless tracking. The mother travelled to Niger Republic. The notification of the journey to the CHW failed. She told the CHW that, the child has been on the AED while they were away (abroad). \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The CHW was sick at the time of the visit. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The child had diarrhoea which made him loose 3kg of weight. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The child had lost in weight due to malaria fever. But she has recovered. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The delay was due to the fact their phone was unreachable. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The follow up was done within the window. The CHW lost her father and was in mourning. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The increased in previous weight occurs due to problem of weighing scale used before receiving the new one for the study. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The mother can not afford to buy the drug any more due to financial constraints, and the father is not giving any help.That is why the mother is trying to switch to traditional medicine but unfortunately the traditional healer deceived them and collect their money without treating her and ran away. This is what her Aunty told me the time I went to the house where they used to reside if they are coming for follow up and other schedules, because I couldn't reach them on phone.\n\nI have collected their full current residential address  for tracing. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The mother was sick. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The parent relocated to Yobe state. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The parent's phone couldn't be reached. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The parents relocated to a new location without notice and their contact couldn't be reached until last Thursday 2nd September 2021. Therefore, the visit was delayed. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The patient is currently living with her grandmother in Abuja. She's returning to Kano only when secondary schools closes for sessional holidays. As such, the followup visit was delayed. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The patient traveled at the appointment date. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The patient travelled since before Sallah break. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The patient travelled to their Village. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The patient travelled. Later, I was sick and admitted into hospital. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The patient was missing since mid June 2021. Parents were lucky to find the child end of August 2021. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The reason it was delayed is because the patient travelled. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. The visit wasn't done at appointment date because his mother was sick at the time. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They missed appointment because of transportion. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They patient travelled outside Kano. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They temporarily relocated to Lagos. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They travel at the appointment date. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They traveled at the appointment date. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They traveled. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They travelled at the follow up time. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They travelled to Bauchi state at that time. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done. They were not around at that time. \n    1 \n    1 \n    100% \n  \n  \n    0 \n    Visit done.The patient was not available on the exact follow up day. \n    1 \n    1 \n    100% \n  \n\n\n\n\n\nShow the code\nfcf_c = fcf_c %>% select(-gender) %>% left_join(gender, by = c(\"record_id\", \"study_arm\"))\n\n\n\n\nQOLIE\nSource\n\nfrom both Screening and Follow up visits;\nincluding both QOLIE-31 and QOLIE-AD-48.\n\nLogic for selecting same-day QOLIE records\nFor every participant, if there exists 2 QOLIE records on the same day,\n\nchoose the one with type(QOLIE-31/QOLIE-AD-48) more eligible for the age(11-17 use QOLIE-AD-48, >18 use QOLIE-31);\nif the same QOLIE type, choose the one with less missing domain and less missing items;\nif still the same, choose the one with bigger instance.\n\nLogic for i-th QOLIE\nFor every participant,\n\nthe baseline date is obtained from date_consent_screen or dataconsentenroll, choosing one based on ev0;\n0th QOLIE(first): the first occurence of QOLIE records, no matter whether the date is on or before or after the baseline date, and no matter whether the record is from Screening or Follow up Visits, except from one case: the date is after “2022-01-01”;\n3rd QOLIE(last): the last time of QOLIE records and the date is after “2022-01-01”. For those who have only one time QOLIE record, if the date is after “2022-01-01”, the record will be labeled as the 3-rd, as the participants are only old enough(>11) for the last time of visits(maybe we can compare their previous VAS score and this time of QOLIE);\n1st or 2nd: the ones between the 0th and 3rd. For participants with 4 times of QOLIE and participants with 2 times of after-“2022-01-01” QOLIE, the 2nd will be filled – they could also be dropped as they are not so consistent with the schedule;\nFor the records with “NA” dates, the order will depend on the instance. I prefer to put them on the 2nd, as they might be dropped as the data includes too much noises.\n\n\n\nShow the code\nq31_fu = fu %>% filter(redcap_repeat_instrument==\"qolie_31_17_v0_m2_m24\") %>% \n  select(record_id, study_arm, starts_with(\"red\"), contains(\"qolie31\"), complete = qolie_31_17_v0_m2_m24_complete) %>% \n  rename_at(vars(starts_with(\"qolie31_q\")),~str_remove(.,\"qolie31_\")) %>%\n  mutate(form = \"Follow Up Visits\")\n\nq31_scr = bs %>% filter(qolie_31_17_v0_complete == \"2\") %>% \n  select(record_id = unique_id, study_arm, starts_with(\"red\"), contains(\"qolie31\"), complete = qolie_31_17_v0_complete,-redcap_event_name) %>% \n  rename_at(vars(starts_with(\"qolie31_q\")),~str_remove(.,\"qolie31_\")) %>%\n  mutate(form = \"Screening\")\n\nq31 = rbind.data.frame(q31_scr, q31_fu)\n\nq48_fu <- fu %>% filter(redcap_repeat_instrument==\"qolie_48_1117_v0_m2_m24\") %>% \n  select(record_id,study_arm,starts_with(\"red\"),contains(\"qolie48\"), complete = qolie_48_1117_v0_m2_m24_complete) %>% \n  mutate(form = \"Follow Up Visits\")\n\nq48_scr = bs %>% filter(qolie_48_1117_v0_complete == \"2\") %>% \n  select(record_id = unique_id, study_arm, starts_with(\"red\"), contains(\"qolie48\"), complete = qolie_48_1117_v0_complete,-redcap_event_name) %>% \n  mutate(form = \"Screening\")\n\nq48 = rbind.data.frame(q48_scr, q48_fu)\n\n\n\n\nShow the code\n# QOLIE-31\nr31 <-  score_q31(q31) \n\nr31x <- r31 %>% rowwise() %>% \n  mutate(miss_item=sum(is.na(c_across(sw1:sf5))),\n         miss_domain=sum(is.na(c_across(starts_with(\"sum\")))))\n\n# QOLIE-AD-48\nxwalk <- readxl::read_xlsx(\"~/Documents/GitHub/MarkovDA/data/qolie48_xwalk.xlsx\")\n\nvv = data.frame(vn_redcap=names(q48),x=1:length(names(q48)),stringsAsFactors = F) %>%\n  left_join(xwalk, by = \"vn_redcap\") \n# there will be NA\n\n#rename survey question to align with original questionnaire\nfor(i in 1:nrow(vv)) {\n  if (is.na(vv$vn_Cramer[i])) {\n    vv$vn_Cramer[i] = vv$vn_redcap[i]\n  }\n}\n\nnames(q48) = vv$vn_Cramer\n\nr48p <- score_q48(q48) \nr48 <- bind_cols(q48,r48p)\n\nr48x <- r48 %>% rowwise() %>% \n  mutate(miss_item=sum(is.na(c_across(ei1:hp3))),\n         miss_domain=sum(is.na(c_across(starts_with(\"sum\")))))\n\n\n\n\nShow the code\nallqolie = r48x %>% mutate(type = \"QOLIE-AD-48\") %>%\n  select(record_id, study_arm, dateqolie = dateqolie48, score = overall, type, instance = redcap_repeat_instance, miss_item, miss_domain) %>% \n  full_join(r31x %>% mutate(type = \"QOLIE-31\") %>% \n              select(record_id, study_arm, dateqolie = dateqolie31, score = overall, type, instance = redcap_repeat_instance, miss_item, miss_domain)) %>% \n  left_join(basedate %>% select(-age), by = c(\"record_id\", \"study_arm\")) %>% \n  filter(!is.nan(score)) \n\nallqolie = allqolie %>% count(record_id, sort = TRUE) %>% rename(qolietimes = n) %>% left_join(allqolie) %>%\n  mutate(age = as.numeric(dateqolie - bd)/365.25, eligibility = ifelse(age > 17, \"QOLIE-31\", ifelse(age < 11, \"VAS\", \"QOLIE-AD-48\"))) %>%\n  arrange(desc(qolietimes), record_id, dateqolie, desc(miss_domain), desc(miss_item), instance)\n\n\n\n\nShow the code\n## repeat -- same day twice\nrepeated = allqolie %>% group_by(record_id) %>% count(dateqolie) %>% filter(n > 1) %>% rename(repeattime = n)\n# All of ns are 2. \n\nrepeatqolie = allqolie %>% left_join(repeated) %>% filter(repeattime == 2) %>% mutate(remove = 0)\n\nfor (i in seq(1,nrow(repeatqolie),2)){\n  ## first -- type\n  if (repeatqolie[i,\"type\"] != repeatqolie[i+1,\"type\"]){\n    if (repeatqolie[i,\"type\"] == repeatqolie[i, \"eligibility\"]){\n      repeatqolie[i+1, \"remove\"] = 1\n    } else {\n      repeatqolie[i, \"remove\"] = 1\n    }\n  } else {\n    ## then -- miss_item\n    if (repeatqolie[i,\"miss_item\"] != repeatqolie[i+1, \"miss_item\"]) {\n      max_item = max(repeatqolie[i,\"miss_item\"], repeatqolie[i+1,\"miss_item\"])\n      if (repeatqolie[i,\"miss_item\"] == max_item) {\n        repeatqolie[i,\"remove\"] = 1\n      } else {\n        repeatqolie[i+1,\"remove\"] = 1\n      }\n    } else {\n      ## asc(instance) so smaller instance will be removed\n      repeatqolie[i,\"remove\"] = 1\n    }\n  }\n}\n\nallqolie_c = allqolie %>% left_join(repeatqolie) %>% filter(remove == 0 | is.na(remove)) %>% select(-repeattime, -remove, -qolietimes)\nallqolie_c = allqolie_c %>% count(record_id, sort = TRUE) %>% rename(qolietimes = n) %>% left_join(allqolie_c)\n\n## order = 0\norder0 = allqolie_c %>% filter(!is.na(dateqolie)) %>% group_by(record_id) %>% filter(dateqolie == min(dateqolie)) %>%\n  ungroup() %>% filter(dateqolie < \"2022-01-01\") %>% mutate(order = 0)\n\n## order = 3\norder3 = allqolie_c %>% filter(!is.na(dateqolie)) %>% group_by(record_id) %>% filter(dateqolie == max(dateqolie)) %>% \n  ungroup() %>% filter(dateqolie >= \"2022-01-01\") %>% mutate(order = 3)\n## the first time but > 2022-01-01 -- if only once but 2022\n\n## order = 2\norder2_1 = allqolie_c %>% group_by(record_id) %>% filter(dateqolie == min(dateqolie)) %>% \n  ungroup() %>% filter(dateqolie >= \"2022-01-01\") %>% filter(qolietimes != 1) %>% mutate(order = 2)\n\n#allqolie_c %>% filter(qolietimes == 1 & dateqolie >= \"2022-01-01\") \n\n## two times both > 2022-01-01\norder2_2 = allqolie_c %>% filter(dateqolie >= \"2022-01-01\") %>% group_by(record_id) %>% filter(dateqolie < max(dateqolie)) %>%\n  mutate(order = 2)\n# date is NA\norder2_3 = allqolie_c %>% filter(is.na(dateqolie)) %>% mutate(order = 2)\n## 4 times\norder2_4 = allqolie_c %>% filter(qolietimes == 4) %>% group_by(record_id) %>% filter(dateqolie != min(dateqolie) & dateqolie != max(dateqolie) & (difftime(dateqolie, min(dateqolie), units= \"days\") >= 80 | difftime(dateqolie, min(dateqolie), units= \"days\") <= 40)) %>%\n  mutate(order = 2)\n\norder2_5 = allqolie_c %>% filter(qolietimes == 4) %>% group_by(record_id) %>% filter(dateqolie != min(dateqolie) & dateqolie != max(dateqolie) & (difftime(dateqolie, min(dateqolie), units= \"days\") >= 42 & difftime(dateqolie, min(dateqolie), units= \"days\") <= 70)) %>% \n  filter((record_id == \"PHC---134-90-2020-08-12 12:16\" & dateqolie == \"2020-10-02\") | (record_id == \"PHC---134-90-2020-08-17 21:47\" & dateqolie == \"2020-10-02\") | (record_id == \"PHC---141-119-2020-07-01 11:26\" & dateqolie == \"2020-09-06\") | (record_id == \"PHC--103--69-2020-11-23 10:26\" & dateqolie == \"2021-01-18\")) %>%\n  mutate(order = 2)\n\n## order = 1\norder2_6 = allqolie_c %>% anti_join(order0) %>% anti_join(order3) %>% anti_join(order2_1) %>% \n  anti_join(order2_2) %>% anti_join(order2_3) %>% anti_join(order2_4) %>% anti_join(order2_5) %>% count(record_id) %>% filter(n>1) %>% left_join(allqolie_c) %>%\n  filter((record_id == \"PHC---132-50-2020-06-26 10:47\" & dateqolie == \"2021-08-24\") | (record_id == \"PHC---132-50-2020-12-16 11:28\" & dateqolie == \"2020-12-23\") | (record_id == \"PHC---133-32-2020-08-10 10:09\" & dateqolie == \"2020-08-17\") | (record_id == \"PHC---133-44-2020-08-19 12:16\" & dateqolie == \"2020-10-30\") | (record_id == \"PHC--103--77-2020-11-19 04:30\" & dateqolie == \"2020-11-26\")) %>% mutate(order = 2)\n\norder2 = order2_1 %>% \n  full_join(order2_2) %>% full_join(order2_3) %>% full_join(order2_4) %>% full_join(order2_5) %>% full_join(order2_6) %>% select(-n)\n\n\norder1 = allqolie_c %>% anti_join(order0) %>% anti_join(order3) %>% anti_join(order2) %>% mutate(order = 1)\n\n## bind\nallq = bind_rows(order0, order1, order2, order3)\n\n# save(fu, bs, allq, fcf, fcf_c, gender, fudw, gender, location, dob, repeated, allqolie, order2, file = \"with-drop-out.rda\")\n\n\n\n\nShow the code\nallq = allq %>% \n  anti_join(fu %>% filter(reason != 1) %>% distinct(study_arm,record_id))\n\nfcf_c = fcf_c %>% anti_join(fu %>% filter(reason != 1) %>% distinct(study_arm,record_id))\n\n# save(fu, bs, allq, fcf, fcf_c, gender, fudw, gender, location, dob, repeated, allqolie, order2, file = \"data/without-drop-out.rda\")"
  },
  {
    "objectID": "bridge_brief.html#qolieqolie-31-qolie-ad-48",
    "href": "bridge_brief.html#qolieqolie-31-qolie-ad-48",
    "title": "BRIDGE Report",
    "section": "QOLIE(QOLIE-31 & QOLIE-AD-48)",
    "text": "QOLIE(QOLIE-31 & QOLIE-AD-48)\n\nthe Inclusion Criteria of QOLIE records\nSource\n\nfrom both Screening and Follow up visits;\nincluding both QOLIE-31 and QOLIE-AD-48.\n\nLogic for selecting same-day QOLIE records\nFor every participant, if there exists 2 QOLIE records on the same day,\n\nchoose the one with type(QOLIE-31/QOLIE-AD-48) more eligible for the age(11-17 use QOLIE-AD-48, >18 use QOLIE-31);\nif the same QOLIE type, choose the one with less missing domain and less missing items;\nif still the same, choose the one with bigger instance.\n\nThere are 75 participants have 2 or more QOLIE records on the same day, the max times is 2.\nLogic for i-th QOLIE\nFor every participant,\n\nthe baseline date is obtained from date_consent_screen or dataconsentenroll, choosing one based on ev0;\n0th QOLIE(first): the first occurence of QOLIE records, no matter whether the date is on or before or after the baseline date, and no matter whether the record is from Screening or Follow up Visits, except from one case: the date is after “2022-01-01”; – There are 181 records of 0th order with the date later than the baseline date.\n3rd QOLIE(last): the last time of QOLIE records and the date is after “2022-01-01”. For those who have only one time QOLIE record, if the date is after “2022-01-01”, the record will be labeled as the 3-rd, as the participants are only old enough(>11) for the last time of visits(maybe we can compare their previous VAS score and this time of QOLIE);\n1st or 2nd: the ones between the 0th and 3rd. For participants with 4 times of QOLIE and participants with 2 times of after-“2022-01-01” QOLIE, the 2nd will be filled – they could also be dropped as they are not so consistent with the schedule;\nFor the 6 records with “NA” dates, the order will depend on the instance. I prefer to put them on the 2nd, as they might be dropped when building models as the data includes too much noises.\n\n\nComplete Rate of the instruments\n\n\nShow the code\nallq %>% \n  mutate(base = ifelse(type == 'QOLIE-AD-48', 47, 31), miss_item_p = (base - miss_item) / base, miss_item_pct = ifelse(miss_item_p == 1, '100%', ifelse(miss_item_p < 1 & miss_item_p >= 0.9, '90% - 99%', ifelse(miss_item_p < 0.9 & miss_item_p >= 0.8, '80% - 89%', 'below 80%')))) %>%\n  count(study_arm, miss_item_pct) %>%\n  group_by(study_arm) %>%\n  mutate(pct = percent(n / sum(n))) %>%\n  arrange(study_arm, desc(n)) %>%\n  ungroup() %>%\n  select(-study_arm) %>%\n  rename(complete_rate = miss_item_pct) %>%\n  kable(caption = \"Complete Rates of QOLIE\") %>%\n  kable_styling(full_width = F) %>%\n  pack_rows(\"EUC\",1,4) %>%\n  pack_rows(\"TSC\",5,8) %>%\n  scroll_box()\n\n\n\n\nComplete Rates of QOLIE\n \n  \n    complete_rate \n    n \n    pct \n  \n \n\n  EUC\n\n    100% \n    699 \n    69.4% \n  \n  \n    90% - 99% \n    222 \n    22.0% \n  \n  \n    80% - 89% \n    61 \n    6.1% \n  \n  \n    below 80% \n    25 \n    2.5% \n  \n  TSC\n\n    100% \n    838 \n    74.3% \n  \n  \n    90% - 99% \n    224 \n    19.9% \n  \n  \n    80% - 89% \n    59 \n    5.2% \n  \n  \n    below 80% \n    7 \n    0.6% \n  \n\n\n\n\n\nShow the code\nggplot(data=allq, aes(x=miss_item)) + \n  geom_histogram(binwidth = 1) +\n  stat_bin(binwidth=1, geom=\"text\", aes(label=..count..), vjust = -0.25) +\n  facet_grid(type~study_arm) +\n  theme_minimal() +\n  xlab(\"Number of missing item\") + ylab(\"Freq\") + ylim(c(0, 800)) + \n  ggtitle(\"Missing items among the questions in QOLIE\")\n\n\n\n\n\nShow the code\nallq = allq %>% mutate(base = ifelse(type == 'QOLIE-AD-48', 47, 31), miss_item_p = (base - miss_item) / base) %>%\n  filter(miss_item_p >= 0.8) %>% select(-base, -miss_item_p)\n\n\nThen based on the completion rate, we’ll delete the cases with completion rate lower than 80%.\n\n\n\nMissing Rate for QOLIE\n\nHad QOLIE records / Should have QOLIE records\nNumber of Participants with QOLIE records: 813\nNumber of Participants being over 11 at lease once during visits: 873\nThere are 46 participants not old enough to use QOLIE (at least once), but indeed having QOLIE records.\nNumber of Participants eligible to have and indeed having QOLIE records: 786, rate is 90%\n\n\nHow many times of QOLIE the participants have?\n\n\nShow the code\nallq %>% count(record_id) %>% \n  rename(times_of_qolie = n) %>% \n  count(times_of_qolie) %>%\n  kable(caption = \"times of QOLIE\") %>%\n  kable_styling(full_width = F)\n\n\n\n\ntimes of QOLIE\n \n  \n    times_of_qolie \n    n \n  \n \n\n  \n    1 \n    154 \n  \n  \n    2 \n    60 \n  \n  \n    3 \n    567 \n  \n  \n    4 \n    32 \n  \n\n\n\n\n\nShow the code\ncat(\"order 0th is the first one, order 3th is the last one (2022) \")\n\n\norder 0th is the first one, order 3th is the last one (2022) \n\n\nShow the code\nallq %>% group_by(study_arm, order) %>% \n  summarise(n_records = n(), mean_score = mean(score), sd_score = sd(score)) %>%\n  group_by(study_arm) %>%\n  mutate(pct_by_arm = percent(n_records / sum(n_records))) %>% \n  ungroup() %>%\n  select(order, n_records, pct_by_arm, mean_score, sd_score) %>%\n  kable(caption=\"QOLIE records by order\") %>% \n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\")) %>%\n  pack_rows(\"EUC\",1,4) %>%\n  pack_rows(\"TSC\",5,8)\n\n\n\n\nQOLIE records by order\n \n  \n    order \n    n_records \n    pct_by_arm \n    mean_score \n    sd_score \n  \n \n\n  EUC\n\n    0 \n    314 \n    32.0% \n    48.95061 \n    16.32521 \n  \n  \n    1 \n    289 \n    29.4% \n    50.63552 \n    14.08038 \n  \n  \n    2 \n    19 \n    1.9% \n    40.82569 \n    17.30808 \n  \n  \n    3 \n    360 \n    36.7% \n    53.38654 \n    14.67627 \n  \n  TSC\n\n    0 \n    357 \n    31.8% \n    48.39177 \n    15.64808 \n  \n  \n    1 \n    329 \n    29.3% \n    50.14836 \n    14.75667 \n  \n  \n    2 \n    19 \n    1.7% \n    46.27617 \n    15.75473 \n  \n  \n    3 \n    416 \n    37.1% \n    54.85074 \n    13.93200 \n  \n\n\n\n\n\nShow the code\nallq %>% group_by(study_arm, order, type) %>% \n  summarise(n_records = n(), mean_score = mean(score), sd_score = sd(score)) %>%\n  group_by(study_arm) %>%\n  mutate(pct_by_arm = percent(n_records / sum(n_records))) %>% \n  ungroup() %>%\n  select(order, type, n_records, pct_by_arm, mean_score, sd_score) %>%\n  kable(caption=\"QOLIE records by order\") %>% \n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\")) %>%\n  pack_rows(\"EUC\",1,8) %>%\n  pack_rows(\"TSC\",9,16)\n\n\n\n\nQOLIE records by order\n \n  \n    order \n    type \n    n_records \n    pct_by_arm \n    mean_score \n    sd_score \n  \n \n\n  EUC\n\n    0 \n    QOLIE-31 \n    3 \n    0.31% \n    56.13713 \n    8.209630 \n  \n  \n    0 \n    QOLIE-AD-48 \n    311 \n    31.67% \n    48.88129 \n    16.375356 \n  \n  \n    1 \n    QOLIE-31 \n    13 \n    1.32% \n    53.96729 \n    14.147086 \n  \n  \n    1 \n    QOLIE-AD-48 \n    276 \n    28.11% \n    50.47859 \n    14.083550 \n  \n  \n    2 \n    QOLIE-31 \n    4 \n    0.41% \n    42.93823 \n    7.414770 \n  \n  \n    2 \n    QOLIE-AD-48 \n    15 \n    1.53% \n    40.26235 \n    19.281196 \n  \n  \n    3 \n    QOLIE-31 \n    106 \n    10.79% \n    57.38363 \n    13.691124 \n  \n  \n    3 \n    QOLIE-AD-48 \n    254 \n    25.87% \n    51.71847 \n    14.776838 \n  \n  TSC\n\n    0 \n    QOLIE-31 \n    6 \n    0.535% \n    47.05317 \n    8.083108 \n  \n  \n    0 \n    QOLIE-AD-48 \n    351 \n    31.311% \n    48.41465 \n    15.751050 \n  \n  \n    1 \n    QOLIE-31 \n    11 \n    0.981% \n    57.15158 \n    9.376176 \n  \n  \n    1 \n    QOLIE-AD-48 \n    318 \n    28.368% \n    49.90611 \n    14.858722 \n  \n  \n    2 \n    QOLIE-31 \n    5 \n    0.446% \n    57.10524 \n    18.703434 \n  \n  \n    2 \n    QOLIE-AD-48 \n    14 \n    1.249% \n    42.40865 \n    13.222303 \n  \n  \n    3 \n    QOLIE-31 \n    124 \n    11.062% \n    59.26109 \n    11.612683 \n  \n  \n    3 \n    QOLIE-AD-48 \n    292 \n    26.048% \n    52.97785 \n    14.422254 \n  \n\n\n\n\n\nTotally, there are 241 participants having at least one time of QOLIE-31 – totally 272 records.\n\n\nTime distribution for QOLIE times\n\n\nShow the code\nallq %>%\n  group_by(order) %>%\n  ggplot(aes(x=dateqolie)) + \n  geom_histogram(bins = 50) +\n  facet_grid(order~.) +\n  theme_minimal() +\n  xlab(\"QOLIE\") + ylab(\"Freq\") +\n  ggtitle(\"Histogram of QOLIE dates\")\n\n\n\n\n\n\n\n\nDemographic of QOLIE users\n\nGender\n\n\nShow the code\nallq %>% distinct(record_id) %>% left_join(gender) %>%\n  mutate(gender=factor(gender,levels=1:2,labels=c(\"Female\",\"Male\"))) %>%\n  count(study_arm, gender) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable() %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\n \n  \n    study_arm \n    gender \n    n \n    pct \n  \n \n\n  \n    EUC \n    Female \n    136 \n    36% \n  \n  \n    EUC \n    Male \n    245 \n    64% \n  \n  \n    TSC \n    Female \n    159 \n    37% \n  \n  \n    TSC \n    Male \n    273 \n    63% \n  \n\n\n\n\n\n\n\nCity\n\n\nShow the code\nallq %>% distinct(record_id) %>% left_join(location) %>%\n  count(study_arm, city) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable() %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\n \n  \n    study_arm \n    city \n    n \n    pct \n  \n \n\n  \n    EUC \n    Kaduna \n    89 \n    23.4% \n  \n  \n    EUC \n    Kano \n    178 \n    46.7% \n  \n  \n    EUC \n    Zaria \n    114 \n    29.9% \n  \n  \n    TSC \n    Kaduna \n    97 \n    22.5% \n  \n  \n    TSC \n    Kano \n    229 \n    53.0% \n  \n  \n    TSC \n    Zaria \n    106 \n    24.5% \n  \n\n\n\n\n\n\n\nAge and Age eligibility\n\n\nShow the code\nallq %>% \n  ggplot(aes(x = age)) + \n  geom_histogram(binwidth = 1) +\n  facet_grid(study_arm ~ order) +\n  theme_minimal() +\n  xlab(\"Age\") + ylab(\"Freq\") +\n  ggtitle(\"Age Distribution for QOLIE users\")\n\n\n\n\n\nShow the code\nggplot(allq %>% mutate(elig = factor(ifelse(type == eligibility, \"Correct\", \"Ineligible\"))), aes(x = age, y = score, color = factor(order), shape = elig)) +\n  geom_point(position = \"dodge\", alpha = 0.8) +\n  scale_color_brewer(palette = \"Spectral\")\n\n\n\n\n\n\n\n\nDistribution of QOLIE Scores\nAs the 2th records include lots of noises and have a small sample for both 2 arms, we may exclude it in the later analysis. The other 3 parts show a normal distribution shape and a small increasing tendency for the average score.\n\n\nShow the code\nallq %>% group_by(study_arm, order) %>% \n  summarise(n_records = n(), mean_score = mean(score), sd_score = sd(score)) %>%\n  group_by(study_arm) %>%\n  mutate(pct_by_arm = percent(n_records / sum(n_records))) %>% \n  ungroup() %>%\n  select(order, n_records, pct_by_arm, mean_score, sd_score) %>%\n  kable(caption=\"QOLIE records by order\") %>% \n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\")) %>%\n  pack_rows(\"EUC\",1,4) %>%\n  pack_rows(\"TSC\",5,8)\n\n\n\n\nQOLIE records by order\n \n  \n    order \n    n_records \n    pct_by_arm \n    mean_score \n    sd_score \n  \n \n\n  EUC\n\n    0 \n    314 \n    32.0% \n    48.95061 \n    16.32521 \n  \n  \n    1 \n    289 \n    29.4% \n    50.63552 \n    14.08038 \n  \n  \n    2 \n    19 \n    1.9% \n    40.82569 \n    17.30808 \n  \n  \n    3 \n    360 \n    36.7% \n    53.38654 \n    14.67627 \n  \n  TSC\n\n    0 \n    357 \n    31.8% \n    48.39177 \n    15.64808 \n  \n  \n    1 \n    329 \n    29.3% \n    50.14836 \n    14.75667 \n  \n  \n    2 \n    19 \n    1.7% \n    46.27617 \n    15.75473 \n  \n  \n    3 \n    416 \n    37.1% \n    54.85074 \n    13.93200 \n  \n\n\n\n\n\nShow the code\nallq %>%\n  ggplot(aes(x=score, y=..density..)) + \n  geom_histogram(binwidth = 2) +\n  geom_density() + \n  facet_grid(study_arm ~ order) +\n  theme_minimal() +\n  xlab(\"QOLIE Scores\") + ylab(\"Density\") +\n  ggtitle(\"Density Distribution of valid QOLIE scores\")\n\n\n\n\n\n\n\nExploratory Hypothesis Testing\nBecause there are not enough samples for order == 2 which also includes some noises, I excluded the 2th order in the analysis. The inclusion criteria is: participants with at least 0th(the regarded “first”) and 3th(the regarded “last”) QOLIE records.\n\n\nShow the code\nqinfo = allq %>% filter(order == 0) %>% select(record_id) %>% inner_join(allq %>% filter(order == 3), by = \"record_id\") %>% select(record_id) %>% left_join(allq) %>% filter(order != 2) %>% left_join(gender) %>% left_join(location)\n# %>% filter(type = eligibility)\n\nt.test(\n  score ~ factor(study_arm),\n  data = qinfo,\n  var.equal = TRUE\n)\n\n\n\n    Two Sample t-test\n\ndata:  score by factor(study_arm)\nt = -0.43916, df = 1863, p-value = 0.6606\nalternative hypothesis: true difference in means between group EUC and group TSC is not equal to 0\n95 percent confidence interval:\n -1.662510  1.054189\nsample estimates:\nmean in group EUC mean in group TSC \n         50.97605          51.28022 \n\n\nThere’s no difference between 2 arms among all times.\nThe study arm, order, gender, and city variables are all categorical variables(like dummy variables) without numeric meaning, so we use factor here. Age is numeric.\n\n\nShow the code\nsummary(lm(score ~ factor(study_arm)*factor(order), qinfo))\n\n\n\nCall:\nlm(formula = score ~ factor(study_arm) * factor(order), data = qinfo)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-55.145  -8.233   0.945   9.421  42.452 \n\nCoefficients:\n                                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                          48.6811     0.8601  56.600  < 2e-16 ***\nfactor(study_arm)TSC                 -0.2161     1.1728  -0.184 0.853857    \nfactor(order)1                        2.2354     1.2349   1.810 0.070442 .  \nfactor(order)3                        4.6461     1.2163   3.820 0.000138 ***\nfactor(study_arm)TSC:factor(order)1  -0.5351     1.6840  -0.318 0.750709    \nfactor(study_arm)TSC:factor(order)3   2.0338     1.6585   1.226 0.220254    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 14.72 on 1859 degrees of freedom\nMultiple R-squared:  0.02752,   Adjusted R-squared:  0.0249 \nF-statistic: 10.52 on 5 and 1859 DF,  p-value: 5.62e-10\n\n\nShow the code\ninteraction.plot(x.factor = qinfo$order, #x-axis variable\n                 trace.factor = qinfo$study_arm, #variable for lines\n                 response = qinfo$score, #y-axis variable\n                 fun = mean, #metric to plot\n                 ylab = \"QOLIE Score (marginal mean)\",\n                 xlab = \"Order of QOLIE\",\n                 col = c(\"pink\", \"blue\"),\n                 lty = 1, #line type\n                 lwd = 2, #line width\n                 trace.label = \"Study Arm\")\n\n\n\n\n\nWhen trying to explain the group difference among the times and the arms,\nThe intercept is the QOLIE score of EUC arm on the 0th order.\nFor the 0th records, the difference between 2 arms is not significant.\nthe main effect of order is kind of significantly(1th over 0th: p < 0.1, marginal significant; 3th over 0th, p < 0.05, siginificant) positive – as time goes by (may caused by more treatment, changes in life, age grows), the QOLIE score improves.\nNot find any evidence that the TSC has a better effect than EUC on every visit.\nThe lm formula creates several dummy variables:\nTSC, for TSC arm is 1 and EUC arm is 0;\norder1 and order3, for 0th having both 2 are 0, 1th for only order1 = 1 and 3th for only order3 = 1.\n\\[QOLIE = 48.6810946 + -0.2160521 * TSC + 2.2353547 * order_1 + 4.6460678 * order_3 \\\\ + -0.5350992 * TSC * order_1 + 2.0338043 * TSC * order_3 \\]\n\n\nShow the code\nsummary(lm(score ~ factor(study_arm)*factor(order) + age, qinfo))\n\n\n\nCall:\nlm(formula = score ~ factor(study_arm) * factor(order) + age, \n    data = qinfo)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-54.982  -8.212   0.958   9.256  42.552 \n\nCoefficients:\n                                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                          37.1729     2.7219  13.657  < 2e-16 ***\nfactor(study_arm)TSC                 -0.1890     1.1669  -0.162   0.8713    \nfactor(order)1                        2.0521     1.2294   1.669   0.0953 .  \nfactor(order)3                        3.1645     1.2551   2.521   0.0118 *  \nage                                   0.8076     0.1813   4.454 8.93e-06 ***\nfactor(study_arm)TSC:factor(order)1  -0.5347     1.6755  -0.319   0.7497    \nfactor(study_arm)TSC:factor(order)3   2.0356     1.6502   1.234   0.2175    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 14.65 on 1858 degrees of freedom\nMultiple R-squared:  0.03779,   Adjusted R-squared:  0.03468 \nF-statistic: 12.16 on 6 and 1858 DF,  p-value: 1.873e-13\n\n\nShow the code\nggplot(qinfo,aes(x = age, y = score, color = order)) +\n  geom_point(position = \"jitter\") +\n  geom_smooth(method='lm')\n\n\n\n\n\nAge plays a small role over time – the increasing age interpret part of the increasing QOLIE over visits and time. The order is no longer have a significance effect.\nthe lm formula is (only age is not a dummy variable):\n\\[QOLIE = 37.1728684 + -0.1890242 * TSC + 2.0521008 * order_1 + 3.1645446 * order_3 \\\\ + -0.5347111 * TSC * order_1 + 2.035648 * TSC*order_3 + 0.807643 * age\\]\n\n\nShow the code\nsummary(lm(score ~ factor(study_arm)*factor(order) + factor(gender), qinfo))\n\n\n\nCall:\nlm(formula = score ~ factor(study_arm) * factor(order) + factor(gender), \n    data = qinfo)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-55.501  -8.089   1.062   9.344  43.030 \n\nCoefficients:\n                                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                          48.0812     0.9717  49.481  < 2e-16 ***\nfactor(study_arm)TSC                 -0.1947     1.1726  -0.166 0.868166    \nfactor(order)1                        2.2458     1.2347   1.819 0.069085 .  \nfactor(order)3                        4.6461     1.2161   3.820 0.000138 ***\nfactor(gender)2                       0.9349     0.7053   1.326 0.185136    \nfactor(study_arm)TSC:factor(order)1  -0.5467     1.6837  -0.325 0.745458    \nfactor(study_arm)TSC:factor(order)3   2.0338     1.6582   1.227 0.220160    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 14.72 on 1858 degrees of freedom\nMultiple R-squared:  0.02844,   Adjusted R-squared:  0.0253 \nF-statistic: 9.063 on 6 and 1858 DF,  p-value: 8.648e-10\n\n\nGender plays no role.\n\n\nShow the code\nsummary(lm(score ~ factor(study_arm)*factor(order) + age + factor(city), qinfo))\n\n\n\nCall:\nlm(formula = score ~ factor(study_arm) * factor(order) + age + \n    factor(city), data = qinfo)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-52.041  -8.299   0.897   9.313  45.502 \n\nCoefficients:\n                                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                          37.5086     2.7986  13.403  < 2e-16 ***\nfactor(study_arm)TSC                 -0.5679     1.1565  -0.491 0.623436    \nfactor(order)1                        2.0376     1.2168   1.675 0.094187 .  \nfactor(order)3                        3.3619     1.2428   2.705 0.006892 ** \nage                                   0.7000     0.1807   3.874 0.000111 ***\nfactor(city)Kano                      3.4593     0.8506   4.067 4.96e-05 ***\nfactor(city)Zaria                    -1.3909     0.9678  -1.437 0.150850    \nfactor(study_arm)TSC:factor(order)1  -0.5013     1.6584  -0.302 0.762453    \nfactor(study_arm)TSC:factor(order)3   2.0354     1.6333   1.246 0.212846    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 14.5 on 1856 degrees of freedom\nMultiple R-squared:  0.05843,   Adjusted R-squared:  0.05437 \nF-statistic:  14.4 on 8 and 1856 DF,  p-value: < 2.2e-16\n\n\nCity plays a role that Zario < Keduna < Kano.\n\\[QOLIE = 37.5085908 + -0.5679033 * TSC + 2.0376459 * order_1 + 3.3619162 * order_3 + -0.5013377 * TSC * order_1 + 2.0354024 * TSC * order_3 \\\\ + 0.7000472 * age + 3.4592855 * Kano + -1.3908916 * Zaria\\]"
  },
  {
    "objectID": "bridge_brief.html#vas-1",
    "href": "bridge_brief.html#vas-1",
    "title": "BRIDGE Report",
    "section": "VAS",
    "text": "VAS\n\nInclusion Criteria\n\nif the missed_fu is like “no” or “on time”, include no matter any missing. There’re 458 records(2.814478 % of all) meeting the conditions.\nif the missed_fu is NA or “Visit Done”, inclusion depends on whether they filled all of follow_up_care_form_complete, confirmseize, weight_fu_v2, seizeclass. There ’re 15054 records (92.5090641 % of all) meeting the conditions.\nif the missed_fu answers something else, exclude. There’re 761 records (4.6764579 % of all) excluded.\n\n\n\nDemographic\n\n\nShow the code\nfcf_c %>% distinct(record_id) %>% left_join(gender) %>%\n  mutate(gender=factor(gender,levels=1:2,labels=c(\"Female\",\"Male\"))) %>%\n  count(study_arm, gender) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable(caption = \"Gender in 2 arms\") %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\nGender in 2 arms\n \n  \n    study_arm \n    gender \n    n \n    pct \n  \n \n\n  \n    EUC \n    Female \n    269 \n    37% \n  \n  \n    EUC \n    Male \n    458 \n    63% \n  \n  \n    TSC \n    Female \n    272 \n    36% \n  \n  \n    TSC \n    Male \n    491 \n    64% \n  \n\n\n\n\n\nShow the code\nfcf_c %>% distinct(record_id) %>% left_join(location) %>%\n  count(study_arm, city) %>% group_by(study_arm) %>%\n  mutate(pct = percent(n/sum(n))) %>%\n  kable(caption = \"City in 2 arms\") %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\"))\n\n\n\n\nCity in 2 arms\n \n  \n    study_arm \n    city \n    n \n    pct \n  \n \n\n  \n    EUC \n    Kaduna \n    156 \n    21.5% \n  \n  \n    EUC \n    Kano \n    372 \n    51.2% \n  \n  \n    EUC \n    Zaria \n    199 \n    27.4% \n  \n  \n    TSC \n    Kaduna \n    189 \n    24.8% \n  \n  \n    TSC \n    Kano \n    401 \n    52.6% \n  \n  \n    TSC \n    Zaria \n    173 \n    22.7% \n  \n\n\n\n\n\nShow the code\nggplot(fcf_c, aes(x = agefu, y = qolie, color = factor(redcap_repeat_instance))) +\n  geom_point(position = \"dodge\", alpha = 0.8) +\n  scale_color_brewer(palette = \"Spectral\")\n\n\n\n\n\n\n\nAnalysis of VAS over time\n\n\nShow the code\nfcf_c %>%\n  ggplot(aes(x=qolie)) + \n  geom_histogram(binwidth = 1) +\n  facet_grid(study_arm~.) +\n  theme_minimal() +\n  xlab(\"VAS\") + ylab(\"Freq\") +\n  ggtitle(\"Distribution of valid scores\")\n\n\n\n\n\n\nMain effects and interactions of study arms and visit times\nFor the cost-effectiveness analysis, we need to compare the utilities between the two arms along with the 10 follow up visits. Study arm is a two-level factor as EUC is the control group and TSC is the treatment group. lm function creates a dummy variable named TSC(the line: factor(study_arm) TSC) that TSC = 1 for TSC group and TSC = 0 for EUC group.\nThe main effect of visits is to use the Screening (visit 0) as the baseline. There are 10 dummy variables for all follow-up visits: if all are 0, it refers to the screening visit; if visit1 = 1, the others should all be 0 and this refers to Follow-up Visit 1.\nThe interaction shows the expected difference in the effect of the N-th visit(compared to the screening) for TSC participants versus EUC participants. For example, factor(study_arm)TSC:factor(visit)1 means visit1 = 1 and TSC = 1, which compares the VAS of the TSC arm on the first follow-up visit with that of the EUC arm. If it is the screening visit or in EUC arm, all the interaction portions will be zero.\nThe intercept, is the average VAS of screening visit in EUC arm.\n\n\nShow the code\nfcf_i = fcf_c %>% filter(!is.na(qolie)) %>% select(record_id, study_arm, visit = redcap_repeat_instance, qolie, age = agefu, gender, city) %>% mutate(gender = ifelse(gender == 1, \"Female\", \"Male\"), visit = as.numeric(visit)) %>% bind_rows(bs %>% filter(qolie_48_1117_v0_complete == \"2\") %>% select(record_id = unique_id, study_arm, qolie = vas_qolie_48, age, gender, city) %>% mutate(visit = 0))\n\nsummary(lm(qolie ~ factor(study_arm)*factor(visit), fcf_i))\n\n\n\nCall:\nlm(formula = qolie ~ factor(study_arm) * factor(visit), data = fcf_i)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-81.839 -11.000   1.132  11.548  49.436 \n\nCoefficients:\n                                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                            48.564      1.238  39.241  < 2e-16 ***\nfactor(study_arm)TSC                    3.804      1.694   2.245 0.024793 *  \nfactor(visit)1                          5.077      1.398   3.632 0.000282 ***\nfactor(visit)2                          8.037      1.397   5.752 9.02e-09 ***\nfactor(visit)3                         12.436      1.398   8.893  < 2e-16 ***\nfactor(visit)4                         15.304      1.400  10.933  < 2e-16 ***\nfactor(visit)5                         19.993      1.398  14.303  < 2e-16 ***\nfactor(visit)6                         22.857      1.393  16.412  < 2e-16 ***\nfactor(visit)7                         26.146      1.393  18.769  < 2e-16 ***\nfactor(visit)8                         29.753      1.390  21.405  < 2e-16 ***\nfactor(visit)9                         30.002      1.391  21.575  < 2e-16 ***\nfactor(visit)10                        30.999      1.390  22.298  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)1     2.524      1.919   1.315 0.188444    \nfactor(study_arm)TSC:factor(visit)2     5.455      1.922   2.838 0.004550 ** \nfactor(study_arm)TSC:factor(visit)3     4.445      1.926   2.307 0.021049 *  \nfactor(study_arm)TSC:factor(visit)4     6.035      1.925   3.135 0.001722 ** \nfactor(study_arm)TSC:factor(visit)5     4.110      1.923   2.136 0.032656 *  \nfactor(study_arm)TSC:factor(visit)6     5.199      1.917   2.712 0.006691 ** \nfactor(study_arm)TSC:factor(visit)7     5.080      1.914   2.654 0.007965 ** \nfactor(study_arm)TSC:factor(visit)8     5.718      1.911   2.993 0.002771 ** \nfactor(study_arm)TSC:factor(visit)9     6.082      1.912   3.181 0.001470 ** \nfactor(study_arm)TSC:factor(visit)10    6.727      1.912   3.518 0.000436 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 16.97 on 14640 degrees of freedom\nMultiple R-squared:  0.2942,    Adjusted R-squared:  0.2932 \nF-statistic: 290.6 on 21 and 14640 DF,  p-value: < 2.2e-16\n\n\nShow the code\ninteraction.plot(x.factor = fcf_i$visit, #x-axis variable\n                 trace.factor = fcf_i$study_arm, #variable for lines\n                 response = fcf_i$qolie, #y-axis variable\n                 fun = mean, #metric to plot\n                 fixed = TRUE, \n                 ylab = \"QOLIE Score (marginal mean)\",\n                 xlab = \"Follow-up Visits\",\n                 col = c(\"pink\", \"blue\"),\n                 lty = 1, #line type\n                 lwd = 2, #line width\n                 trace.label = \"Study Arm\")\n\n\n\n\n\nThe linear model formula is:\n\\[VAS = 48.5638298 + 3.8036121 *TSC + 5.0769327 *Visit_1 + 8.0370474 *Visit_2 + 12.4361702 * Visit_3 + 15.3039265 *Visit_4 + 19.993355 * Visit_5 \\\\\n+ 22.8568501 *Visit_6 + 26.1463975 * Visit_7 + 29.7532773 * Visit_8 + 30.0018127 * Visit_9 + 30.9988443 * Visit_{10} \\\\\n+ 2.5244179  * TSC * Visit_1 + 5.4552583 * TSC * Visit_2 + 4.4445842 * TSC * Visit_3 + 6.0348463 * TSC * Visit_4 + 4.1095422 * TSC * Visit_5 \\\\\n+ 5.1993669 * TSC * Visit_6 + 5.0802862 * TSC * Visit_7 + 5.718331 * TSC * Visit_8 + 6.0822727 * TSC * Visit_9 + 6.7270472 * TSC * Visit_{10} \\]\nthe number of * shows the level of significance. Here, from the interaction parts, we can find the score of TSC is significantly higher than EUC for every visit.\nFor the screening visit, the score of TSC is 3.804 higher than the EUC(p = 0.02 shows significant group difference in the popularity). The difference expands over the visits\n\n\nAge as covariant\nAs it cost 2 years for the whole process, the kids may have improved VAS just due to the increasing age, while age is not a element of our research interest– that’s why we add age as a covariant.\nTo highlight the age, here we use residuals of VAS after excluding the age effect, rather than just add age into the model.\n\n\nShow the code\nsummary(lm(qolie ~ age, fcf_i))\n\n\n\nCall:\nlm(formula = qolie ~ age, data = fcf_i)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-73.511 -21.140   2.607  16.354  29.535 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 70.19530    0.43083 162.929  < 2e-16 ***\nage          0.19280    0.03716   5.189 2.15e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 20.18 on 14068 degrees of freedom\n  (592 observations deleted due to missingness)\nMultiple R-squared:  0.00191,   Adjusted R-squared:  0.001839 \nF-statistic: 26.92 on 1 and 14068 DF,  p-value: 2.147e-07\n\n\nShow the code\nfcf_a = bind_cols(fcf_i %>% filter(!is.na(age)), residuals(lm(qolie ~ age, fcf_i)))\ncolnames(fcf_a)[8] = \"age_residual\" \n\nsummary(lm(age_residual ~ factor(study_arm)*factor(visit), fcf_a))\n\n\n\nCall:\nlm(formula = age_residual ~ factor(study_arm) * factor(visit), \n    data = fcf_a)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-82.981 -11.134   0.767  12.045  49.687 \n\nCoefficients:\n                                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                           -24.331      1.245 -19.549  < 2e-16 ***\nfactor(study_arm)TSC                    3.760      1.704   2.207 0.027346 *  \nfactor(visit)1                          5.890      1.406   4.190 2.81e-05 ***\nfactor(visit)2                          8.841      1.405   6.292 3.23e-10 ***\nfactor(visit)3                         13.230      1.406   9.407  < 2e-16 ***\nfactor(visit)4                         16.069      1.408  11.415  < 2e-16 ***\nfactor(visit)5                         20.729      1.406  14.746  < 2e-16 ***\nfactor(visit)6                         23.547      1.401  16.813  < 2e-16 ***\nfactor(visit)7                         26.783      1.402  19.107  < 2e-16 ***\nfactor(visit)8                         30.406      1.399  21.736  < 2e-16 ***\nfactor(visit)9                         30.558      1.406  21.735  < 2e-16 ***\nfactor(visit)10                        31.010      1.461  21.229  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)1     2.518      1.930   1.305 0.191991    \nfactor(study_arm)TSC:factor(visit)2     5.448      1.933   2.818 0.004840 ** \nfactor(study_arm)TSC:factor(visit)3     4.424      1.937   2.284 0.022388 *  \nfactor(study_arm)TSC:factor(visit)4     6.022      1.936   3.111 0.001868 ** \nfactor(study_arm)TSC:factor(visit)5     4.110      1.934   2.125 0.033617 *  \nfactor(study_arm)TSC:factor(visit)6     5.166      1.928   2.680 0.007377 ** \nfactor(study_arm)TSC:factor(visit)7     5.131      1.926   2.664 0.007741 ** \nfactor(study_arm)TSC:factor(visit)8     5.634      1.923   2.930 0.003400 ** \nfactor(study_arm)TSC:factor(visit)9     6.017      1.934   3.112 0.001863 ** \nfactor(study_arm)TSC:factor(visit)10    7.778      2.026   3.839 0.000124 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 17.06 on 14048 degrees of freedom\nMultiple R-squared:  0.2858,    Adjusted R-squared:  0.2848 \nF-statistic: 267.8 on 21 and 14048 DF,  p-value: < 2.2e-16\n\n\nShow the code\ninteraction.plot(x.factor = fcf_a$visit, #x-axis variable\n                 trace.factor = fcf_a$study_arm, #variable for lines\n                 response = 69.57732 + fcf_a$age_residual, #y-axis variable\n                 fun = mean, #metric to plot\n                 fixed = TRUE, \n                 ylab = \"the QOLIE Score excluded the covariance effect of age\",\n                 xlab = \"Follow-up Visits\",\n                 col = c(\"pink\", \"blue\"),\n                 lty = 1, #line type\n                 lwd = 2, #line width\n                 trace.label = \"Study Arm\")\n\n\n\n\n\nage plays a role to interpret the increasing tendency of VAS over 10 visits, but the Task-shift treatment still have better effects than the the control group proved to be significant from the interaction estimates.\n\n\nShow the code\nsummary(lm(qolie ~ factor(study_arm)*factor(visit) + factor(gender), fcf_i))\n\n\n\nCall:\nlm(formula = qolie ~ factor(study_arm) * factor(visit) + factor(gender), \n    data = fcf_i)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-81.846 -10.989   1.144  11.560  49.430 \n\nCoefficients:\n                                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                           48.5517     1.2523  38.772  < 2e-16 ***\nfactor(study_arm)TSC                   3.8032     1.6945   2.244 0.024817 *  \nfactor(visit)1                         5.0774     1.3979   3.632 0.000282 ***\nfactor(visit)2                         8.0375     1.3974   5.752 9.01e-09 ***\nfactor(visit)3                        12.4368     1.3985   8.893  < 2e-16 ***\nfactor(visit)4                        15.3044     1.3999  10.933  < 2e-16 ***\nfactor(visit)5                        19.9937     1.3979  14.303  < 2e-16 ***\nfactor(visit)6                        22.8573     1.3927  16.412  < 2e-16 ***\nfactor(visit)7                        26.1469     1.3931  18.768  < 2e-16 ***\nfactor(visit)8                        29.7537     1.3901  21.404  < 2e-16 ***\nfactor(visit)9                        30.0023     1.3907  21.574  < 2e-16 ***\nfactor(visit)10                       30.9993     1.3903  22.297  < 2e-16 ***\nfactor(gender)Male                     0.0185     0.2916   0.063 0.949403    \nfactor(study_arm)TSC:factor(visit)1    2.5246     1.9194   1.315 0.188429    \nfactor(study_arm)TSC:factor(visit)2    5.4554     1.9225   2.838 0.004551 ** \nfactor(study_arm)TSC:factor(visit)3    4.4447     1.9263   2.307 0.021051 *  \nfactor(study_arm)TSC:factor(visit)4    6.0351     1.9250   3.135 0.001721 ** \nfactor(study_arm)TSC:factor(visit)5    4.1097     1.9236   2.137 0.032654 *  \nfactor(study_arm)TSC:factor(visit)6    5.1997     1.9171   2.712 0.006690 ** \nfactor(study_arm)TSC:factor(visit)7    5.0805     1.9143   2.654 0.007964 ** \nfactor(study_arm)TSC:factor(visit)8    5.7185     1.9109   2.993 0.002771 ** \nfactor(study_arm)TSC:factor(visit)9    6.0824     1.9120   3.181 0.001470 ** \nfactor(study_arm)TSC:factor(visit)10   6.7271     1.9121   3.518 0.000436 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 16.97 on 14639 degrees of freedom\nMultiple R-squared:  0.2942,    Adjusted R-squared:  0.2931 \nF-statistic: 277.4 on 22 and 14639 DF,  p-value: < 2.2e-16\n\n\nShow the code\ncat(\"There is no difference between the genders. \")\n\n\nThere is no difference between the genders. \n\n\nShow the code\nsummary(lm(qolie ~ factor(study_arm)*factor(visit) + factor(city), fcf_i))\n\n\n\nCall:\nlm(formula = qolie ~ factor(study_arm) * factor(visit) + factor(city), \n    data = fcf_i)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-80.658 -10.740   0.148  12.039  50.571 \n\nCoefficients:\n                                     Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                           53.0102     1.2484  42.461  < 2e-16 ***\nfactor(study_arm)TSC                   3.7995     1.6757   2.267 0.023381 *  \nfactor(visit)1                         5.2793     1.3824   3.819 0.000135 ***\nfactor(visit)2                         8.2531     1.3820   5.972  2.4e-09 ***\nfactor(visit)3                        12.6482     1.3831   9.145  < 2e-16 ***\nfactor(visit)4                        15.4744     1.3844  11.178  < 2e-16 ***\nfactor(visit)5                        20.1247     1.3824  14.558  < 2e-16 ***\nfactor(visit)6                        23.0330     1.3773  16.723  < 2e-16 ***\nfactor(visit)7                        26.3171     1.3778  19.101  < 2e-16 ***\nfactor(visit)8                        29.9403     1.3747  21.779  < 2e-16 ***\nfactor(visit)9                        30.1900     1.3753  21.951  < 2e-16 ***\nfactor(visit)10                       31.1832     1.3749  22.680  < 2e-16 ***\nfactor(city)Kano                      -5.5807     0.3457 -16.145  < 2e-16 ***\nfactor(city)Zaria                     -6.5236     0.3994 -16.333  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)1    2.2797     1.8983   1.201 0.229796    \nfactor(study_arm)TSC:factor(visit)2    5.2106     1.9013   2.741 0.006142 ** \nfactor(study_arm)TSC:factor(visit)3    4.2239     1.9051   2.217 0.026629 *  \nfactor(study_arm)TSC:factor(visit)4    5.8167     1.9039   3.055 0.002253 ** \nfactor(study_arm)TSC:factor(visit)5    3.8950     1.9024   2.047 0.040636 *  \nfactor(study_arm)TSC:factor(visit)6    5.0094     1.8959   2.642 0.008246 ** \nfactor(study_arm)TSC:factor(visit)7    4.8576     1.8932   2.566 0.010303 *  \nfactor(study_arm)TSC:factor(visit)8    5.4886     1.8898   2.904 0.003687 ** \nfactor(study_arm)TSC:factor(visit)9    5.8484     1.8909   3.093 0.001986 ** \nfactor(study_arm)TSC:factor(visit)10   6.5283     1.8910   3.452 0.000557 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 16.78 on 14638 degrees of freedom\nMultiple R-squared:  0.3098,    Adjusted R-squared:  0.3087 \nF-statistic: 285.6 on 23 and 14638 DF,  p-value: < 2.2e-16\n\n\nShow the code\ncat(\"As for the cities, Keduna > Kano > Zaria\")\n\n\nAs for the cities, Keduna > Kano > Zaria\n\n\nAs city is one of the variable of our interest, we include it into the linear model and find that participants in different cities will have significantly different average VAS."
  },
  {
    "objectID": "bridge_brief.html#age-of-onset-of-disease",
    "href": "bridge_brief.html#age-of-onset-of-disease",
    "title": "BRIDGE Report",
    "section": "age of onset of disease",
    "text": "age of onset of disease\nWhat was the age of the child when the first seizure happened?\n\n\nShow the code\n# bs %>% filter(!is.na(onset_age)) %>% select(id = unique_id, study_arm, onset_age) %>% filter(!is.na(id)) %>% \n#   kable(caption = \"Onset age is submitted in text\") %>%\n#   kable_styling() %>% \n#   scroll_box()\n\nonsetAge = bs %>% filter(!is.na(onset_age)) %>% select(id = unique_id, study_arm, onset_age, age, dob, gender) %>% filter(!is.na(id)) %>% \n  mutate(onset_age = str_replace(onset_age, \" and half\", \".5\"), onset_age = str_replace(onset_age, \"and half\", \".5\"), onset_age =  str_replace_all(onset_age, c(\"one\" = \"1\", \"first\" = \"1\",\"First\" = \"1\", \"A \" = \"1\", \"I\" = \"1\", \"One\" = \"1\", \"two\" = \"2\", \"Two\" = \"2\", \"second\" = \"2\", \"three\" = \"3\", \"Three\" = \"3\", \"third\" = \"3\", \"four\" = \"4\", \"five\" = \"5\", \"six\" = \"6\",\"Six\" = \"6\", \"seven\" = \"7\", \"eight\" = \"8\", \"nine\" = \"9\", \"ten\" = \"10\", \"birth\" = \"0\", \"born\" = \"0\", \"At birht\" = \"0\", \"After Brith\" = \"0\", \"2019\" = \"2\", \"November 2014\" = \"4\"))) %>%\n  mutate(onset = ifelse(str_detect(onset_age, \"Last month\"), round(age - 1/12), ifelse(str_detect(onset_age, \"d\")|str_detect(onset_age, \"D\"), round(parse_number(onset_age)/365.25), ifelse(str_detect(onset_age, \"y\") & (str_detect(onset_age, \"(6|8)( |)m\")), round(parse_number(onset_age) + 1), ifelse(str_detect(onset_age, \"y\")|str_detect(onset_age, \"Y\"), round(parse_number(onset_age)), ifelse(str_detect(onset_age, \"m\")|str_detect(onset_age, \"M\"), round(parse_number(onset_age)/12), ifelse(str_detect(onset_age, \"w\")|str_detect(onset_age, \"W\"), round(parse_number(onset_age)/52), parse_number(onset_age))))))))\n\nonsetAge %>% \n  filter(!is.na(onset)) %>%\n  group_by(study_arm, gender) %>% \n  summarise(meanOnsetAge = mean(onset), sdOnsetAge = sd(onset))\n\n\n# A tibble: 4 × 4\n# Groups:   study_arm [2]\n  study_arm gender meanOnsetAge sdOnsetAge\n  <chr>     <chr>         <dbl>      <dbl>\n1 EUC       Female         3.40       3.39\n2 EUC       Male           3.26       3.51\n3 TSC       Female         3.13       3.33\n4 TSC       Male           3.75       3.53\n\n\nShow the code\nonsetAge %>% \n  ggplot(aes(x = onset)) + \n  geom_histogram(binwidth = 1) +\n  facet_grid(study_arm ~ gender) + \n  stat_bin(binwidth=1, geom=\"text\", aes(label=..count..), vjust = -0.25) +\n  theme_minimal() +\n  xlab(\"Age (in years)\") + ylab(\"Freq\") +\n  ggtitle(\"Onset Age Distribution for 2 arms\")"
  },
  {
    "objectID": "bridge_brief.html#severity",
    "href": "bridge_brief.html#severity",
    "title": "BRIDGE Report",
    "section": "severity",
    "text": "severity\nwe can use the frequency to get the severity.\nsevere epilepsy, defined as an average seizure frequency of more than or equal to once per month; less severe epilepsy with a seizure frequency of less than once a month, or no seizures in the past year while untreated but still fulfilling the criteria of active epilepsy; and seizure-free, treated epilepsy, defined as not having seizures in the past year while on treatment.\nThe only question is that all the patients in our researsh should be considered as under treatment if they have less severe epilepsy.\n\n\nShow the code\n#melt\npreInterval = cbind(fudw['record_id'], stack(fudw[c(\"d01\",\"d12\", \"d23\", \"d34\", \"d45\", \"d56\", \"d67\", \"d78\", \"d89\", \"d90\")])) %>% mutate(visit = ifelse(ind == \"d90\", 10, as.numeric(ind[-1]))) %>% select(record_id, visit, interval = values)\n\nseizure_tsc = fcf_c %>% filter(!is.na(expseiz) & study_arm == \"TSC\") %>% mutate(seiz_times = ifelse(is.na(how_many_seiz_v2), 0, how_many_seiz_v2)) %>% mutate(visit = as.numeric(redcap_repeat_instance)) %>% left_join(preInterval, by = c(\"record_id\", \"visit\")) %>% mutate(seiz_freq = 365.25/12 * seiz_times / interval)\nseizure_euc = fcf_c %>% filter(seize_since_last_euc_v2 != 2 & study_arm == \"EUC\") %>% mutate(seiz_times = ifelse(is.na(number_seiz), 0, number_seiz)) %>% mutate(visit = as.numeric(redcap_repeat_instance)) %>% left_join(preInterval, by = c(\"record_id\", \"visit\")) %>% mutate(seiz_freq = 365.25/12 * seiz_times / interval)\nseizure_times = rbind(seizure_tsc, seizure_euc) %>% filter(!is.na(seiz_freq) & seiz_freq != Inf)\n\nsummary(lm(seiz_freq ~ factor(study_arm)*factor(visit) + agefu + factor(gender) + factor(city), seizure_times))\n\n\n\nCall:\nlm(formula = seiz_freq ~ factor(study_arm) * factor(visit) + \n    agefu + factor(gender) + factor(city), data = seizure_times)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-53.231  -1.237  -0.439   0.310 292.816 \n\nCoefficients:\n                                      Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                           10.21131    0.30781  33.174  < 2e-16 ***\nfactor(study_arm)TSC                  -4.34169    0.35074 -12.379  < 2e-16 ***\nfactor(visit)2                        -7.13917    0.35832 -19.924  < 2e-16 ***\nfactor(visit)3                        -8.23978    0.35901 -22.952  < 2e-16 ***\nfactor(visit)4                        -9.30574    0.35983 -25.861  < 2e-16 ***\nfactor(visit)5                        -9.34975    0.35717 -26.177  < 2e-16 ***\nfactor(visit)6                        -9.83982    0.35443 -27.763  < 2e-16 ***\nfactor(visit)7                        -9.86135    0.35510 -27.770  < 2e-16 ***\nfactor(visit)8                        -9.87230    0.35350 -27.927  < 2e-16 ***\nfactor(visit)9                        -9.79415    0.35833 -27.333  < 2e-16 ***\nfactor(visit)10                      -10.24561    0.39000 -26.270  < 2e-16 ***\nagefu                                 -0.03854    0.01243  -3.102  0.00193 ** \nfactor(gender)2                        0.12382    0.11755   1.053  0.29222    \nfactor(city)Kano                       0.62648    0.14410   4.348 1.39e-05 ***\nfactor(city)Zaria                      1.25123    0.16495   7.585 3.53e-14 ***\nfactor(study_arm)TSC:factor(visit)2    3.84985    0.49874   7.719 1.25e-14 ***\nfactor(study_arm)TSC:factor(visit)3    4.03640    0.50091   8.058 8.39e-16 ***\nfactor(study_arm)TSC:factor(visit)4    4.28884    0.50008   8.576  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)5    4.20612    0.49825   8.442  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)6    4.26441    0.49453   8.623  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)7    4.23470    0.49343   8.582  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)8    4.14546    0.49172   8.431  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)9    4.10195    0.49820   8.234  < 2e-16 ***\nfactor(study_arm)TSC:factor(visit)10   4.12469    0.55031   7.495 7.03e-14 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 6.595 on 13596 degrees of freedom\n  (592 observations deleted due to missingness)\nMultiple R-squared:  0.1245,    Adjusted R-squared:  0.123 \nF-statistic: 84.04 on 23 and 13596 DF,  p-value: < 2.2e-16\n\n\nShow the code\ninteraction.plot(x.factor = seizure_times$visit, #x-axis variable\n                 trace.factor = seizure_times$study_arm, #variable for lines\n                 response = seizure_times$seiz_freq, #y-axis variable\n                 fun = mean, #metric to plot\n                 ylab = \"frequency of seizures (times per month)\",\n                 xlab = \"Visit\",\n                 col = c(\"pink\", \"blue\"),\n                 lty = 1, #line type\n                 lwd = 2, #line width\n                 trace.label = \"Study Arm\")\n\n\n\n\n\nShow the code\nseizure_times %>% \n  ggplot(aes(x = seiz_freq)) + \n  geom_histogram(binwidth = 1) +\n  facet_grid(study_arm ~ .) + \n  theme_minimal()\n\n\n\n\n\nShow the code\n# to get the decrease of DALY, we need to get the beginning DALY and final DALY for 2 arms\npct_severe = seizure_times %>% mutate(severity = ifelse(seiz_freq >= 1, \"severe epilepsy\", \"others\")) %>%\n  group_by(study_arm, visit) %>% count(severity) %>% mutate(pct = percent(n / sum(n))) %>% filter(severity == \"severe epilepsy\") %>% ungroup() %>% select(visit,n, pct) \n\npct_severe %>%\n  kable(caption=\"percent of severe epilepsy in 2 arms among 10 visits\") %>%\n  kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\")) %>%\n  pack_rows(\"EUC\",1,10) %>%\n  pack_rows(\"TSC\",11,20)\n\n\n\n\npercent of severe epilepsy in 2 arms among 10 visits\n \n  \n    visit \n    n \n    pct \n  \n \n\n  EUC\n\n    1 \n    378 \n    56% \n  \n  \n    2 \n    373 \n    55% \n  \n  \n    3 \n    354 \n    52.9% \n  \n  \n    4 \n    268 \n    40% \n  \n  \n    5 \n    267 \n    39% \n  \n  \n    6 \n    162 \n    23% \n  \n  \n    7 \n    158 \n    22% \n  \n  \n    8 \n    139 \n    19% \n  \n  \n    9 \n    149 \n    21% \n  \n  \n    10 \n    68 \n    9% \n  \n  TSC\n\n    1 \n    313 \n    43% \n  \n  \n    2 \n    372 \n    52.4% \n  \n  \n    3 \n    331 \n    47.9% \n  \n  \n    4 \n    270 \n    38% \n  \n  \n    5 \n    239 \n    34% \n  \n  \n    6 \n    152 \n    21% \n  \n  \n    7 \n    118 \n    16% \n  \n  \n    8 \n    94 \n    12% \n  \n  \n    9 \n    111 \n    15% \n  \n  \n    10 \n    25 \n    3% \n  \n\n\n\n\n\nShow the code\n# \n# cat(\"set limits for outliners: [Q1-1.5*IQR, Q3+1.5*IQR]\")\n# \n# # delete outliners\n# quartiles <- quantile(seizure_times$seiz_freq, probs=c(.25, .75), na.rm = FALSE)\n# IQR <- IQR(seizure_times$seiz_freq)\n# Lower <- quartiles[1] - 1.5*IQR\n# Upper <- quartiles[2] + 1.5*IQR \n# seizure_times %>% filter(seiz_freq > Lower & seiz_freq < Upper) %>% mutate(severity = ifelse(seiz_freq >= 1, \"severe epilepsy\", \"seizure-free, treated epilepsy\")) %>%\n#   group_by(study_arm, visit = redcap_repeat_instance) %>% count(severity) %>% mutate(pct = percent(n / sum(n))) %>% ungroup() %>%select(-study_arm) %>% \n#   kable(caption=\"percent of epilepsy classes in 2 arms among 10 visits without outliners\") %>% \n#   kable_styling(full_width = F, bootstrap_options = c(\"striped\", \"hover\")) %>%\n#   pack_rows(\"EUC\",1,20) %>%\n#   pack_rows(\"TSC\",21,40)\n\n\nAs the intervals between screening and follow up visit 1 is not as scheduled stably as intervals between visits, we may use the reported seizure frequency in the Follow up visit 2(the 2th in the plot) as the baseline."
  },
  {
    "objectID": "bridge_brief.html#calculation-of-daly",
    "href": "bridge_brief.html#calculation-of-daly",
    "title": "BRIDGE Report",
    "section": "Calculation of DALY",
    "text": "Calculation of DALY\nsevere epilepsy, defined as an average seizure frequency of more than or equal to once per month;\nless severe epilepsy with a seizure frequency of less than once a month, or no seizures in the past year while untreated but still fulfilling the criteria of active epilepsy;\nand seizure-free, treated epilepsy, defined as not having seizures in the past year while on treatment.\nif seiz_freq = 0 from visit 1 - 7 or 2/3 - 9 or 5 - 9 or 7 - 10, later can be regarded as seizure-free as far as no seizure happened.\nDisability Weight (Essential for the YLDs) –\n\nSevere epilepsy: 0.552\nLess epilepsy: 0.263\nseizure-free, treated epilepsy: 0.049\n\nSo we can get the difference between 2 arms.\nFor the YLLs part, we can use YLLs or mortality from GBD. However, as GBD only have the epilepsy category (not detailed), the 2 arms should be the same – if we don’t consider some of them recovered at the end.\n\n\nShow the code\n# pct_seizure_free = seizure_times %>% filter(seiz_freq == 0) %>% count(record_id, visit, study_arm) %>% spread(visit, n, fill = 0, sep = \"\") %>%\n#   mutate(\n#     zero_0_12 = ifelse(visit1 == 1 & visit2 == 1 & visit3 == 1 & visit4 == 1 & visit5 == 1 & visit6 == 1 & visit7 == 1, TRUE, FALSE),\n#     zero_3_15 = ifelse(visit3 == 1 & visit4 == 1 & visit5 == 1 & visit6 == 1 & visit7 == 1 & visit8 == 1, TRUE, FALSE),\n#     zero_6_18 = ifelse(visit5 == 1 & visit6 == 1 & visit7 == 1 & visit8 == 1 & visit9 == 1, TRUE, FALSE)) %>%\n#   mutate(free_12_15 = ifelse(zero_0_12 & visit8 == 1, TRUE, FALSE),\n#          free_15_18 = ifelse(zero_3_15 & visit9 == 1, TRUE, FALSE),\n#          free_18_24 = ifelse(zero_6_18 & visit10 == 1, TRUE, FALSE))\n\n# count how many NAs in each col\n# sapply(severity, function(x) sum(is.na(x)))\n\nseverity = seizure_times %>% select(record_id, visit, study_arm, seiz_freq) %>% spread(visit, seiz_freq, sep = \"\") %>% drop_na() %>%\n  mutate(\n    zero_0_12 = ifelse(visit1 == 0 & visit2 == 0 & visit3 == 0 & visit4 == 0 & visit5 == 0 & visit6 == 0 & visit7 == 0, TRUE, FALSE),\n    zero_3_15 = ifelse(visit3 == 0 & visit4 == 0 & visit5 == 0 & visit6 == 0 & visit7 == 0 & visit8 == 0, TRUE, FALSE),\n    zero_6_18 = ifelse(visit5 == 0 & visit6 == 0 & visit7 == 0 & visit8 == 0 & visit9 == 0, TRUE, FALSE)) %>%\n  mutate(across(starts_with(\"visit\"), ~ ifelse(.x >= 1, \"severe epilepsy\", \"less severe epilepsy\"), .names = \"severity_{.col}\")) %>%\n  mutate(severity_visit8 = ifelse(zero_0_12 & visit8 == 0, \"seizure-free, treated\", severity_visit8),\n         severity_visit9 = ifelse(zero_3_15 & visit9 == 0, \"seizure-free, treated\", severity_visit9),\n         severity_visit10 = ifelse(zero_6_18 & visit10 == 0, \"seizure-free, treated\", severity_visit9))\n\nseverity_DALY = severity %>% \n  mutate(across(starts_with(\"severity_visit\"), ~ ifelse(.x == \"severe epilepsy\", 0.552, ifelse(.x == \"less severe epilepsy\", 0.263, 0.049)), .names = \"DALYw_{.col}\")) %>% select(-DALYw_severity_visit1) %>%\n  mutate(DALY_2yr = DALYw_severity_visit2 * 1/12 + DALYw_severity_visit3 * 1/12 + DALYw_severity_visit4 * 2/12 + DALYw_severity_visit5 * 2/12 + DALYw_severity_visit6 * 3/12 + DALYw_severity_visit7 * 3/12 + DALYw_severity_visit8 * 3/12 +  DALYw_severity_visit9 * 3/12 + DALYw_severity_visit10 * 6/12)\n\nseverity_DALY %>%\n  group_by(study_arm) %>%\n  summarize(mean(DALY_2yr) / 2)\n\n\n# A tibble: 2 × 2\n  study_arm `mean(DALY_2yr)/2`\n  <chr>                  <dbl>\n1 EUC                    0.323\n2 TSC                    0.300\n\n\nincremental cost (in Naira) for TSC - EUC per patient = 3203.91(2-yr) / 2829.74(3-yr)\ncurrency exchange rate in 2023: 490.4176 NGN\nincremental -DALY yearly for TSC - EUC per patient = -0.29992 - (-0.32292) = 0.023\nICER = 3203.91/(0.023*2*490.4176) = 142\nCEA threshold: 0.5 * GDPpc (2000 dollars in Nigeria) = 1000\n\nPrevious\nDALY = YLL + YLD, while the kind and severity of disease will impact the disability weight for YLD.\nThe YLD can be computed based on factor of I × DW × L with uniform age weights and zero discounting, where, I represents the number of incident cases of childhood epilepsy in a reference period, DW is the disability weight (0–1), and L is the mean duration of disability (years) (Murray and Lopez, 1996).\nFor severe epilepsy: 0.552; For seizure-free, treated epilepsy: 0.049 (GBD, 2016). — the severity of disability was weighted between 0 (perfect health) and 1 (equivalent to death).\nFor the population, the DALYs will be calculated by disease, country, gender, average age of onset, average age of death, incident cases and incident deaths. – as the country and gender will determine the life expectancy at age of premature death.\nJust for our dataset, it is impossible to gain the individual age of death. So we need to look for the average age of death for childhood epilepsy in Nigeria. – As few literature in this region, it is hard to get.\nThe first way is to use DALY from literature: 4.1 DALYs per 1000 individuals annually (Wagner, etc, 2015)[https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0145300] or 2.18 DALYs for children within the age group of 5-14 years(Ughasoro, etc, 2016) [https://www.sciencedirect.com/science/article/pii/S0920121116300699]\nas both numbers use an average disability weight, it is difficult but able to infer the DALY for severe and seizure free conditions.\nAs our 2 arms have different percents of severity, we can calculate the DALYs for each group.\nThe second way serves for the cost-effectiveness.\nIncremental effectiveness = DALY_TSC - DALY_EUC = YLL_TSC + YLD_TSC - YLL_EUC - YLD_EUC\nAs the two arms we have almost the same onset age, and we will also use the same age of premature death for 2 arms, YLL_TSC = YLL_EUC\nIncremental effectiveness = YLD_TSC - YLD_EUC ~ (Disability_weight_TSC - Disability_weight_EUC) * living_years\nDelete:If compare them annually per 1000 individuals, incremental effectiveness using DALY weight for each year for the same population size = (0.03 * 0.552 + 0.97 * 0.049) - (0.10 * 0.552 + 0.90 * 0.049) = -0.03521\nAlthough we can’t get an exact DALY for each arm, the cost-effectiveness analysis is more precise."
  },
  {
    "objectID": "bridge_brief.html#strengths",
    "href": "bridge_brief.html#strengths",
    "title": "BRIDGE Report",
    "section": "Strengths",
    "text": "Strengths\n\nThere’s few early literature working on the childhood epilepsy in Nigeria\nIt’s a long-period treatment with 10 follow-up visits, which is a good chance to observe the development process"
  },
  {
    "objectID": "bridge_brief.html#weakness",
    "href": "bridge_brief.html#weakness",
    "title": "BRIDGE Report",
    "section": "Weakness",
    "text": "Weakness\n\nThe records is not so complete: not all people complete the scale(especially the QOLIE) on the time and meeting the eligibility\nLots of assumptions has been made to clean the data"
  },
  {
    "objectID": "bridge_brief.html#future-work",
    "href": "bridge_brief.html#future-work",
    "title": "BRIDGE Report",
    "section": "Future work",
    "text": "Future work\nContent of Aim 3 in the protocol:\nDetermine the cost-effectiveness of the task-shifted epilepsy care intervention.\nDirect costs of the intervention and EUC will include personnel costs (including CHEW epilepsy training) and expenses for diagnostic (EEG, brain imaging) and laboratory tests and anti-epileptic drugs.\nIndirect costs will include travel time and time away from work for parents/guardians and change in school attendance for patients.\nCost-effectiveness will be expressed as US dollars per disability adjusted life year (DALY) averted.\nHalf-way to find the effectiveness of TSC."
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html",
    "href": "CVD_DES_CRN_abstract.html",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "",
    "text": "# source(\"random_draws_for_CVD_PSAs.R\")\n\n# output is the dataset\nRIPS_CVD_data = function(inputs){\n  results &lt;- NULL\n  attributes &lt;- NULL\n  #outputs &lt;- list()\n  \n  for (strategy in 0:1){\n    inputs$strategy = strategy\n    \n    run &lt;- exec.simulation(inputs)\n    run$strategy &lt;- strategy\n    \n    at &lt;- arrange(get_mon_attributes(env),name,key,time) #obtain attributes data\n    at$strategy &lt;- strategy\n    \n    if(is.null(results)) { results &lt;- run } else  {results &lt;- rbind(results, run)}\n    if(is.null(attributes)) { attributes &lt;- at } else  {attributes &lt;- rbind(attributes, at)}\n    rm(run)\n    rm(at)\n  }\n  \n  repeatSets = attributes %&gt;% filter((key == \"aGetCVD\" | key == \"aStatinsMildAdverse\" | key == \"aStatinsMajorAdverse\") & is.infinite(value))\n  \n  casted = setdiff(attributes, repeatSets) %&gt;% select(-replication, -time) %&gt;% spread(key, value)\n  \n  traces = results %&gt;% select(-start_time, -activity_time, -replication) %&gt;% spread(resource, end_time) %&gt;% \n    left_join(casted %&gt;% rename(statins_use = aUseStatins, initial_age = AgeInitial), by = c(\"name\", \"strategy\"))\n  \n  if (is.null(traces$statins_major_adverse_event)) {traces$statins_major_adverse_event = NA}\n  \n  # patientWcea = traces %&gt;% \n  #   rowwise() %&gt;%\n  #   mutate(\n  #     cost_disc = basic_CVD_costs_discounted(inputs, death_after_ASCVD, death_of_ASCVD, death_without_CVD, get_CVD, time_in_model, initial_age) + adjustment_statins_costs_discounted(inputs, statins_use, statins_mild_adverse_event, statins_major_adverse_event, get_CVD, time_in_model),\n  #     util_disc = adjusted_statins_utilities_discounted(inputs, statins_use, statins_mild_adverse_event, statins_major_adverse_event, get_CVD, time_in_model))\n  \n  cost_util = calc_cost_util(death_of_ASCVD_vec = traces$death_of_ASCVD,\n                             get_CVD_vec = traces$get_CVD, \n                             time_in_model_vec = traces$time_in_model, \n                             initial_age_vec = traces$initial_age,\n                             statins_use_vec = traces$statins_use, \n                             statins_mild_adverse_event_vec = traces$statins_mild_adverse_event, \n                             statins_major_adverse_event_vec = traces$statins_major_adverse_event, \n                             n_pop = nrow(traces),\n                             ar = inputs$annual_discount_rate,\n                             bgcost_coef_vec = coef(inputs$model_bgcost), \n                             cvdpct_coef_vec = coef(inputs$model_cvdpct),\n                             cAnnualFU_afterASCVD = inputs$cAnnualFU_afterASCVD,\n                             cNonFatalASCVD = inputs$cNonFatalASCVD,\n                             cFatalASCVD = inputs$cFatalASCVD,\n                             cAnnualStatin = inputs$cAnnualStatin,\n                             cMildStatinAdverse = inputs$cMildStatinAdverse,\n                             cMajorStatinAdverse = inputs$cMajorStatinAdverse,\n                             rInflation2017 = inputs$rInflation2017,\n                             uHealthy = inputs$uHealthy,\n                             uAfterASCVD = inputs$uAfterASCVD,\n                             uHealthyStatin = inputs$uHealthyStatin,\n                             uPenaltyMildStatinAdverse = inputs$uPenaltyMildStatinAdverse,\n                             uPenaltyMajorStatinAdverse = inputs$uPenaltyMajorStatinAdverse)\n  \n  patientWcea = cbind(traces, cost_util)\n  \n  return(patientWcea)\n}\n\n# output is the ICER\n\nRIPS_CVD_run = function(inputs){\n  \n  patientWcea = RIPS_CVD_data(inputs)\n  \n  strategyWcea = patientWcea %&gt;% \n    group_by(strategy) %&gt;%\n      summarize(\n        time_in_model = mean(time_in_model),\n        cost = mean(cost_disc), \n        QALY = mean(util_disc)) %&gt;%\n    mutate(strategy = ifelse(strategy == 1, \"Statins(2013 ACC/AHA)\", \"Status Quo\"))\n\n  df_cea = calculate_icers(cost = strategyWcea$cost,\n                         effect = strategyWcea$QALY,\n                         strategies = strategyWcea$strategy) %&gt;%\n    left_join(strategyWcea %&gt;% select(Strategy = strategy, LE = time_in_model))\n\n  return(df_cea)\n}\n\nstrategy_compare = function(patientWcea){\n  strategyWcea = patientWcea %&gt;% \n    group_by(strategy) %&gt;%\n    summarize(\n      time_in_model = mean(time_in_model),\n      cost = mean(cost_disc), \n      QALY = mean(util_disc)) %&gt;%\n    mutate(strategy = ifelse(strategy == 1, \"Treatment\", \"Status Quo\"))\n  \n  df_cea = calculate_icers(cost = strategyWcea$cost,\n                           effect = strategyWcea$QALY,\n                           strategies = strategyWcea$strategy) %&gt;%\n    left_join(strategyWcea %&gt;% select(Strategy = strategy, LE = time_in_model)) %&gt;%\n    mutate(NHB = Effect - Cost/100000)\n  \n  return(df_cea)\n}"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#inputs",
    "href": "CVD_DES_CRN_abstract.html#inputs",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "Inputs",
    "text": "Inputs\nSpahillari, et al. (2020)\n\nknitr::opts_chunk$set(eval = FALSE)\n\nparams = list(\n  ## basic/general from Stroke paper, 2023\n  strategy = 0, # or 1\n  vN = 1000,\n  vHorizon = 100, # all people should terminate before horizon\n  discount_rate = 0.03,\n  wtp = 100000,\n  CPI2017 = 245.12,\n  CPI2019 = 255.657,\n  CPI2020 = 258.811,\n  \n  ## events from paper 2017\n  rrStatinsASCVD = 0.79,\n  rrStatinsASCVD_low = 0.77,\n  rrStatinsASCVD_upp = 0.81,\n  rrStatinsASCVD_dist = \"lognormal\",\n  \n  hrAfterASCVD = 1.9,\n  hrAfterASCVD_low = 1.60,\n  hrAfterASCVD_upp = 2.40, \n  hrAfterASCVD_dist = \"lognormal\", # log-normal\n  \n  mortalityFirstYearASCVD_female_young = 0.09,\n  mortalityFirstYearASCVD_female_young_dist = \"beta\",\n  \n  mortalityFirstYearASCVD_female_old = 0.3,\n  mortalityFirstYearASCVD_female_old_dist = \"beta\",\n  \n  mortalityFirstYearASCVD_male_young = 0.14,\n  mortalityFirstYearASCVD_male_young_dist = \"beta\",\n  \n  mortalityFirstYearASCVD_male_old = 0.25,\n  mortalityFirstYearASCVD_male_old_dist = \"beta\",\n  \n  pMildStatinAdverse = 0.047,\n  pMildStatinAdverse_low = 0.047*0.85, \n  pMildStatinAdverse_upp = 0.047*1.15,\n  pMildStatinAdverse_dist = \"beta\",\n  \n  pMajorStatinAdverse = 0.006/100,\n  pMajorStatinAdverse_low = 0.006/100*0.85,\n  pMajorStatinAdverse_upp = 0.006/100*1.15,\n  pMajorStatinAdverse_dist = \"beta\",\n  \n  pMajorStatinAdverseBeingFatal = 0.09/100,\n  pMajorStatinAdverseBeingFatal_low = 0.09/100*0.85,\n  pMajorStatinAdverseBeingFatal_upp = 0.09/100*1.15,\n  pMajorStatinAdverseBeingFatal_dist = \"beta\",\n\n  ## utility\n  uHealthy = 1,\n  uAfterASCVD = 0.773,\n  uAfterASCVD_low = 0.773*0.85,\n  uAfterASCVD_upp = 0.773*1.15,\n  uAfterASCVD_dist = \"beta\",\n  \n  uHealthyStatin = 0.996,\n  uHealthyStatin_low = 0.991,\n  uHealthyStatin_upp = 1.000,\n  uHealthyStatin_dist = \"beta\",\n  \n  uPenaltyMildStatinAdverse = -0.0055,\n  uPenaltyMajorStatinAdverse = -0.0383,\n  \n  uDeath = 0,\n  \n  ## cost(2017)\n  cAnnualFU_afterASCVD = 3917,\n  cAnnualFU_afterASCVD_low = 2611,\n  cAnnualFU_afterASCVD_upp = 6528,\n  cAnnualFU_afterASCVD_dist = \"gamma\",\n  \n  cNonFatalASCVD = 49348,\n  cNonFatalASCVD_low = 49348*0.85,\n  cNonFatalASCVD_upp = 49348*1.15,\n  cNonFatalASCVD_dist = \"gamma\",\n  \n  cFatalASCVD = 16760,\n  cFatalASCVD_low = 16760*0.85,\n  cFatalASCVD_upp = 16760*1.15,\n  cFatalASCVD_dist = \"gamma\",\n  \n  cAnnualStatin = 84,\n  \n  cMildStatinAdverse = 215,\n  cMildStatinAdverse_low = 196,\n  cMildStatinAdverse_upp = 326,\n  cMildStatinAdverse_dist = \"gamma\",\n  \n  cMajorStatinAdverse = 8486,\n  cMajorStatinAdverse_low = 6920, \n  cMajorStatinAdverse_upp = 10314,\n  cMajorStatinAdverse_dist = \"gamma\",\n  \n  annual_discount_rate = 0.03,\n  \n  ### source：Agency for Healthcare Research and Quality. Mean expenditure per person by age groups, United States, 1996 to 2020. Medical Expenditure Panel Survey.(2020)\n  cHealthcareNonCVD_18_44 = 3901,\n  cHealthcareNonCVD_45_64 = 8693,\n  cHealthcareNonCVD_65 = 12441\n\n)\n## inflation\nparams$rInflation2017 = params$CPI2020 / params$CPI2017\nparams$rInflation2019 = params$CPI2020 / params$CPI2019\n\n## leave some spaces for PSA\n\n\n# simply change from prob to rate than to event\nProbToRate = function(prob, t){\n  -log(1-prob)/t\n}\n\nRateToProb = function(rate, t){\n  1 - exp(-rate*t)\n}\n# # what this t should be -- 10 years?\n# # time unit: year\n# rate = ProbToRate(pcr()/100)\n# days = rexp(1,rate)\n\ndiscounted &lt;- function(undiscounted, start_year, end_year, rate = params$annual_discount_rate)\n{\n  undiscounted / log(1 + rate) * (1 / (1+rate)^start_year - 1/ (1+rate)^end_year)\n}\n\ndiscount &lt;- function(value, A, ar=params$annual_discount_rate) value / (1+ar)^A"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#random-number-generator",
    "href": "CVD_DES_CRN_abstract.html#random-number-generator",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "Random Number Generator",
    "text": "Random Number Generator\nattributes and events for random:\n\n\n\n\n\n\n\n\n\nlocation\nattributes/events\nwithout CRN\nwith CRN\n\n\n\n\ninitialize_patient\nnhanesNo\nsample(1:nrow(nhanes_pop), 1, prob=1/nhanes_pop$WTMEC2YR))\nnhanes_pop$cum_weight = cumsum(nhanes_pop$WTMEC2YR / sum(nhanes_pop$WTMEC2YR))\n\n\nyears_till_death_without_CVD\naDeathWithoutCVD\nrgompertz(1, shape, rate)\nqgompertz(inputs$randomNums[(get_attribute(env,“patientID”))*length(rCRN) + rCRN[“rDeathWithoutCVD”]], shape, rate)\n\n\nyears_till_get_CVD\naGetCVD\nrexp(1,ProbToRate(prob, 10))\nqexp(inputs$randomNums[(get_attribute(env,“patientID”))*length(rCRN) + rCRN[“rGetCVD”]], ProbToRate(prob, 10))\n\n\nyears_till_death_of_ASCVD\naDeathOfASCVD\nsample(0:1, 1, prob = c(1-inputs$mortalityFirstYearASCVD, inputs$mortalityFirstYearASCVD))\nifelse(inputs$randomNums[(get_attribute(env,“patientID”))*length(rCRN) + rCRN[“rDeathOfASCVD”]] &lt; inputs$mortalityFirstYearASCVD, 1, 0)\n\n\nyears_till_death_after_ASCVD\naDeathAfterASCVD\nrgompertz(1, shape, rate)\nqgompertz(inputs$randomNums[(get_attribute(env,“patientID”))*length(rCRN) + rCRN[“rDeathAfterASCVD”]], shape, rate))\n\n\n\nAlso, need to remind who this individual is inside the DES simulation: get_attribute(env, “patientID”)\nCRN will also lead to the same result for the same event. Right now we just loop once, if more will set more CRN.\n\nset.seed(114514)\nrCRN = 1:8\nnames(rCRN) = c(\"nhanesNo\", \"rDeathWithoutCVD\", \"rGetCVD\", \"rDeathOfASCVD\", \"rDeathAfterASCVD\", \"rStatinsMildAdverse\", \"rStatinsMajorAdverse\", \"rDeathOfStatinsAdverse\")\n\nparams_CRN = params\nparams_CRN$nRN = params_CRN$vN * length(rCRN)\nparams_CRN$randomNums = runif(params_CRN$nRN)"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#gompertz-model",
    "href": "CVD_DES_CRN_abstract.html#gompertz-model",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "Gompertz Model",
    "text": "Gompertz Model\nWe use Gompertz model based on US cause-deleted life table to predict the death age.\n\n# source(\"nonCVD_life_table.R\")\n\n\n# # male\n# \n# mltNonCVD_long = data.frame(Age = rep(NA, ceiling(sum(mlt2020_nonCVD$dx))), Death = rep(1, ceiling(sum(mlt2020_nonCVD$dx))))\n# \n# start = 1\n# for (age in 0:(nrow(mlt2020_nonCVD)-1)) {\n#   n_row = round(mlt2020_nonCVD[age+1,\"dx\"])\n#   mltNonCVD_long[seq(start,(n_row + start - 1)),\"Age\"] = age\n#   start = start + n_row\n# }\n# \n# mltNonCVD_long = mltNonCVD_long %&gt;% drop_na()\n# \n# parameters_m = data.frame(\n#   Age = mlt2020_nonCVD$Age,\n#   shape=rep(NA,nrow(mlt2020_nonCVD)),\n#   rate=rep(NA,nrow(mlt2020_nonCVD)))\n# \n# \n# for (age in 0:nrow(mlt2020_nonCVD)-1) {\n#   surv.data &lt;- with(mltNonCVD_long[mltNonCVD_long$Age &gt;= age,], Surv(Age, Death, origin=age))\n#   surv.model &lt;- flexsurvreg(surv.data ~ 1, dist=\"gompertz\")\n# \n#   parameters_m$shape[age+1] &lt;- surv.model$coefficients[1]\n#   parameters_m$rate[age+1] &lt;- exp(surv.model$coefficients[2])\n# }\n# \n# # if start since 45-yr\n# # pgompertz(cycle, parameters_m$shape[46], parameters_m$rate[46])\n# \n# # female\n# \n# fltNonCVD_long = data.frame(Age = rep(NA, ceiling(sum(flt2020_nonCVD$dx))), Death = rep(1, ceiling(sum(flt2020_nonCVD$dx))))\n# \n# start = 1\n# for (age in 0:(nrow(flt2020_nonCVD)-1)) {\n#   n_row = round(flt2020_nonCVD[age+1,\"dx\"])\n#   fltNonCVD_long[seq(start,(n_row + start - 1)),\"Age\"] = age\n#   start = start + n_row\n# }\n# \n# fltNonCVD_long = fltNonCVD_long %&gt;% drop_na()\n# \n# parameters_f = data.frame(\n#   Age = flt2020_nonCVD$Age,\n#   shape=rep(NA,nrow(flt2020_nonCVD)),\n#   rate=rep(NA,nrow(flt2020_nonCVD)))\n# \n# \n# for (age in 0:nrow(flt2020_nonCVD)-1) {\n#   surv.data &lt;- with(fltNonCVD_long[fltNonCVD_long$Age &gt;= age,], Surv(Age, Death, origin=age))\n#   surv.model &lt;- flexsurvreg(surv.data ~ 1, dist=\"gompertz\")\n# \n#   parameters_f$shape[age+1] &lt;- surv.model$coefficients[1]\n#   parameters_f$rate[age+1] &lt;- exp(surv.model$coefficients[2])\n# }\n\nageAtDeath &lt;- function(currentAge, gender, inputs, patientID)\n{\n  # patientID = get_attribute(env, \"patientID\")\n  currentAge_f &lt;- floor(currentAge) #negative time to secular death issue\n  \n  # Male 1 FEMALE 2\n  if(gender == 2){\n    shape &lt;- parameters_f$shape[currentAge_f+1]\n    rate  &lt;- parameters_f$rate[currentAge_f+1]\n  } else {\n    shape &lt;- parameters_m$shape[currentAge_f+1]\n    rate  &lt;- parameters_m$rate[currentAge_f+1]\n  }\n  \n  min(currentAge + ifelse(is.null(inputs$randomNums), rgompertz(1, shape, rate), qgompertz(inputs$randomNums[(patientID-1)*length(rCRN) + rCRN[\"rDeathWithoutCVD\"]], shape, rate)), 100)\n}\n\n\n# # male\n# mlt2020_hr = data.frame(Age = 0:(nrow(mlt2020_nonCVD)-1), qx = sapply(sapply(mlt2020_nonCVD$qx, ProbToRate, t = 1) * inputs$hrAfterASCVD, RateToProb, t = 1), lx = rep(0,nrow(mlt2020_nonCVD)), dx = rep(NA,nrow(mlt2020_nonCVD)))\n# \n# mlt2020_hr[1,\"lx\"] = 100000\n# \n# for (i in 1:nrow(mlt2020_hr)) {\n#   if (mlt2020_hr[i, \"lx\"] &gt; 0) {\n#     mlt2020_hr[i, \"dx\"] = round(mlt2020_hr[i, \"qx\"] * mlt2020_hr[i, \"lx\"])\n#     mlt2020_hr[i+1, \"lx\"] = mlt2020_hr[i, \"lx\"] - mlt2020_hr[i, \"dx\"]\n#   }\n# }\n# mlt2020_hr  = mlt2020_hr %&gt;% filter(!is.na(dx))\n# \n# mltHr_long = data.frame(Age = rep(NA, 100000), Death = rep(1, 100000))\n# \n# start = 1\n# for (age in 0:(nrow(mlt2020_hr)-1)) {\n#   n_row = mlt2020_hr[age+1,\"dx\"]\n#   mltHr_long[seq(start,(n_row + start - 1)),\"Age\"] = age\n#   start = start + n_row\n# }\n# \n# parameters_m_hr = data.frame(\n#   Age = mlt2020_hr$Age,\n#   shape=rep(NA,nrow(mlt2020_hr)),\n#   rate=rep(NA,nrow(mlt2020_hr)))\n# \n# for (age in 0:nrow(mlt2020_hr)-1) {\n#   surv.data &lt;- with(mltHr_long[mltHr_long$Age &gt;= age,], Surv(Age, Death, origin=age))\n#   surv.model &lt;- flexsurvreg(surv.data ~ 1, dist=\"gompertz\")\n# \n#   parameters_m_hr$shape[age+1] &lt;- surv.model$coefficients[1]\n#   parameters_m_hr$rate[age+1] &lt;- exp(surv.model$coefficients[2])\n# }\n# \n# # female\n# \n# flt2020_hr = data.frame(Age = 0:(nrow(flt2020_nonCVD)-1), qx = sapply(sapply(flt2020_nonCVD$qx, ProbToRate, t = 1) * inputs$hrAfterASCVD, RateToProb, t = 1), lx = rep(0,nrow(flt2020_nonCVD)), dx = rep(NA,nrow(flt2020_nonCVD)))\n# \n# flt2020_hr[1,\"lx\"] = 100000\n# \n# for (i in 1:nrow(flt2020_hr)) {\n#   if (flt2020_hr[i, \"lx\"] &gt; 0) {\n#     flt2020_hr[i, \"dx\"] = round(flt2020_hr[i, \"qx\"] * flt2020_hr[i, \"lx\"])\n#     flt2020_hr[i+1, \"lx\"] = flt2020_hr[i, \"lx\"] - flt2020_hr[i, \"dx\"]\n#   }\n# }\n# flt2020_hr  = flt2020_hr %&gt;% filter(!is.na(dx))\n# \n# fltHr_long = data.frame(Age = rep(NA, 100000), Death = rep(1, 100000))\n# \n# start = 1\n# for (age in 0:(nrow(flt2020_hr)-1)) {\n#   n_row = flt2020_hr[age+1,\"dx\"]\n#   fltHr_long[seq(start,(n_row + start - 1)),\"Age\"] = age\n#   start = start + n_row\n# }\n# \n# parameters_f_hr = data.frame(\n#   Age = flt2020_hr$Age,\n#   shape=rep(NA,nrow(flt2020_hr)),\n#   rate=rep(NA,nrow(flt2020_hr)))\n# \n# for (age in 0:nrow(flt2020_hr)-1) {\n#   surv.data &lt;- with(fltHr_long[fltHr_long$Age &gt;= age,], Surv(Age, Death, origin=age))\n#   surv.model &lt;- flexsurvreg(surv.data ~ 1, dist=\"gompertz\")\n# \n#   parameters_f_hr$shape[age+1] &lt;- surv.model$coefficients[1]\n#   parameters_f_hr$rate[age+1] &lt;- exp(surv.model$coefficients[2])\n# }\n# \nageAtDeath_afterASCVD = function(currentAge, gender, inputs, patientID)\n{\n  # patientID = get_attribute(env,\"patientID\")\n  currentAge_f &lt;- floor(currentAge) #negative time to secular death issue\n\n  # Male 1 FEMALE 2\n  if(gender == 2)\n  {\n    shape &lt;- parameters_f_hr$shape[currentAge_f+1]\n    rate  &lt;- parameters_f_hr$rate[currentAge_f+1]\n    age = min(currentAge + ifelse(is.null(inputs$randomNums), rgompertz(1, shape, rate), qgompertz(inputs$randomNums[(patientID-1)*length(rCRN) + rCRN[\"rDeathAfterASCVD\"]], shape, rate)), max(parameters_f_hr$Age))\n  }\n  else\n  {\n    shape &lt;- parameters_m_hr$shape[currentAge_f+1]\n    rate  &lt;- parameters_m_hr$rate[currentAge_f+1]\n    age = min(currentAge + ifelse(is.null(inputs$randomNums), rgompertz(1, shape, rate), qgompertz(inputs$randomNums[(patientID-1)*length(rCRN) + rCRN[\"rDeathAfterASCVD\"]], shape, rate)), max(parameters_m_hr$Age))\n  }\n\n  age\n}\n# \n# save(parameters_f, parameters_m, parameters_f_hr, parameters_m_hr, file = \"life table/MarkovCVD_gompertz.RData\")\n\n# load(\"life table/MarkovCVD_gompertz.RData\")"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#pce",
    "href": "CVD_DES_CRN_abstract.html#pce",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "PCE",
    "text": "PCE\nWe use the pooled cohort equation to calculate the risk of CVD from risk factors.\nhttps://github.com/spgarbet/desdt/tree/main/framingham\n\n# source('pcr.R')\n# # the probability are percents!!"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#sample-population",
    "href": "CVD_DES_CRN_abstract.html#sample-population",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "Sample population",
    "text": "Sample population\nWe use NHANES study for the simulated population (limited by the PCE limits).\nUse the 2017-2018 version: https://wwwn.cdc.gov/nchs/nhanes/continuousnhanes/default.aspx?BeginYear=2017\n\n# ## SEQN: Respondent sequence number\n# # Examination: Body Measures\n# ## BMXBMI - Body Mass Index (kg/m**2)\n# ## 12.3 to 86.2   Range of Values\n# ## .  Missing\n# nhanes_data_1 = data.frame(read_xpt(\"./NHANES/BMX_J.XPT\", col_select = c(\"SEQN\",\"BMXBMI\")))\n# # Lab: Glycohemoglobin\n# ## LBXGH: Glycohemoglobin (%)\n# nhanes_data_2 = data.frame(read_xpt(\"./NHANES/GHB_J.XPT\", col_select = c(\"SEQN\",\"LBXGH\")))\n# # Examination: Blood Pressure\n# ## BPXSY1 - Systolic: Blood pres (1st rdg) mm Hg\n# ## BPXDI1 - Diastolic: Blood pres (1st rdg) mm Hg\n# ## 0 to 136   Range of Values\n# ## .  Missing\n# nhanes_data_3 = data.frame(read_xpt(\"./NHANES/BPX_J.XPT\", col_select = c(\"SEQN\",\"BPXDI1\",\"BPXSY1\")))\n# # Demographic Variables and Sample Weights\n# ## RIAGENDR - Gender\n# ## 1  Male\n# ## 2  Female  \n# ## .  Missing\n# ## RIDAGEYR - Age in years at screening\n# ## 0 to 79    Range of Values\n# ## 80 80 years of age and over\n# ## .  Missing\n# \n# ## RIDRETH1 - Race/Hispanic origin\n# ## 1  Mexican American    1367    1367    \n# ## 2  Other Hispanic  820 2187    \n# ## 3  Non-Hispanic White  3150    5337    \n# ## 4  Non-Hispanic Black  2115    7452    \n# ## 5  Other Race - Including Multi-Racial 1802    9254    \n# ## .  Missing\n# \n# ## WTMEC2YR - Full sample 2 year MEC exam weight\n# ## 2566.1838545 to 419762.83649   Range of Values\n# ## 0  Not MEC Examined\n# ## .  Missing\n# nhanes_data_4 = data.frame(read_xpt(\"./NHANES/DEMO_J.XPT\", col_select = c(\"SEQN\",\"RIDAGEYR\",\"RIAGENDR\",\"RIDRETH1\",\"WTMEC2YR\"))) #WTMEC2YR is the sample weights variable\n# # Questionnaire: Diabetes\n# ## DIQ010 - Doctor told you have diabetes\n# ## 1  Yes\n# ## 2  No\n# ## 3  Borderline\n# ## 7  Refused\n# ## 9  Don't know\n# ## .  Missing\n# nhanes_data_5 = data.frame(read_xpt(\"./NHANES/DIQ_J.XPT\", col_select = c(\"SEQN\",\"DIQ010\")))\n# # Lab: Cholesterol - High - Density Lipoprotein\n# ## LBDHDD: Direct HDL-Cholesterol (mg/dL)\n# nhanes_data_6 = data.frame(read_xpt(\"./NHANES/HDL_J.XPT\", col_select = c(\"SEQN\",\"LBDHDD\")))\n# # Questionnaire: medical conditions\n# ## MCQ160d: Ever told you had angina/angina pectoris\n# ## MCQ160e: Ever told you had heart attack\n# ## MCQ160f: Ever told you had a stroke\n# ## 1  Yes\n# ## 2  No\n# ## 7  Refused \n# ## 9  Don't know\n# ## .  Missing\n# nhanes_data_7 = data.frame(read_xpt(\"./NHANES/MCQ_J.XPT\", col_select = c(\"SEQN\",\"MCQ160D\",\"MCQ160F\",\"MCQ160E\")))\n# # Questionnaire: Smoking - Cigarette Use\n# ## SMQ040: Do you now smoke cigarettes?\n# ## 1  Every day\n# ## 2  Some days\n# ## 3  Not at all  \n# ## 7  Refused\n# ## 9  Don't know\n# ## .  Missing\n# nhanes_data_8 = data.frame(read_xpt(\"./NHANES/SMQ_J.XPT\", col_select = c(\"SEQN\",\"SMQ040\")))\n# # Lab: Cholesterol - Total\n# ## LBXTC: Total Cholesterol (mg/dL)\n# nhanes_data_9 = data.frame(read_xpt(\"./NHANES/TCHOL_J.XPT\", col_select = c(\"SEQN\",\"LBXTC\")))\n# nhanes_data_10 = data.frame(read_xpt(\"./NHANES/BPQ_J.XPT\", col_select = c(\"SEQN\", \"BPQ050A\")))\n# # Lab: Cholesterol - Low-Density Lipoproteins (LDL)\n# ## LBDLDL - LDL-Cholesterol, Friedewald (mg/dL)\n# nhanes_data_11 = data.frame(read_xpt(\"./NHANES/TRIGLY_J.XPT\", col_select = c(\"SEQN\", \"LBDLDL\")))\n# \n# nhanes_data_raw &lt;- list(nhanes_data_1,nhanes_data_2,nhanes_data_3,nhanes_data_4,\n#                         nhanes_data_5,nhanes_data_6,nhanes_data_7,nhanes_data_8,\n#                         nhanes_data_9,nhanes_data_10,nhanes_data_11)\n# nhanes_data_raw &lt;- data.frame(reduce(nhanes_data_raw, full_join, by='SEQN'))\n# nhanes_pop = nhanes_data_raw %&gt;%\n#   # whether needs to check missing data\n#   filter(WTMEC2YR != 0 & RIDAGEYR &gt;= 40 & RIDAGEYR &lt;= 79 & LBXTC &gt;= 30 & LBXTC &lt;= 500 & LBDHDD &gt;= 5 & LBDHDD &lt;= 200 & BPXSY1 &gt;= 60 & BPXSY1 &lt;= 200) %&gt;%\n#   drop_na() %&gt;%\n#   mutate(RIDRETH1 = ifelse(RIDRETH1 == 3, 1, ifelse(RIDRETH1 == 4, 2, ifelse(RIDRETH1 %in% c(1,2), 3, 4))))\n# \n# nhanes_pop$cum_weight = cumsum(nhanes_pop$WTMEC2YR / sum(nhanes_pop$WTMEC2YR))\n# \nrace = 1:4\nnames(race) = c(\"White\", \"African American\", \"Hispanic\", \"Other\")\nrace_convert = function(num) {\n  return(names(race[num]))\n}\n\nbp_treatment = 1:2\nnames(bp_treatment) = c(\"Yes\",\"No\")\n\nsmoker = 1:3\nnames(smoker) = c(\"Every day\",\"Some days\",\"Not at all\")\n\ndiabetic = 1:2\nnames(diabetic) = c(\"Yes\",\"No\")\n# \n# save(nhanes_pop, nhanes_data_raw, file = \"./NHANES/nhanes_full.RData\")\n\n# load(\"./NHANES/nhanes_full.RData\")\n\n\n# for CRN, add an identifier\ninitialize_patient &lt;- function(traj, inputs)\n{\n        traj %&gt;%\n                seize(\"time_in_model\")       %&gt;%\n                set_attribute(\"patientID\", function()\n                  # patientID is 0-index\n                  as.numeric(str_remove(get_name(env), \"patient\"))) %&gt;%\n                # NHANES version\n                set_attribute(\"nhanesNo\",         function() ifelse(\n                  is.null(inputs$randomNums),\n                  sample(1:nrow(nhanes_pop), 1, prob=nhanes_pop$WTMEC2YR),\n                  which(nhanes_pop$cum_weight&gt;=inputs$randomNums[(get_attribute(env,\"patientID\"))*length(rCRN) + rCRN[\"nhanesNo\"]])[1])) %&gt;%\n                set_attribute(\"Gender\",     function() nhanes_pop$RIAGENDR[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"Age\",        function() nhanes_pop$RIDAGEYR[get_attribute(env, \"nhanesNo\")]) %&gt;% \n                set_attribute(\"AgeInitial\", function() get_attribute(env, \"Age\")) %&gt;%\n                set_attribute(\"Race\",       function() nhanes_pop$RIDRETH1[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"TotChol\",    function() nhanes_pop$LBXTC[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"HdlChol\",    function() nhanes_pop$LBDHDD[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"LdlChol\",   function()\nnhanes_pop$LBDLDL[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"SystolicBp\", function() nhanes_pop$BPXSY1[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"BpTreatment\",function() nhanes_pop$BPQ050A[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"Smoker\",      function() nhanes_pop$SMQ040[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"Diabetic\",    function() nhanes_pop$DIQ010[get_attribute(env, \"nhanesNo\")]) %&gt;%\n                set_attribute(\"PrsZ\",       function() 0) %&gt;%\n                set_attribute(\"PCErisk\",    function()\n  pcr(gender = ifelse(get_attribute(env, \"Gender\") == 1, 'M', 'F'),\n             get_attribute(env,\"AgeInitial\"),\n             race_convert(get_attribute(env, \"Race\")),\n             get_attribute(env, \"TotChol\"),\n             get_attribute(env, \"HdlChol\"),\n             get_attribute(env, \"SystolicBp\"),\n             (get_attribute(env, \"BpTreatment\") == 1),\n             (get_attribute(env, \"Smoker\") %in% c(1,2)),\n             (get_attribute(env, \"Diabetic\") == 1),\n             get_attribute(env, \"PrsZ\")\n             )[1]/100) %&gt;%\n                set_attribute(\"Strategy\", function() inputs$strategy) %&gt;%\n                set_attribute(\"aUseStatins\", function()\n                  ifelse(get_attribute(env, \"Strategy\") == 1 &\n                           (get_attribute(env, \"LdlChol\") &gt;= 190 |\n                            get_attribute(env, \"PCErisk\") &gt;= 0.075 |\n                            get_attribute(env, \"Diabetic\") == 1), 1, 0))\n}"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#run",
    "href": "CVD_DES_CRN_abstract.html#run",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "run",
    "text": "run\nTwo versions of event_registry –\n\n# source(\"DES.R\")\n\nenv = simmer(\"CVD\")\n\nexec.simulation &lt;- function(inputs)\n{\n        #set.seed(11451428)\n        env  &lt;&lt;- simmer(\"CVD\")\n        traj &lt;- simulation(env, inputs)\n        env %&gt;% create_counters(counters)\n        \n        env %&gt;%\n                add_generator(\"patient\", traj, at(rep(0, inputs$vN)), mon=2) %&gt;%\n                run(inputs$vHorizon+1e-6) %&gt;% # Simulate just past horizon\n                wrap()\n        \n        get_mon_arrivals(env, per_resource = T)\n}"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#statins-cea",
    "href": "CVD_DES_CRN_abstract.html#statins-cea",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "Statins CEA",
    "text": "Statins CEA\n\nx &lt;- c(31.5, 55, 80)\ny &lt;- c(3901, 8693, 12441)\nparams$model_bgcost &lt;- lm(y ~ x)\n\nx &lt;- c(50, 60, 70, 80, 90)\ny &lt;- c((10.1+4.2)/2/100, (21.4+8.9)/2/100, (34.6+20.0)/2/100, (59.2+40.2)/2/100, (74.4+65.2)/2/100)\nparams$model_cvdpct &lt;- lm(y ~ x)\n\n\ncHealthy = function(inputs, age) {\n  x &lt;- c(31.5, 55, 80)\n  y &lt;- c(3901, 8693, 12441)\n\n  model_bgcost &lt;- lm(y ~ x)\n  intercept_bgcost = coef(model_bgcost)[1]\n  slope_bgcost = coef(model_bgcost)[2]\n\n  x &lt;- c(50, 60, 70, 80, 90)\n  y &lt;- c((10.1+4.2)/2/100, (21.4+8.9)/2/100, (34.6+20.0)/2/100, (59.2+40.2)/2/100, (74.4+65.2)/2/100)\n\n  model_cvdpct &lt;- lm(y ~ x)\n  intercept_cvdpct = coef(model_cvdpct)[1]\n  slope_cvdpct = coef(model_cvdpct)[2]\n  \n  cvdpct = max(intercept_cvdpct + slope_cvdpct*age,0)\n\n  (intercept_bgcost + slope_bgcost*age - cvdpct*(inputs$cAnnualFU_afterASCVD + inputs$cNonFatalASCVD/10)) / (1 - cvdpct)\n}\n\nbasic_CVD_costs = function(inputs, death_after_ASCVD, death_of_ASCVD, death_without_CVD, get_CVD, time_in_model, initial_age) {\n  cost = 0\n  ##cHealthcareNonCVD\n  # if (initial_age &lt; 45) {\n  #   cost = cost + inputs$rInflation2019 * inputs$cHealthcareNonCVD_18_44 * (min(45, time_in_model + initial_age) - initial_age) + inputs$rInflation2019 * inputs$cHealthcareNonCVD_45_64 * (max(time_in_model + initial_age, 45) - 45)\n  # } else if (initial_age &gt;= 45 & initial_age &lt; 55) {\n  #   cost = cost + inputs$rInflation2019 * inputs$cHealthcareNonCVD_45_64 * time_in_model\n  # } else if (initial_age &gt;= 55 & initial_age &lt; 65) {\n  #   cost = cost + inputs$rInflation2019 * inputs$cHealthcareNonCVD_45_64 * (min(65, time_in_model + initial_age) - initial_age) + inputs$rInflation2019 * inputs$cHealthcareNonCVD_65 * (max(time_in_model + initial_age, 65) - 65)\n  # } else {\n  #   cost = cost + inputs$rInflation2019 * inputs$cHealthcareNonCVD_65 * time_in_model\n  # }\n  cost = cost + sum(sapply(initial_age:floor(min(ifelse(is.na(get_CVD),Inf,get_CVD),time_in_model)+initial_age), function(x) cHealthy(inputs, x)))\n  \n  # FatalASCVD\n  if(!is.na(get_CVD) & !is.na(death_of_ASCVD)) {\n    cost = cost + inputs$rInflation2017 * inputs$cFatalASCVD\n  }\n  \n  # Non-Fatal ASCVD\n  if(!is.na(get_CVD) & is.na(death_of_ASCVD)) {\n    cost = cost + inputs$rInflation2017 * inputs$cNonFatalASCVD + inputs$rInflation2017 * inputs$cAnnualFU_afterASCVD * (time_in_model - get_CVD - 1)\n  }\n  return(cost)\n}\n\nadjustment_statins_costs = function(inputs, statins_use, statins_mild_adverse_event, statins_major_adverse_event, get_CVD, time_in_model){\n  if (statins_use == 1){\n    inputs$cAnnualStatin * min(ifelse(is.na(get_CVD),Inf,get_CVD),time_in_model) * inputs$rInflation2017 + \n    ifelse(!is.na(statins_major_adverse_event), inputs$cMajorStatinAdverse, ifelse(!is.na(statins_mild_adverse_event), inputs$cMildStatinAdverse, 0))\n  } else 0\n}\n\n# basic_CVD_utilties = function(inputs, get_CVD, time_in_model){\n#   if (is.na(get_CVD)) {\n#     utility = inputs$uHealthy * time_in_model\n#   } else {\n#     utility = inputs$uHealthy * get_CVD + inputs$uAfterASCVD * (time_in_model - get_CVD)\n#   }\n#   return(utility)\n# }\n\nadjusted_statins_utilities = function(inputs, statins_use, statins_mild_adverse_event, statins_major_adverse_event, get_CVD, time_in_model){\n  if (statins_use == 1) {\n    if (!is.na(statins_major_adverse_event)){\n      uStatins = inputs$uHealthyStatin - inputs$uPenaltyMajorStatinAdverse\n    } else if (!is.na(statins_mild_adverse_event)) {\n      uStatins = inputs$uHealthyStatin - inputs$uPenaltyMildStatinAdverse\n    } else {\n      uStatins = inputs$uHealthyStatin\n    }\n    \n    if (is.na(get_CVD)) {uStatins * time_in_model}\n    else { uStatins * get_CVD + inputs$uAfterASCVD * (time_in_model - get_CVD)}\n  \n    } else {\n    if (is.na(get_CVD)) {return(inputs$uHealthy * time_in_model)\n    } else {return(inputs$uHealthy * get_CVD + inputs$uAfterASCVD * (time_in_model - get_CVD))}\n  }\n}"
  },
  {
    "objectID": "CVD_DES_CRN_abstract.html#discounting",
    "href": "CVD_DES_CRN_abstract.html#discounting",
    "title": "Common Random Numbers in Discrete Event Simulation for Disease Modeling: A Statin Treatment Case Study",
    "section": "Discounting",
    "text": "Discounting\n\nbasic_CVD_costs_discounted = function(inputs, death_after_ASCVD, death_of_ASCVD, death_without_CVD, get_CVD, time_in_model, initial_age) {\n  cost = 0\n  ##cHealthcareNonCVD\n  cost = cost + discounted(sum(sapply(initial_age:floor(min(ifelse(is.na(get_CVD),Inf,get_CVD),time_in_model)+initial_age), function(x) cHealthy(inputs, x))), start_year = 0, end_year = min(ifelse(is.na(get_CVD),Inf,get_CVD),time_in_model))\n  \n  # FatalASCVD\n  if(!is.na(get_CVD) & !is.na(death_of_ASCVD)) {\n    cost = cost + discount(inputs$rInflation2017 * inputs$cFatalASCVD, A = death_of_ASCVD)\n  }\n  \n  # Non-Fatal ASCVD\n  if(!is.na(get_CVD) & is.na(death_of_ASCVD)) {\n    cost = cost + discount(inputs$rInflation2017 * inputs$cNonFatalASCVD, A= get_CVD) + discounted(inputs$rInflation2017 * inputs$cAnnualFU_afterASCVD * (time_in_model - get_CVD - 0.5), start_year = get_CVD + 0.5, end_year = time_in_model)\n  }\n  return(cost)\n}\n\nadjustment_statins_costs_discounted = function(inputs, statins_use, statins_mild_adverse_event, statins_major_adverse_event, get_CVD, time_in_model){\n  if (statins_use == 1){\n    discounted(inputs$cAnnualStatin * min(ifelse(is.na(get_CVD),Inf,get_CVD),time_in_model) * inputs$rInflation2017, start_year = 0, end_year = min(ifelse(is.na(get_CVD),Inf,get_CVD),time_in_model)) +\n    ifelse(!is.na(statins_major_adverse_event), discount(inputs$cMajorStatinAdverse, A=0), ifelse(!is.na(statins_mild_adverse_event), discount(inputs$cMildStatinAdverse,A=0), 0))\n  } else 0\n}\n\nadjusted_statins_utilities_discounted = function(inputs, statins_use, statins_mild_adverse_event, statins_major_adverse_event, get_CVD, time_in_model){\n  if (statins_use == 1) {\n    if (!is.na(statins_major_adverse_event)){\n      uStatins = inputs$uHealthyStatin - inputs$uPenaltyMajorStatinAdverse\n    } else if (!is.na(statins_mild_adverse_event)) {\n      uStatins = inputs$uHealthyStatin - inputs$uPenaltyMildStatinAdverse\n    } else {\n      uStatins = inputs$uHealthyStatin\n    }\n    \n    if (is.na(get_CVD)) { discounted(uStatins * time_in_model, start_year = 0, end_year = time_in_model)}\n    else { discounted(uStatins * get_CVD, start_year = 0, end_year = get_CVD) + discounted(inputs$uAfterASCVD * (time_in_model - get_CVD), start_year = get_CVD, end_year = time_in_model)}\n  \n    } else {\n    if (is.na(get_CVD)) {\n      return(discounted(inputs$uHealthy * time_in_model, start_year = 0, end_year = time_in_model))\n    } else {\n      return(discounted(inputs$uHealthy * get_CVD, start_year = 0, end_year = get_CVD) + discounted(inputs$uAfterASCVD * (time_in_model - get_CVD), start_year = get_CVD, end_year = time_in_model))\n      }\n  }\n}"
  }
]