<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Astrid Yu, Ashley Leech">
<meta name="dcterms.date" content="2023-11-25">

<title>Hanxuan (Astrid) Yu - Add the Time-Varying Variable into Markov Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Hanxuan (Astrid) Yu</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="https://www.dropbox.com/scl/fi/izravfw594wzi7wv3f7zo/Hanxuan-Yu-s-CV.docx?rlkey=qhl43x2xkfhqi3vvvnfy9egzl&amp;dl=0" aria-current="page">CV</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://docs.google.com/presentation/d/14GNKasC5HI-crZDAPIGCzjMvDzJSXbWdRWEyJ6yUfak/edit?usp=sharing">Intro</a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">Projects</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="./bridge_brief.html">
 <span class="dropdown-text">BRIDGE Report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./CVD_DES_CRN_abstract.html">
 <span class="dropdown-text">CRNs in DES</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-links" role="button" data-bs-toggle="dropdown" aria-expanded="false">Links</a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-links">    
        <li>
    <a class="dropdown-item" href="https://smdm-europe23-what-they-didnt-teach.netlify.app/">
 <span class="dropdown-text">SMDM Europe Short Course (2023)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://vchem-vital-workshop-2022.netlify.app/">
 <span class="dropdown-text">Health Economics Modeling Workshop (2022)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://decision-analysis-2023.netlify.app/">
 <span class="dropdown-text">PUBH 5512 (2023)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/hanxuan_yu"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/phos2000"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Add the Time-Varying Variable into Markov Model</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">About Me</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://www.dropbox.com/scl/fi/izravfw594wzi7wv3f7zo/Hanxuan-Yu-s-CV.docx?rlkey=qhl43x2xkfhqi3vvvnfy9egzl&amp;dl=0" class="sidebar-item-text sidebar-link">Curriculum Vitae</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">Projects</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bridge_brief.html" class="sidebar-item-text sidebar-link">BRIDGE Report</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CVD_DES_CRN_abstract.html" class="sidebar-item-text sidebar-link">CRNs in DES</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Labs</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MarkovDA.html" class="sidebar-item-text sidebar-link">How to Create Markov Model using R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AddingMortality.html" class="sidebar-item-text sidebar-link active">Add the Time-Varying Variable into Markov Model</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">Links to other webs</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://smdm-europe23-what-they-didnt-teach.netlify.app/" class="sidebar-item-text sidebar-link">SMDM Europe Short Course (2023)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://vchem-vital-workshop-2022.netlify.app/" class="sidebar-item-text sidebar-link">Health Economics Modeling Workshop (2022)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="https://decision-analysis-2023.netlify.app/" class="sidebar-item-text sidebar-link">PUBH 5512 (2023)</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dive-into-life-table" id="toc-dive-into-life-table" class="nav-link active" data-scroll-target="#dive-into-life-table">Dive into Life Table</a>
  <ul class="collapse">
  <li><a href="#where-to-get-the-us-life-table" id="toc-where-to-get-the-us-life-table" class="nav-link" data-scroll-target="#where-to-get-the-us-life-table">Where to get the US life table</a></li>
  <li><a href="#where-to-get-the-specific-cause-death" id="toc-where-to-get-the-specific-cause-death" class="nav-link" data-scroll-target="#where-to-get-the-specific-cause-death">Where to get the specific-cause death</a></li>
  <li><a href="#how-to-build-the-cause-deleted-life-table" id="toc-how-to-build-the-cause-deleted-life-table" class="nav-link" data-scroll-target="#how-to-build-the-cause-deleted-life-table">How to build the cause-deleted life table</a></li>
  </ul></li>
  <li><a href="#build-a-loop-to-process-markov-traces-with-background-mortality" id="toc-build-a-loop-to-process-markov-traces-with-background-mortality" class="nav-link" data-scroll-target="#build-a-loop-to-process-markov-traces-with-background-mortality">Build a Loop to Process Markov Traces with Background Mortality</a>
  <ul class="collapse">
  <li><a href="#not-using-expm" id="toc-not-using-expm" class="nav-link" data-scroll-target="#not-using-expm">Not Using expm</a></li>
  <li><a href="#using-expm" id="toc-using-expm" class="nav-link" data-scroll-target="#using-expm">Using expm</a></li>
  </ul></li>
  <li><a href="#icer-re-calculation" id="toc-icer-re-calculation" class="nav-link" data-scroll-target="#icer-re-calculation">ICER Re-Calculation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Add the Time-Varying Variable into Markov Model</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Astrid Yu, Ashley Leech </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 25, 2023</p>
    </div>
  </div>
    
  </div>
  

</header>

<p>Based on the last tutorial of Markov Model in R, we will add background mortality using a cause-deleted life table.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># knit('MarkovDA.qmd', tangle=TRUE)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># source('MarkovDA.R')</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">purl</span>(<span class="st">"MarkovDA.qmd"</span>, <span class="at">output =</span> <span class="fu">tempfile</span>()))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"scipen"</span><span class="ot">=</span><span class="dv">1000</span>, <span class="st">"digits"</span><span class="ot">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="dive-into-life-table" class="level1">
<h1>Dive into Life Table</h1>
<section id="where-to-get-the-us-life-table" class="level2">
<h2 class="anchored" data-anchor-id="where-to-get-the-us-life-table">Where to get the US life table</h2>
<p><a href="https://www.cdc.gov/nchs/products/life_tables.htm" class="uri">https://www.cdc.gov/nchs/products/life_tables.htm</a> [CDC website]</p>
<p>We are using United States Life Tables(2020) – remember to distinguish the life tables for the male and the female.</p>
<p>Male: <a href="https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/NVSR/71-01/Table02.xlsx" class="uri">https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/NVSR/71-01/Table02.xlsx</a></p>
<p>Female: <a href="https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/NVSR/71-01/Table03.xlsx" class="uri">https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/NVSR/71-01/Table03.xlsx</a></p>
<table class="table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>qx</td>
<td>Probability of dying between ages x and x + 1</td>
</tr>
<tr class="even">
<td>lx</td>
<td>Number surviving to age x</td>
</tr>
<tr class="odd">
<td>dx</td>
<td>Number dying between ages x and x + 1</td>
</tr>
<tr class="even">
<td>Lx</td>
<td>Person-years lived between ages x and x + 1</td>
</tr>
<tr class="odd">
<td>Tx</td>
<td>Total number of person-years lived above age x</td>
</tr>
<tr class="even">
<td>ex</td>
<td>Expectation of life at age x</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>input_file <span class="ot">=</span> <span class="fu">normalizePath</span>(<span class="fu">here</span>(<span class="st">"exercise/markov_exercise_phd.xlsx"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>life_table_raw <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(input_file,<span class="at">sheet=</span><span class="st">"Life Table - Male"</span>,<span class="at">col_types =</span><span class="st">"numeric"</span>)[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(life_table_raw) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"qx"</span>, <span class="st">"lx"</span>, <span class="st">"dx"</span>, <span class="st">"Lx"</span>, <span class="st">"Tx"</span>, <span class="st">"ex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="where-to-get-the-specific-cause-death" class="level2">
<h2 class="anchored" data-anchor-id="where-to-get-the-specific-cause-death">Where to get the specific-cause death</h2>
<p>Here we set all our patients are initially <strong>45-yr men with the prostate cancer</strong>.</p>
<p><a href="https://vizhub.healthdata.org/gbd-results/" class="uri">https://vizhub.healthdata.org/gbd-results/</a>[GBD query tool]</p>
<p>GBD results provide the % of deaths due to a specific cause by age (every 5 years) and sex groups.</p>
<p>Using filters like:</p>
<p><img src="exercise/prostate-cancer-cause-death.png" class="img-fluid"></p>
<p><img src="exercise/GBD-download-request.png" class="img-fluid"></p>
</section>
<section id="how-to-build-the-cause-deleted-life-table" class="level2">
<h2 class="anchored" data-anchor-id="how-to-build-the-cause-deleted-life-table">How to build the cause-deleted life table</h2>
<p>The GBD result of death caused by prostate cancer is divided by age groups, which we need to expand to match the original life table.</p>
<p>non-Cause death = all the death * (1 - percent_of_caused_death)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cause_death_m <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">"exercise/GBD_2019_prostate.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age,val,upper,lower)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>cause_death_m1 <span class="ot">=</span> cause_death_m <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(age, <span class="st">"&lt;"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="dv">0</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">reptimes =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(age,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">'&lt;'</span>, age))[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">' '</span>, age))[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">end =</span> start <span class="sc">+</span> reptimes <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>cause_death_m2 <span class="ot">=</span> cause_death_m <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(age,<span class="st">"-"</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">str_detect</span>(age, <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  rowwise <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(age,<span class="dv">1</span>,<span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">'-'</span>, age))[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">end =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(age,<span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">'-'</span>, age))[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>,<span class="fu">str_length</span>(age))),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">reptimes =</span> end <span class="sc">-</span> start <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>cause_death_m3 <span class="ot">=</span> cause_death_m <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(age,<span class="st">"-"</span>) <span class="sc">&amp;</span> <span class="fu">str_detect</span>(age, <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  rowwise <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(age,<span class="dv">1</span>,<span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">'-'</span>, age))[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">end =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(age,<span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">'-'</span>, age))[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>,<span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">' '</span>, age))[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">reptimes =</span> end <span class="sc">-</span> start <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>cause_death_m4 <span class="ot">=</span> cause_death_m <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(age, <span class="st">"[+] "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">end =</span> <span class="fu">max</span>(life_table_raw<span class="sc">$</span>Age),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">as.numeric</span>(<span class="fu">str_sub</span>(age, <span class="dv">1</span>, <span class="fu">unlist</span>(<span class="fu">gregexpr</span>(<span class="st">'[+] '</span>, age))[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">reptimes =</span> end <span class="sc">-</span> start <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>cause_death_male <span class="ot">=</span> <span class="fu">rbind</span>(</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(cause_death_m1, rep, cause_death_m1<span class="sc">$</span>reptimes)) <span class="sc">%&gt;%</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Age =</span> start <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>(),</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(cause_death_m2, rep, cause_death_m2<span class="sc">$</span>reptimes)) <span class="sc">%&gt;%</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Age =</span> start <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>(),</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(cause_death_m3, rep, cause_death_m3<span class="sc">$</span>reptimes)) <span class="sc">%&gt;%</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Age =</span> start <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>(),</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(cause_death_m4, rep, cause_death_m4<span class="sc">$</span>reptimes)) <span class="sc">%&gt;%</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age) <span class="sc">%&gt;%</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Age =</span> start <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Age) <span class="sc">%&gt;%</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Age, val, upper, lower)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>maxage <span class="ot">=</span> <span class="fu">min</span>(<span class="fu">max</span>(life_table_raw<span class="sc">$</span>Age), <span class="fu">max</span>(cause_death_male<span class="sc">$</span>Age))</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>minage_cause <span class="ot">=</span> <span class="fu">min</span>(cause_death_male<span class="sc">$</span>Age)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>mlt2020 <span class="ot">=</span> life_table_raw[(minage_cause<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(maxage<span class="sc">+</span><span class="dv">1</span>),]</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="do">## dx</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>mlt2020_nonCause <span class="ot">=</span> <span class="fu">rbind</span>(life_table_raw[<span class="dv">1</span><span class="sc">:</span>minage_cause, <span class="fu">c</span>(<span class="st">"Age"</span>,<span class="st">"dx"</span>)],</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>(<span class="at">Age =</span> minage_cause<span class="sc">:</span>maxage, </span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">dx =</span> mlt2020[, <span class="st">"dx"</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>cause_death_male[, <span class="st">"val"</span>])))</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>mlt2020_cause <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Age =</span> minage_cause<span class="sc">:</span>maxage,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dx =</span> mlt2020[, <span class="st">"dx"</span>] <span class="sc">*</span> cause_death_male[, <span class="st">"val"</span>])</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(mlt2020_cause$dx) + sum(mlt2020_nonCause$dx)</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="co"># directly using the percent and qx</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(life_table_raw)) {</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">%in%</span> (minage_cause<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(maxage<span class="sc">+</span><span class="dv">1</span>)) {</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    mlt2020_nonCause[i, <span class="st">"qx"</span>] <span class="ot">=</span> life_table_raw[i, <span class="st">"qx"</span>] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>cause_death_male[i <span class="sc">-</span> minage_cause, <span class="st">"val"</span>])</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    mlt2020_nonCause[i, <span class="st">"qx"</span>] <span class="ot">=</span> life_table_raw[i, <span class="st">"qx"</span>]</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co"># back dx to qx</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co"># for (i in 1:nrow(mlt2020_nonCause)){</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   mlt2020_nonCause[i, "qx"] = mlt2020_nonCause[i, "dx"] / sum(life_table_raw[i:nrow(life_table_raw), "dx"])</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mlt2020_nonCause, <span class="st">"exercise/cause-deleted-mlt.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="build-a-loop-to-process-markov-traces-with-background-mortality" class="level1">
<h1>Build a Loop to Process Markov Traces with Background Mortality</h1>
<p>Before we have build the Markov traces without considering background mortality.</p>
<p>Here we will build new Markov traces with one more column – number of death caused by pure background mortality.</p>
<section id="not-using-expm" class="level2">
<h2 class="anchored" data-anchor-id="not-using-expm">Not Using expm</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here use the cause-deleted life table</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>m_M_wBG <span class="ot">=</span> death_background <span class="ot">=</span> death_cancer <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># setting</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>start_age <span class="ot">=</span> <span class="dv">45</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_strategies) {</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#initialization</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  death_cancer[[v_names_str[i]]] <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  death_background[[v_names_str[i]]] <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  m_M_wBG[[v_names_str[i]]] <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> params_sc<span class="sc">$</span>n_cycles<span class="sc">+</span><span class="dv">1</span>, <span class="at">ncol =</span> v_n_states, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="dv">0</span><span class="sc">:</span>(params_sc<span class="sc">$</span>n_cycles), v_names_states))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  m_M_wBG[[v_names_str[i]]][<span class="dv">1</span>,] <span class="ot">=</span> <span class="fu">c</span>(params_sc<span class="sc">$</span>nPop, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="at">times=</span><span class="dv">5</span>))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (cycle <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>params_sc<span class="sc">$</span>n_cycles) {</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    m_M_wBG[[v_names_str[i]]][cycle<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">=</span> m_M_wBG[[v_names_str[i]]][cycle,] <span class="sc">%*%</span> m_P[[v_names_str[i]]] <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>mlt2020_nonCause[(cycle <span class="sc">+</span> start_age),<span class="st">"qx"</span>] <span class="sc">%&gt;%</span> <span class="fu">pull</span>())</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    death_background[[v_names_str[i]]][cycle<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> <span class="fu">sum</span>(m_M_wBG[[v_names_str[i]]][cycle,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">*</span> (mlt2020_nonCause[(cycle <span class="sc">+</span> start_age),<span class="st">"qx"</span>] <span class="sc">%&gt;%</span> <span class="fu">pull</span>()) <span class="sc">+</span> death_background[[v_names_str[i]]][cycle]</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    death_cancer[[v_names_str[i]]][cycle<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> <span class="fu">round</span>(params_sc<span class="sc">$</span>nPop <span class="sc">-</span> <span class="fu">sum</span>(m_M_wBG[[v_names_str[i]]][cycle<span class="sc">+</span><span class="dv">1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]) <span class="sc">-</span> death_background[[v_names_str[i]]][cycle<span class="sc">+</span><span class="dv">1</span>],<span class="dv">2</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  m_M_wBG[[v_names_str[i]]] <span class="ot">=</span> <span class="fu">cbind</span>(m_M_wBG[[v_names_str[i]]][,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="fu">matrix</span>(death_cancer[[v_names_str[i]]]), <span class="fu">matrix</span>(death_background[[v_names_str[i]]]))</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(m_M_wBG[[v_names_str[i]]])[<span class="dv">6</span><span class="sc">:</span><span class="dv">7</span>] <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Death_Cancer"</span>, <span class="st">"Death_Background"</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>m_M_wBG</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$quo
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0      0         0          0.0              0.0
1      916     50     20     10         0          0.0              4.2
2      839     79     36     17        16          4.5              8.7
3      768     96     47     22        41         12.1             13.5
4      703    107     56     26        68         22.0             18.5
5      643    113     63     28        95         33.5             23.8
6      588    118     68     30       121         46.1             29.4
7      538    121     71     31       145         59.5             35.4
8      491    123     74     31       166         73.2             41.7
9      449    124     76     31       185         87.1             48.4
10     409    124     77     31       202        101.1             55.6
11     373    124     78     31       216        115.0             63.2
12     340    124     78     31       228        128.8             71.2
13     309    123     78     30       238        142.4             79.6
14     281    121     78     30       245        155.8             88.5
15     256    120     77     29       251        168.9             97.9
16     232    118     76     28       256        181.8            107.6
17     210    116     75     27       258        194.3            117.8
18     191    114     74     27       260        206.4            128.4
19     173    111     73     26       260        218.3            139.3
20     156    109     71     25       259        229.8            150.5
21     141    106     70     24       256        240.9            161.9
22     127    103     68     24       253        251.7            173.6
23     114    100     66     23       249        262.0            185.7
24     103     97     64     22       244        272.1            198.1
25      92     93     62     21       239        281.7            210.8
26      83     90     60     20       233        290.9            223.7
27      74     86     58     19       226        299.8            236.9
28      66     83     55     18       219        308.2            250.5
29      59     79     53     18       211        316.3            264.3
30      52     75     50     17       202        323.9            279.1

$trtA
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0    0.0         0          0.0              0.0
1      916     50     20   10.0         0          0.0              4.2
2      839     79     36   17.1        16          4.5              8.7
3      768     95     47   22.1        42         12.1             13.5
4      703    103     54   25.6        74         22.0             18.5
5      643    106     59   27.8       108         33.5             23.8
6      588    105     61   29.0       142         45.9             29.4
7      538    103     61   29.3       175         58.9             35.4
8      491    100     61   29.0       206         72.0             41.7
9      449     96     59   28.3       235         84.9             48.4
10     409     92     57   27.3       262         97.5             55.6
11     373     87     55   26.1       285        109.7             63.2
12     340     83     53   24.8       307        121.3             71.3
13     309     79     51   23.5       325        132.3             79.8
14     281     75     48   22.2       342        142.8             88.8
15     256     71     46   20.9       355        152.7             98.3
16     232     68     44   19.6       367        161.9            108.3
17     210     64     42   18.5       376        170.6            118.8
18     191     61     40   17.3       383        178.8            129.7
19     173     58     38   16.3       388        186.5            141.1
20     156     55     36   15.3       392        193.7            152.8
21     141     52     34   14.3       393        200.4            164.8
22     127     49     33   13.4       394        206.7            177.3
23     114     47     31   12.6       392        212.6            190.2
24     103     45     29   11.8       389        218.2            203.6
25      92     42     28   11.1       385        223.4            217.5
26      83     40     27   10.4       380        228.2            231.7
27      74     38     25    9.7       374        232.8            246.4
28      66     36     24    9.1       366        237.0            261.6
29      59     34     23    8.5       357        241.0            277.3
30      52     32     21    8.0       347        244.7            294.3

$trtB
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0      0         0          0.0              0.0
1      916     50     20     10         0          0.0              4.2
2      839     79     36     17        16          4.5              8.7
3      768     96     47     22        41         12.1             13.5
4      703    106     55     26        70         22.0             18.5
5      643    112     61     28        99         33.5             23.8
6      588    115     65     29       127         46.0             29.4
7      538    117     67     30       154         59.2             35.4
8      491    118     68     30       178         72.6             41.7
9      449    118     69     30       200         86.1             48.4
10     409    117     69     30       220         99.5             55.6
11     373    117     69     29       236        112.7             63.2
12     340    116     68     28       251        125.6             71.2
13     309    115     68     27       263        138.2             79.7
14     281    113     67     27       273        150.4             88.6
15     256    111     66     26       281        162.2             98.1
16     232    109     64     25       287        173.7            107.9
17     210    107     63     24       292        184.8            118.2
18     191    105     62     23       295        195.5            129.0
19     173    103     60     22       296        205.8            140.0
20     156    100     59     22       296        215.7            151.4
21     141     98     57     21       295        225.3            163.1
22     127     95     56     20       292        234.5            175.1
23     114     92     54     19       289        243.3            187.5
24     103     90     52     18       285        251.8            200.3
25      92     87     51     18       279        259.9            213.4
26      83     84     49     17       273        267.6            226.8
27      74     81     47     16       266        275.0            240.5
28      66     77     45     15       259        282.1            254.7
29      59     74     43     15       251        288.8            269.2
30      52     71     41     14       242        295.2            284.8

$trtC
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0      0         0          0.0              0.0
1      916     50     20     10         0          0.0              4.2
2      839     79     36     17        16          4.5              8.7
3      768     95     47     22        42         12.1             13.5
4      703    104     55     26        72         22.0             18.5
5      643    109     60     28       103         33.5             23.8
6      588    110     63     29       134         46.0             29.4
7      538    110     64     30       164         59.0             35.4
8      491    109     65     30       191         72.3             41.7
9      449    107     64     29       217         85.5             48.4
10     409    105     64     28       239         98.5             55.6
11     373    103     62     28       259        111.2             63.2
12     340    101     61     27       277        123.5             71.3
13     309     98     60     26       292        135.4             79.8
14     281     96     58     25       304        146.8             88.7
15     256     93     57     24       315        157.8             98.2
16     232     91     55     23       323        168.2            108.1
17     210     88     54     22       329        178.2            118.5
18     191     86     52     21       334        187.8            129.3
19     173     83     51     20       337        196.9            140.5
20     156     81     49     19       338        205.6            152.1
21     141     78     47     18       338        213.9            163.9
22     127     76     46     17       337        221.9            176.1
23     114     73     44     16       334        229.4            188.7
24     103     70     43     16       330        236.6            201.8
25      92     68     41     15       325        243.5            215.3
26      83     65     39     14       319        250.0            229.0
27      74     63     38     13       312        256.2            243.2
28      66     60     36     13       305        262.1            257.8
29      59     58     35     12       296        267.6            272.9
30      52     55     33     11       286        272.9            289.0</code></pre>
</div>
</div>
</section>
<section id="using-expm" class="level2">
<h2 class="anchored" data-anchor-id="using-expm">Using expm</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>start_age <span class="ot">=</span> <span class="dv">45</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>r_death_background <span class="ot">=</span> <span class="fu">sapply</span>(<span class="fu">subset</span>(mlt2020_nonCause, Age <span class="sc">&gt;=</span> start_age)<span class="sc">$</span>qx, <span class="cf">function</span>(p) {<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>p)})</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>m_Pt <span class="ot">&lt;-</span> <span class="cf">function</span>(t)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  r_death_bg <span class="ot">=</span> r_death_background[t]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  m_Rt <span class="ot">=</span> <span class="fu">lapply</span>(m_R, <span class="cf">function</span>(m) {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">=</span> <span class="fu">cbind</span>(m, <span class="fu">c</span>(<span class="fu">rep</span>(r_death_bg,<span class="dv">5</span>),<span class="dv">0</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">=</span> <span class="fu">rbind</span>(m, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">7</span>))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(m)[[<span class="dv">1</span>]] <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">dimnames</span>(m)[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],<span class="st">"Death_Cancer"</span>, <span class="st">"Death_Background"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(m)[[<span class="dv">2</span>]] <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">dimnames</span>(m)[[<span class="dv">2</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="st">"Death_Cancer"</span>, <span class="st">"Death_Background"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>(m) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>(m) <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">rowSums</span>(m)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    m})</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  m_P <span class="ot">&lt;-</span> <span class="co"># Embed the matrices into the timesteps</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lapply</span>(m_Rt, <span class="cf">function</span>(m) expm<span class="sc">::</span><span class="fu">expm</span>(m))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>params_sc<span class="sc">$</span>m_P <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>params_sc<span class="sc">$</span>n_cycles, <span class="cf">function</span>(t) <span class="fu">m_Pt</span>(t))</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>m_M_wBG_expm <span class="ot">&lt;-</span> <span class="fu">lapply</span>(v_names_str, <span class="cf">function</span>(str){</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  tr_ <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">c</span>(<span class="st">"Healthy"</span> <span class="ot">=</span> params_sc<span class="sc">$</span>nPop, <span class="st">"Stage1"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Stage2"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Stage3"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Remission"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Death_Cancer"</span> <span class="ot">=</span> <span class="dv">0</span>, <span class="st">"Death_Background"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(params_sc<span class="sc">$</span>m_P, <span class="cf">function</span>(tp) {</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>            tr_ <span class="ot">&lt;&lt;-</span> tr_ <span class="sc">%*%</span> tp[[str]]</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  tr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">t</span>(<span class="fu">c</span>(params_sc<span class="sc">$</span>nPop, <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">6</span>))), tr)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(tr)[[<span class="dv">1</span>]] <span class="ot">=</span> <span class="dv">0</span><span class="sc">:</span>params_sc<span class="sc">$</span>n_cycles</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  tr <span class="ot">=</span> <span class="fu">round</span>(tr, <span class="dv">2</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tr)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(m_M_wBG_expm) <span class="ot">=</span> v_names_str</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>m_M_wBG_expm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$quo
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0    0.0       0.0          0.0              0.0
1      916     41     18    8.6       8.8          2.9              4.2
2      839     67     32   14.4      29.1         10.2              8.7
3      768     83     42   18.4      54.8         20.5             13.4
4      703     93     50   21.1      82.2         32.9             18.3
5      643    100     55   22.8     109.2         46.6             23.6
6      588    104     59   23.8     134.6         61.1             29.1
7      538    107     62   24.4     157.8         76.2             34.8
8      491    109     64   24.7     178.6         91.5             41.0
9      449    110     66   24.7     196.9        107.0             47.5
10     409    110     67   24.6     212.6        122.3             54.5
11     373    110     67   24.3     225.9        137.6             61.8
12     340    110     67   23.9     237.0        152.6             69.6
13     309    109     67   23.5     246.0        167.4             77.7
14     281    108     67   23.0     253.0        181.9             86.2
15     256    106     66   22.5     258.1        196.1             95.2
16     232    104     65   21.9     261.6        210.0            104.5
17     210    103     64   21.4     263.5        223.5            114.3
18     191    100     63   20.8     264.1        236.6            124.4
19     173     98     62   20.1     263.3        249.3            134.8
20     156     96     60   19.5     261.5        261.7            145.4
21     141     93     59   18.8     258.6        273.6            156.2
22     127     90     57   18.2     254.8        285.2            167.2
23     114     87     56   17.5     250.2        296.3            178.6
24     103     84     54   16.8     244.7        307.0            190.3
25      92     81     52   16.2     238.6        317.3            202.2
26      83     78     50   15.5     231.9        327.2            214.3
27      74     75     48   14.8     224.6        336.6            226.6
28      66     72     46   14.1     216.8        345.6            239.3
29      59     69     44   13.4     208.6        354.2            252.2
30      52     65     42   12.7     199.6        362.4            265.9

$trtA
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0    0.0       0.0          0.0              0.0
1      916     41     18    8.6       9.2          2.9              4.2
2      839     65     31   14.4      31.5         10.2              8.7
3      768     79     40   18.2      61.4         20.4             13.4
4      703     85     45   20.5      94.9         32.5             18.3
5      643     88     48   21.7     129.6         45.7             23.6
6      588     88     50   22.2     163.8         59.5             29.1
7      538     86     50   22.1     196.6         73.3             34.9
8      491     83     49   21.6     227.2         86.9             41.0
9      449     80     48   20.9     255.4        100.2             47.6
10     409     76     46   20.0     281.0        112.9             54.6
11     373     73     44   19.0     303.9        125.0             62.1
12     340     69     42   18.0     324.1        136.6             70.0
13     309     66     40   17.0     341.7        147.5             78.3
14     281     62     39   16.0     356.9        157.8             87.0
15     256     59     37   15.1     369.6        167.4             96.4
16     232     56     35   14.1     380.0        176.6            106.1
17     210     53     33   13.3     388.3        185.1            116.3
18     191     51     32   12.5     394.6        193.1            127.0
19     173     48     30   11.7     398.9        200.7            138.1
20     156     46     29   11.0     401.6        207.7            149.6
21     141     43     27   10.3     402.7        214.3            161.3
22     127     41     26    9.7     402.2        220.6            173.5
23     114     39     25    9.1     400.3        226.4            186.2
24     103     37     23    8.5     396.9        231.9            199.3
25      92     35     22    8.0     392.2        237.0            212.9
26      83     33     21    7.5     386.5        241.9            226.8
27      74     32     20    7.0     379.5        246.4            241.2
28      66     30     19    6.6     371.4        250.6            256.1
29      59     28     18    6.2     362.3        254.6            271.5
30      52     27     17    5.8     351.6        258.3            288.1

$trtB
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0    0.0       0.0          0.0              0.0
1      916     41     18    8.6       8.9          2.9              4.2
2      839     66     32   14.4      29.9         10.2              8.7
3      768     82     41   18.3      57.0         20.4             13.4
4      703     91     48   20.8      86.3         32.7             18.3
5      643     97     52   22.3     115.8         46.2             23.6
6      588    100     55   23.1     143.9         60.4             29.1
7      538    102     57   23.4     170.1         74.9             34.9
8      491    103     58   23.4     193.8         89.5             41.0
9      449    103     58   23.1     215.1        104.0             47.5
10     409    103     58   22.7     233.7        118.3             54.6
11     373    102     58   22.2     249.8        132.3             61.9
12     340    102     58   21.6     263.6        146.0             69.7
13     309    100     57   21.0     275.0        159.3             77.9
14     281     99     56   20.3     284.3        172.2             86.6
15     256     97     55   19.7     291.6        184.6             95.7
16     232     96     54   19.0     297.1        196.7            105.2
17     210     94     53   18.4     300.8        208.4            115.1
18     191     92     52   17.7     302.9        219.7            125.4
19     173     90     51   17.1     303.5        230.5            136.1
20     156     87     49   16.5     302.8        241.0            147.0
21     141     85     48   15.8     301.0        251.1            158.2
22     127     83     47   15.2     298.0        260.7            169.7
23     114     80     45   14.6     294.0        270.0            181.6
24     103     78     44   14.0     289.1        279.0            193.8
25      92     75     42   13.4     283.2        287.5            206.3
26      83     72     41   12.8     276.6        295.7            219.1
27      74     70     39   12.2     269.3        303.5            232.1
28      66     67     38   11.7     261.2        311.0            245.6
29      59     64     36   11.1     252.6        318.1            259.4
30      52     61     34   10.5     243.0        324.8            274.1

$trtC
   Healthy Stage1 Stage2 Stage3 Remission Death_Cancer Death_Background
0     1000      0      0    0.0         0          0.0              0.0
1      916     41     18    8.6         9          2.9              4.2
2      839     66     31   14.4        31         10.2              8.7
3      768     80     41   18.2        59         20.4             13.4
4      703     88     47   20.6        91         32.6             18.3
5      643     92     50   22.0       122         46.0             23.6
6      588     94     52   22.6       154         59.9             29.1
7      538     94     53   22.8       183         74.1             34.9
8      491     94     54   22.5       210         88.2             41.0
9      449     92     53   22.0       234        102.2             47.6
10     409     91     53   21.4       256        115.7             54.6
11     373     89     52   20.7       275        128.8             62.0
12     340     87     51   19.9       292        141.5             69.8
13     309     84     49   19.1       306        153.7             78.1
14     281     82     48   18.3       318        165.3             86.8
15     256     80     47   17.6       327        176.5             96.0
16     232     78     45   16.8       335        187.2            105.6
17     210     76     44   16.1       341        197.5            115.7
18     191     73     43   15.3       344        207.3            126.2
19     173     71     41   14.7       347        216.6            137.0
20     156     69     40   14.0       347        225.6            148.2
21     141     67     39   13.4       347        234.1            159.6
22     127     64     37   12.8       345        242.3            171.5
23     114     62     36   12.2       341        250.0            183.7
24     103     60     35   11.6       337        257.4            196.3
25      92     58     34   11.1       331        264.5            209.3
26      83     56     32   10.5       325        271.2            222.6
27      74     53     31   10.0       318        277.6            236.3
28      66     51     30    9.5       309        283.7            250.4
29      59     49     28    9.0       300        289.5            264.9
30      52     47     27    8.5       290        294.9            280.5</code></pre>
</div>
</div>
</section>
</section>
<section id="icer-re-calculation" class="level1">
<h1>ICER Re-Calculation</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m_M_simplified <span class="ot">=</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  m_M_wBG <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span> {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.x)){</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      .x[i,<span class="dv">6</span>] <span class="ot">=</span> .x[i,<span class="st">"Death_Cancer"</span>] <span class="sc">+</span> .x[i,<span class="st">"Death_Background"</span>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    .x <span class="ot">=</span> .x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(.x)[<span class="dv">6</span>] <span class="ot">=</span> <span class="st">"Death"</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    .x</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>cea_wBG <span class="ot">=</span> <span class="fu">calculate_icers</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost =</span> <span class="fu">get_ce</span>(<span class="at">l_m_M =</span> m_M_simplified, <span class="at">payoffs =</span> <span class="fu">build_payoffs</span>(params_sc), params_sc)<span class="sc">$</span>cost,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="fu">get_ce</span>(<span class="at">l_m_M =</span> m_M_simplified, <span class="at">payoffs =</span> <span class="fu">build_payoffs</span>(params_sc), params_sc)<span class="sc">$</span>qaly,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">strategies =</span> v_names_str)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">format_table_cea</span>(cea_wBG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Strategy  Costs ($) QALYs Incremental Costs ($) Incremental QALYs
quo       quo 25,224,653 19425                  &lt;NA&gt;                NA
trtB     trtB 50,710,441 19425            25,485,788                 0
trtA     trtA 66,750,941 19425                  &lt;NA&gt;                NA
trtC     trtC 73,988,389 19425                  &lt;NA&gt;                NA
     ICER ($/QALY) Status
quo           &lt;NA&gt;     ND
trtB 6,171,632,286     ND
trtA          &lt;NA&gt;      D
trtC          &lt;NA&gt;      D</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cea_wBG, <span class="at">label =</span> <span class="st">"all"</span>, <span class="at">txtsize =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">max</span>(<span class="fu">format_table_cea</span>(cea_wBG)<span class="sc">$</span>QALYs) <span class="sc">+</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="AddingMortality_files/figure-html/ICER_bg_mortality-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>